import{r as e,j as l}from"./react@19.1.0.QBh3HWPD.js";import{t,w as r,a as n}from"./index.QSHKou_T.js";import{l as o}from"./lodash@4.17.21.HHZ9h80f.js";import{r as s}from"./react-resizable@3.0.5_react-dom@19.1.0_react@19.1.0.DUvuNxA3.js";import{I as i}from"./@iconify_react@5.2.1_react@19.1.0.BMViFkUw.js";import{D as a}from"./react-draggable@4.4.6_react-dom@19.1.0_react@19.1.0.BjQ5V6d-.js";import{u as c}from"./react-i18next@15.5.2_i18next@25.2.1_react-dom@19.1.0_react@19.1.0_typescript@5.8.3.BPrJqYVj.js";import{w as d,B as u,C as h,x as p,s as g,y as f,T as m}from"./antd@5.25.4_react-dom@19.1.0_react@19.1.0.D3GrBiye.js";import{m as x,n as v,e as b}from"./@ant-design_icons@6.0.0_react-dom@19.1.0_react@19.1.0.BE6VjIg_.js";function j(e){switch(e){case"large":return 62;case"middle":return 54;default:return 46}}function w(e){const l=o.cloneDeep(e);for(let r=0;r<(null==l?void 0:l.length);r++){const e=l[r];void 0===e.ellipsis&&(e.ellipsis=!0),e.render||(e.render=e=>e||(0===e?e:t))}return l}function y(e){const{onResize:t,width:r,...n}=e;return r?l.jsx(s.Resizable,{width:r,height:0,handle:l.jsx("span",{className:"react-resizable-handle",onClick:e=>{e.stopPropagation()}}),onResize:t,draggableOpts:{enableUserSelectHack:!1},children:l.jsx("th",{...n})}):l.jsx("th",{...n})}function S(e,l){switch(l.type){case"changeScroll":let t=l.curScrollTop||0,r=l.scrollHeight||0;const n=l.tableScrollY||0;return r<=0&&(r=0),0!==r&&n===e.tableScrollY&&(r=e.scrollHeight),e.scrollHeight&&t>e.scrollHeight&&(t=e.scrollHeight),{...e,curScrollTop:t,scrollHeight:r,tableScrollY:n};case"reset":return{...e,curScrollTop:0,scrollHeight:0};default:throw new Error("表格：未知错误类型!")}}const H=e.createContext({dispatch:void 0,renderLen:1,start:0,offsetStart:0,rowHeight:46,totalLen:0});function N(t){const{children:r,...n}=t,{renderLen:o,start:s,offsetStart:i}=e.useContext(H);let a=null;if(r&&null!==r){const e=null==r?void 0:r[1];a=Array.isArray(e)&&e.length?[null==r?void 0:r[0],e.slice(s,s+o).map((e=>Array.isArray(e)?e[0]:e))]:r}return l.jsx("tbody",{...n,style:{transform:`translateY(-${i}px)`},children:a})}const C={rowHeight:38,curScrollTop:0,scrollHeight:0,tableScrollY:0,total:0};let k=0;function T(t){var n,s;const{style:i,children:a,...c}=t,{width:d,...u}=i,[h,p]=e.useReducer(S,C),g=e.useRef(null),f=e.useRef(null),m=C.total,x=e.useMemo((()=>{let e="auto";return h.rowHeight&&m&&(e=h.rowHeight*(m+1)),e}),[h.rowHeight,m]);let v=0;v="string"==typeof k?null==(s=null==(n=g.current)?void 0:n.parentNode)?void 0:s.offsetHeight:k,r(x)&&Number(x)<v&&(v=x),v<=0&&(v=0);const b=e.useMemo((()=>{let e=1;if(h.rowHeight&&m&&v)if(v<=0)e=0;else{const l=5+(v/h.rowHeight|0);e=l>m?m:l}return e}),[h.rowHeight,m,v]);let j=h.rowHeight?h.curScrollTop/h.rowHeight|0:0,w=h.rowHeight?h.curScrollTop%h.rowHeight:0;h.curScrollTop&&h.rowHeight&&h.curScrollTop>h.rowHeight?j>m-b?w=0:j>1&&(j-=1,w+=h.rowHeight):j=0,e.useEffect((()=>{var e;const l=null==(e=g.current)?void 0:e.parentNode;l&&(l.scrollTop=0),p({type:"reset"})}),[m]);const y=o.throttle((e=>{var l,t;const r=(null==(l=null==e?void 0:e.target)?void 0:l.scrollTop)??0;if(r!==h.curScrollTop){const l=(null==(t=null==e?void 0:e.target)?void 0:t.scrollHeight)-v;p({type:"changeScroll",curScrollTop:r,scrollHeight:l,tableScrollY:v})}}),60);return e.useEffect((()=>{var e;const l=null==(e=null==g?void 0:g.current)?void 0:e.parentNode;return l&&l.addEventListener("scroll",(e=>y(e))),()=>{l.removeEventListener("scroll",(e=>y(e)))}}),[g,h.curScrollTop,v,h.scrollHeight,y]),l.jsx("div",{className:"virtualTable",ref:g,style:{width:"100%",position:"relative",height:x,boxSizing:"border-box",paddingTop:h.curScrollTop},children:l.jsx(H.Provider,{value:{dispatch:p,rowHeight:h.rowHeight,start:j,offsetStart:w,renderLen:b,totalLen:m},children:l.jsx("table",{...c,ref:f,style:{...u,width:d,position:"relative"},children:a})})})}function z(t){const{columns:r,cacheColumns:n,className:o,getTableChecks:s}=t,{t:g}=c(),[f,m]=e.useState(!1),[v,b]=e.useState([]),[j,w]=e.useState([]),[y,S]=e.useState(null),H=v.length===j.length,N=j.length>0&&j.length<v.length,C={...t},k=e.useRef({});delete C.getTableChecks,delete C.cacheColumns,e.useEffect((()=>{T(r)}),[r]);const T=l=>{if(!(null==l?void 0:l.length))return[];const t=[],r=[],n={};for(let o=0;o<(null==l?void 0:l.length);o++){const s=l[o],{dataIndex:i}=s;!s.hidden&&i&&(null==r||r.push(i)),n[i]=e.createRef(),t.push({label:s.title,value:i})}b(t),k.current=n,w(r)},z=e=>{w(e),_(e)},_=(e,l=v)=>{s(e,l.map((e=>e.value)))},R=e=>{const l=e.target.checked?v.map((e=>e.value)):[];w(l),_(l)},E=()=>{var e;const l=[],t=null==(e=null==n?void 0:n.map((e=>null==e?void 0:e.dataIndex)))?void 0:e.filter(Boolean);for(let r=0;r<(null==n?void 0:n.length);r++){const e=n[r];l.push({label:e.title,value:e.dataIndex})}w(t),b(l),_(t,l)};return l.jsx(d,{content:()=>l.jsxs("div",{className:"min-w-140px flex flex-col",children:[l.jsx("div",{className:"px-5px",children:l.jsx(h,{className:"w-full !pl-10px !py-3px hover:bg-blue-100 border-rd-5px",indeterminate:N,onChange:R,checked:H,children:g("public.checkAll")})}),l.jsx(p,{className:"!my-5px"}),l.jsx(h.Group,{className:"flex flex-col !px-5px !pb-5px relative",value:j,onChange:z,children:null==v?void 0:v.map(((e,t)=>{var r,n;return l.jsx(a,{nodeRef:null==(r=k.current)?void 0:r[e.value],axis:"y",position:{x:0,y:t},bounds:"parent",handle:".drag-handle",onStart:()=>S(t),onStop:(e,l)=>((e,l)=>{let t=e+Math.round(l/28);t<0&&(t=0),t>=v.length&&(t=v.length-1);const r=[...v],[n]=r.splice(e,1);r.splice(t,0,n),b(r);const o=r.map((e=>e.value)).filter((e=>j.includes(e)));w(o),_(o,r),S(null)})(t,l.y),children:l.jsxs("div",{ref:null==(n=k.current)?void 0:n[e.value],className:`\n                  h-28px\n                  flex\n                  items-center\n                  pl-5px\n                  hover:bg-blue-100\n                  border-rd-5px\n                  ${y===t?"bg-blue-100 z-10":""}\n                `,style:{transition:"background 0.2s"},children:[l.jsx("div",{className:"h-28px pr-5px cursor-move flex items-center justify-center drag-handle",children:l.jsx(i,{icon:"icon-park-outline:drag"})}),l.jsx(h,{value:e.value,className:"flex-1",children:e.label})]})},e.value)}))}),l.jsx(p,{className:"!mt-10px !mb-5px"}),l.jsx(u,{className:"flex-1 text-center",type:"link",size:"small",onClick:E,children:g("public.reset")})]}),trigger:"click",placement:"bottom",styles:{body:{padding:"8px 0 5px"}},open:f,onOpenChange:()=>{m(!f)},children:l.jsx("div",{...C,className:`${o} inline-block`,children:l.jsx(u,{icon:l.jsx(x,{}),className:"small-btn",children:g("public.columnFilter")})})})}function _(r){var o;const{isLoading:s,isVirtual:i,isCreate:a,isZebra:d=!0,isBordered:h=!0,isOperate:p=!0,isAuthHeight:x,scrollX:S,scrollY:H,rowClassName:_,size:R,leftContent:E,rightContent:A,getPage:B,onCreate:I}=r,{t:L}=c(),{isPhone:$}=n(),[Y]=function(){const[l,t]=e.useState(!0);return[(e,r,n)=>{if(!(null==r?void 0:r.length)||!(null==e?void 0:e.length))return[];if(l)return t(!1),e||[];e.sort(((e,l)=>n.indexOf(e.dataIndex)-n.indexOf(l.dataIndex)));for(let l=0;l<(null==e?void 0:e.length);l++){const t=e[l];t.hidden=!r.includes(t.dataIndex)}return e}]}(),[M,O]=e.useState(w(r.columns)),P=e.useRef(null),[W,D]=e.useState([]),[F,K]=e.useState([]);e.useEffect((()=>{const e=w(r.columns),l=null==e?void 0:e.map((e=>e.dataIndex)).filter(Boolean);O(e),D(l),K(l)}),[r.columns]),e.useEffect((()=>{a&&!I&&g.warning(L("public.createMethodWarning"))}),[a]),e.useEffect((()=>{p&&!B&&g.warning(L("public.getPageWarning"))}),[B]);const G=function(e){var l,t;const r=document.documentElement.clientHeight||document.body.clientHeight,n=(null==(t=null==(l=null==e?void 0:e.getBoundingClientRect)?void 0:l.call(e))?void 0:t.top)||0,o=document.getElementById("pagination"),s=r-n-((null==o?void 0:o.offsetHeight)||0);return s>0?s-65:450}(P.current),U=e=>(l,{size:t})=>{const r=[...M];r[e]={...r[e],width:t.width},O(r)},V=function(e){const{height:l,size:t,total:r}=e;return k=l,C.rowHeight=j(t),C.total=r,{table:T,body:{wrapper:N}}}({height:G,size:R||"small",total:(null==(o=r.dataSource)?void 0:o.length)||0}),X=e.useMemo((()=>({header:{cell:y},body:{wrapper:V.body.wrapper},table:V.table})),[V]),Z=i?X:{header:{cell:y}},q={...r.scroll,x:S??"max-content",y:H??(x?G:void 0)};return l.jsxs("div",{id:"table",className:`\n        overflow-auto\n        ${!1!==h?"bordered":""}\n        ${!1!==d?"zebra":""}\n      `,children:[p&&l.jsxs("div",{className:"flex justify-between !mb-10px",children:[l.jsxs("div",{className:"flex flex-wrap items-center gap-6px",children:[!!a&&l.jsx(u,{type:"primary",className:"small-btn",icon:l.jsx(v,{}),onClick:I,children:L("public.create")}),E]}),l.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-6px",children:[A?l.jsx("div",{children:A}):void 0,l.jsx(u,{className:"small-btn",icon:l.jsx(b,{className:"transform rotate-270",disabled:!!s}),onClick:B,children:L("public.refresh")}),l.jsx(z,{columns:M,cacheColumns:r.columns,getTableChecks:(e,l)=>{D(e),K(l)}})]})]}),l.jsx("div",{ref:P,children:l.jsx(f,{size:"small",rowKey:"id",pagination:!1,loading:s,...r,rowClassName:(e,l,t)=>`${("string"==typeof _?_:null==_?void 0:_(e,l,t))||""} ${`!h-${j(R)}px`}`,style:{borderRadius:10,borderRight:"1px solid rgba(0, 0, 0, .05)",borderBottom:"1px solid rgba(0, 0, 0, .05)",overflow:"auto",...r.style},bordered:!1!==h,scroll:q,components:Z,columns:(()=>{const e=Y(M,W,F);if(!e)return[];return e.map(((e,r)=>({...e,ellipsis:e.ellipsis??!0,fixed:!(!(null==e?void 0:e.fixed)||$&&!(null==e?void 0:e.isKeepFixed))&&e.fixed,onHeaderCell:(l,t)=>{var n;return{...null==(n=null==e?void 0:e.onHeaderCell)?void 0:n.call(e,l,t),width:e.width,onResize:U(r)}},onCell:(l,t)=>{var r,n,o;return{...null==(r=null==e?void 0:e.onCell)?void 0:r.call(e,l,t),style:{...null==(o=null==(n=null==e?void 0:e.onCell)?void 0:n.call(e,l,t))?void 0:o.style,maxWidth:e.width,width:e.width}}},render:(r,n,o)=>{var s;const i=null==(s=null==e?void 0:e.render)?void 0:s.call(e,r,n,o);let a,c=i;const d=null==e?void 0:e.enum;if(d&&"object"==typeof d)if(Array.isArray(d))for(let e=0;e<(null==d?void 0:d.length);e++){const l=d[e];if(String(l.value)===String(c)){c=l.label,a=l.color;break}}else for(const e in d)if(e===String(c)){c=d[e];break}return["object","function"].includes(typeof i)?i:l.jsx(m,{title:c,placement:"topLeft",children:l.jsx("span",{style:{color:a},className:"break-all",title:c,children:String(c??t)})})}})))})()})})]})}export{_ as B};
