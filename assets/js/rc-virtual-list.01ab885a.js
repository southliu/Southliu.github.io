import{e as I,g as pe,b as W,z as Oe,A as We,a as me,_ as Re,c as D,d as Se,n as Ke}from"./@babel_runtime.c8088fcd.js";import{r as o}from"./react.76efb1e3.js";import{c as q}from"./classnames.82ff248b.js";import{R as je}from"./rc-resize-observer.438dc091.js";import{W as H,ad as Ae,a as oe}from"./rc-util.644b3d3a.js";var Me=o.forwardRef(function(t,v){var u=t.height,e=t.offset,c=t.children,i=t.prefixCls,l=t.onInnerResize,r=t.innerProps,n={},a={display:"flex",flexDirection:"column"};return e!==void 0&&(n={height:u,position:"relative",overflow:"hidden"},a=I(I({},a),{},{transform:"translateY(".concat(e,"px)"),position:"absolute",left:0,right:0,top:0})),o.createElement("div",{style:n},o.createElement(je,{onResize:function(s){var d=s.offsetHeight;d&&l&&l()}},o.createElement("div",pe({style:a,className:q(W({},"".concat(i,"-holder-inner"),i)),ref:v},r),c)))});Me.displayName="Filler";var Ve=20;function ge(t){return"touches"in t?t.touches[0].pageY:t.pageY}var Be=function(t){Oe(u,t);var v=We(u);function u(){var e;me(this,u);for(var c=arguments.length,i=new Array(c),l=0;l<c;l++)i[l]=arguments[l];return e=v.call.apply(v,[this].concat(i)),e.moveRaf=null,e.scrollbarRef=o.createRef(),e.thumbRef=o.createRef(),e.visibleTimeout=null,e.state={dragging:!1,pageY:null,startTop:null,visible:!1},e.delayHidden=function(){clearTimeout(e.visibleTimeout),e.setState({visible:!0}),e.visibleTimeout=setTimeout(function(){e.setState({visible:!1})},2e3)},e.onScrollbarTouchStart=function(r){r.preventDefault()},e.onContainerMouseDown=function(r){r.stopPropagation(),r.preventDefault()},e.patchEvents=function(){window.addEventListener("mousemove",e.onMouseMove),window.addEventListener("mouseup",e.onMouseUp),e.thumbRef.current.addEventListener("touchmove",e.onMouseMove),e.thumbRef.current.addEventListener("touchend",e.onMouseUp)},e.removeEvents=function(){var r;window.removeEventListener("mousemove",e.onMouseMove),window.removeEventListener("mouseup",e.onMouseUp),(r=e.scrollbarRef.current)===null||r===void 0||r.removeEventListener("touchstart",e.onScrollbarTouchStart),e.thumbRef.current&&(e.thumbRef.current.removeEventListener("touchstart",e.onMouseDown),e.thumbRef.current.removeEventListener("touchmove",e.onMouseMove),e.thumbRef.current.removeEventListener("touchend",e.onMouseUp)),H.cancel(e.moveRaf)},e.onMouseDown=function(r){var n=e.props.onStartMove;e.setState({dragging:!0,pageY:ge(r),startTop:e.getTop()}),n(),e.patchEvents(),r.stopPropagation(),r.preventDefault()},e.onMouseMove=function(r){var n=e.state,a=n.dragging,f=n.pageY,s=n.startTop,d=e.props.onScroll;if(H.cancel(e.moveRaf),a){var g=ge(r)-f,p=s+g,R=e.getEnableScrollRange(),b=e.getEnableHeightRange(),w=b?p/b:0,x=Math.ceil(w*R);e.moveRaf=H(function(){d(x)})}},e.onMouseUp=function(){var r=e.props.onStopMove;e.setState({dragging:!1}),r(),e.removeEvents()},e.getSpinHeight=function(){var r=e.props,n=r.height,a=r.count,f=n/a*10;return f=Math.max(f,Ve),f=Math.min(f,n/2),Math.floor(f)},e.getEnableScrollRange=function(){var r=e.props,n=r.scrollHeight,a=r.height;return n-a||0},e.getEnableHeightRange=function(){var r=e.props.height,n=e.getSpinHeight();return r-n||0},e.getTop=function(){var r=e.props.scrollTop,n=e.getEnableScrollRange(),a=e.getEnableHeightRange();if(r===0||n===0)return 0;var f=r/n;return f*a},e.showScroll=function(){var r=e.props,n=r.height,a=r.scrollHeight;return a>n},e}return Re(u,[{key:"componentDidMount",value:function(){this.scrollbarRef.current.addEventListener("touchstart",this.onScrollbarTouchStart),this.thumbRef.current.addEventListener("touchstart",this.onMouseDown)}},{key:"componentDidUpdate",value:function(c){c.scrollTop!==this.props.scrollTop&&this.delayHidden()}},{key:"componentWillUnmount",value:function(){this.removeEvents(),clearTimeout(this.visibleTimeout)}},{key:"render",value:function(){var c=this.state,i=c.dragging,l=c.visible,r=this.props,n=r.prefixCls,a=r.direction,f=this.getSpinHeight(),s=this.getTop(),d=this.showScroll(),g=d&&l,p=a==="rtl"?{left:0}:{right:0};return o.createElement("div",{ref:this.scrollbarRef,className:q("".concat(n,"-scrollbar"),W({},"".concat(n,"-scrollbar-show"),d)),style:I(I({width:8,top:0,bottom:0},p),{},{position:"absolute",display:g?null:"none"}),onMouseDown:this.onContainerMouseDown,onMouseMove:this.delayHidden},o.createElement("div",{ref:this.thumbRef,className:q("".concat(n,"-scrollbar-thumb"),W({},"".concat(n,"-scrollbar-thumb-moving"),i)),style:{width:"100%",height:f,top:s,left:0,position:"absolute",background:"rgba(0, 0, 0, 0.5)",borderRadius:99,cursor:"pointer",userSelect:"none"},onMouseDown:this.onMouseDown}))}}]),u}(o.Component);function Ge(t){var v=t.children,u=t.setRef,e=o.useCallback(function(c){u(c)},[]);return o.cloneElement(v,{ref:e})}function Ze(t,v,u,e,c,i){var l=i.getKey;return t.slice(v,u+1).map(function(r,n){var a=v+n,f=c(r,a,{}),s=l(r);return o.createElement(Ge,{key:s,setRef:function(g){return e(r,g)}},f)})}var qe=function(){function t(){me(this,t),this.maps=void 0,this.maps=Object.create(null)}return Re(t,[{key:"set",value:function(u,e){this.maps[u]=e}},{key:"get",value:function(u){return this.maps[u]}}]),t}();function Je(t,v,u){var e=o.useState(0),c=D(e,2),i=c[0],l=c[1],r=o.useRef(new Map),n=o.useRef(new qe),a=o.useRef();function f(){H.cancel(a.current)}function s(){f(),a.current=H(function(){r.current.forEach(function(g,p){if(g&&g.offsetParent){var R=Ae(g),b=R.offsetHeight;n.current.get(p)!==b&&n.current.set(p,R.offsetHeight)}}),l(function(g){return g+1})})}function d(g,p){var R=t(g),b=r.current.get(R);p?(r.current.set(R,p),s()):r.current.delete(R),!b!=!p&&(p?v==null||v(g):u==null||u(g))}return o.useEffect(function(){return f},[]),[d,s,n.current,i]}function Qe(t,v,u,e,c,i,l,r){var n=o.useRef();return function(a){if(a==null){r();return}if(H.cancel(n.current),typeof a=="number")l(a);else if(a&&Se(a)==="object"){var f,s=a.align;"index"in a?f=a.index:f=v.findIndex(function(R){return c(R)===a.key});var d=a.offset,g=d===void 0?0:d,p=function R(b,w){if(!(b<0||!t.current)){var x=t.current.clientHeight,K=!1,F=w;if(x){for(var E=w||s,U=0,P=0,L=0,y=Math.min(v.length,f),k=0;k<=y;k+=1){var J=c(v[k]);P=U;var N=u.get(J);L=P+(N===void 0?e:N),U=L,k===f&&N===void 0&&(K=!0)}var C=null;switch(E){case"top":C=P-g;break;case"bottom":C=L-x+g;break;default:{var Y=t.current.scrollTop,Q=Y+x;P<Y?F="top":L>Q&&(F="bottom")}}C!==null&&C!==t.current.scrollTop&&l(C)}n.current=H(function(){K&&i(),R(b-1,F)},2)}};p(3)}}}function Xe(t,v,u){var e=t.length,c=v.length,i,l;if(e===0&&c===0)return null;e<c?(i=t,l=v):(i=v,l=t);var r={__EMPTY_ITEM__:!0};function n(p){return p!==void 0?u(p):r}for(var a=null,f=Math.abs(e-c)!==1,s=0;s<l.length;s+=1){var d=n(i[s]),g=n(l[s]);if(d!==g){a=s,f=f||d!==n(l[s+1]);break}}return a===null?null:{index:a,multiple:f}}function et(t,v,u){var e=o.useState(t),c=D(e,2),i=c[0],l=c[1],r=o.useState(null),n=D(r,2),a=n[0],f=n[1];return o.useEffect(function(){var s=Xe(i||[],t||[],v);(s==null?void 0:s.index)!==void 0&&(u==null||u(s.index),f(t[s.index])),l(t)},[t]),[a]}var tt=(typeof navigator>"u"?"undefined":Se(navigator))==="object"&&/Firefox/i.test(navigator.userAgent);const be=function(t,v){var u=o.useRef(!1),e=o.useRef(null);function c(){clearTimeout(e.current),u.current=!0,e.current=setTimeout(function(){u.current=!1},50)}var i=o.useRef({top:t,bottom:v});return i.current.top=t,i.current.bottom=v,function(l){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,n=l<0&&i.current.top||l>0&&i.current.bottom;return r&&n?(clearTimeout(e.current),u.current=!1):(!n||u.current)&&c(),!u.current&&n}};function rt(t,v,u,e){var c=o.useRef(0),i=o.useRef(null),l=o.useRef(null),r=o.useRef(!1),n=be(v,u);function a(s){if(t){H.cancel(i.current);var d=s.deltaY;c.current+=d,l.current=d,!n(d)&&(tt||s.preventDefault(),i.current=H(function(){var g=r.current?10:1;e(c.current*g),c.current=0}))}}function f(s){t&&(r.current=s.detail===l.current)}return[a,f]}var nt=14/15;function ot(t,v,u){var e=o.useRef(!1),c=o.useRef(0),i=o.useRef(null),l=o.useRef(null),r,n=function(d){if(e.current){var g=Math.ceil(d.touches[0].pageY),p=c.current-g;c.current=g,u(p)&&d.preventDefault(),clearInterval(l.current),l.current=setInterval(function(){p*=nt,(!u(p,!0)||Math.abs(p)<=.1)&&clearInterval(l.current)},16)}},a=function(){e.current=!1,r()},f=function(d){r(),d.touches.length===1&&!e.current&&(e.current=!0,c.current=Math.ceil(d.touches[0].pageY),i.current=d.target,i.current.addEventListener("touchmove",n),i.current.addEventListener("touchend",a))};r=function(){i.current&&(i.current.removeEventListener("touchmove",n),i.current.removeEventListener("touchend",a))},oe(function(){return t&&v.current.addEventListener("touchstart",f),function(){var s;(s=v.current)===null||s===void 0||s.removeEventListener("touchstart",f),r(),clearInterval(l.current)}},[t])}var at=["prefixCls","className","height","itemHeight","fullHeight","style","data","children","itemKey","virtual","direction","component","onScroll","onVisibleChange","innerProps"],it=[],ut={overflowY:"auto",overflowAnchor:"none"};function lt(t,v){var u=t.prefixCls,e=u===void 0?"rc-virtual-list":u,c=t.className,i=t.height,l=t.itemHeight,r=t.fullHeight,n=r===void 0?!0:r,a=t.style,f=t.data,s=t.children,d=t.itemKey,g=t.virtual,p=t.direction,R=t.component,b=R===void 0?"div":R,w=t.onScroll,x=t.onVisibleChange,K=t.innerProps,F=Ke(t,at),E=!!(g!==!1&&i&&l),U=E&&f&&l*f.length>i,P=o.useState(0),L=D(P,2),y=L[0],k=L[1],J=o.useState(!1),N=D(J,2),C=N[0],Y=N[1],Q=q(e,W({},"".concat(e,"-rtl"),p==="rtl"),c),S=f||it,T=o.useRef(),ae=o.useRef(),ie=o.useRef(),z=o.useCallback(function(h){return typeof d=="function"?d(h):h==null?void 0:h[d]},[d]),Ee={getKey:z};function j(h){k(function(m){var M;typeof h=="function"?M=h(m):M=h;var $=Ce(M);return T.current.scrollTop=$,$})}var ue=o.useRef({start:0,end:S.length}),Te=o.useRef(),ye=et(S,z),He=D(ye,1),we=He[0];Te.current=we;var xe=Je(z,null,null),A=D(xe,4),_e=A[0],le=A[1],se=A[2],De=A[3],V=o.useMemo(function(){if(!E)return{scrollHeight:void 0,start:0,end:S.length-1,offset:void 0};if(!U){var h;return{scrollHeight:((h=ae.current)===null||h===void 0?void 0:h.offsetHeight)||0,start:0,end:S.length-1,offset:void 0}}for(var m=0,M,$,_,Ue=S.length,O=0;O<Ue;O+=1){var Ye=S[O],ze=z(Ye),de=se.get(ze),ne=m+(de===void 0?l:de);ne>=y&&M===void 0&&(M=O,$=m),ne>y+i&&_===void 0&&(_=O),m=ne}return M===void 0&&(M=0,$=0,_=Math.ceil(i/l)),_===void 0&&(_=S.length-1),_=Math.min(_+1,S.length),{scrollHeight:m,start:M,end:_,offset:$}},[U,E,y,S,De,i]),X=V.scrollHeight,B=V.start,G=V.end,Le=V.offset;ue.current.start=B,ue.current.end=G;var ee=X-i,te=o.useRef(ee);te.current=ee;function Ce(h){var m=h;return Number.isNaN(te.current)||(m=Math.min(m,te.current)),m=Math.max(m,0),m}var ce=y<=0,fe=y>=ee,Ie=be(ce,fe);function Pe(h){var m=h;j(m)}function ke(h){var m=h.currentTarget.scrollTop;m!==y&&j(m),w==null||w(h)}var Ne=rt(E,ce,fe,function(h){j(function(m){var M=m+h;return M})}),ve=D(Ne,2),re=ve[0],he=ve[1];ot(E,T,function(h,m){return Ie(h,m)?!1:(re({preventDefault:function(){},deltaY:h}),!0)}),oe(function(){function h(m){E&&m.preventDefault()}return T.current.addEventListener("wheel",re),T.current.addEventListener("DOMMouseScroll",he),T.current.addEventListener("MozMousePixelScroll",h),function(){T.current&&(T.current.removeEventListener("wheel",re),T.current.removeEventListener("DOMMouseScroll",he),T.current.removeEventListener("MozMousePixelScroll",h))}},[E]);var $e=Qe(T,S,se,l,z,le,j,function(){var h;(h=ie.current)===null||h===void 0||h.delayHidden()});o.useImperativeHandle(v,function(){return{scrollTo:$e}}),oe(function(){if(x){var h=S.slice(B,G+1);x(h,S)}},[B,G,S]);var Fe=Ze(S,B,G,_e,s,Ee),Z=null;return i&&(Z=I(W({},n?"height":"maxHeight",i),ut),E&&(Z.overflowY="hidden",C&&(Z.pointerEvents="none"))),o.createElement("div",pe({style:I(I({},a),{},{position:"relative"}),className:Q},F),o.createElement(b,{className:"".concat(e,"-holder"),style:Z,ref:T,onScroll:ke},o.createElement(Me,{prefixCls:e,height:X,offset:Le,onInnerResize:le,ref:ae,innerProps:K},Fe)),E&&o.createElement(Be,{ref:ie,prefixCls:e,scrollTop:y,height:i,scrollHeight:X,count:S.length,direction:p,onScroll:Pe,onStartMove:function(){Y(!0)},onStopMove:function(){Y(!1)}}))}var st=o.forwardRef(lt);st.displayName="List";export{st as L};
