import{n as e,t,g as n,a as r,v as s,b as a}from"./@rc-component_mini-decimal@1.1.0.D-IRkHTN.js";import{b as o,l as u,x as l,y as c,e as i,z as f}from"./@rc-component_util@1.4.0_re_a8b68d4fbe51b122ded4cf0ecf2ca619.D3_e-sfJ.js";import{c as p}from"./clsx@2.1.1.BvmCeSbq.js";import{r as d}from"./react@19.2.1.BpVBN_43.js";function m({prefixCls:e,action:t,children:n,disabled:r,className:s,style:a,onStep:o}){const l="up"===t,c=d.useRef(),i=d.useRef([]),f=()=>{clearTimeout(c.current)};d.useEffect(()=>()=>{f(),i.current.forEach(e=>{u.cancel(e)})},[]);const m=`${e}-action`,v=p(m,`${m}-${t}`,{[`${m}-${t}-disabled`]:r},s),b=()=>i.current.push(u(f));return d.createElement("span",{unselectable:"on",role:"button",onMouseUp:b,onMouseLeave:b,onMouseDown:e=>{(e=>{e.preventDefault(),f(),o(l,"handler"),c.current=setTimeout(function e(){o(l,"handler"),c.current=setTimeout(e,200)},600)})(e)},"aria-label":l?"Increase Value":"Decrease Value","aria-disabled":r,className:v,style:a},n||d.createElement("span",{unselectable:"on",className:`${e}-action-${t}-inner`}))}function v(n){const r="number"==typeof n?e(n):t(n).fullStr;return r.includes(".")?t(r.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:n+"0"}function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},b.apply(this,arguments)}const g=(e,t)=>e||t.isEmpty()?t.toString():t.toNumber(),y=e=>{const t=n(e);return t.isInvalidate()?null:t},E=d.forwardRef((t,E)=>{const{mode:h="input",prefixCls:M="rc-input-number",className:x,style:N,classNames:S,styles:$,min:w,max:C,step:I=1,defaultValue:R,value:D,disabled:O,readOnly:T,upHandler:k,downHandler:U,keyboard:j,changeOnWheel:q=!1,controls:L=!0,prefix:_,suffix:A,stringMode:B,parser:H,formatter:K,precision:P,decimalSeparator:V,onChange:W,onInput:z,onPressEnter:F,onStep:Y,onMouseDown:G,onClick:J,onMouseUp:Q,onMouseLeave:X,onMouseMove:Z,onMouseEnter:ee,onMouseOut:te,changeOnBlur:ne=!0,...re}=t,[se,ae]=d.useState(!1),oe=d.useRef(!1),ue=d.useRef(!1),le=d.useRef(!1),ce=d.useRef(null),ie=d.useRef(null);d.useImperativeHandle(E,()=>l(ie.current,{focus:e=>{c(ie.current,e)},blur:()=>{ie.current?.blur()},nativeElement:ce.current}));const[fe,pe]=d.useState(()=>n(D??R));const de=d.useCallback((e,t)=>{if(!t)return P>=0?P:Math.max(r(e),r(I))},[P,I]),me=d.useCallback(e=>{const t=String(e);if(H)return H(t);let n=t;return V&&(n=n.replace(V,".")),n.replace(/[^\w.-]+/g,"")},[H,V]),ve=d.useRef(""),be=d.useCallback((t,n)=>{if(K)return K(t,{userTyping:n,input:String(ve.current)});let r="number"==typeof t?e(t):t;if(!n){const e=de(r,n);if(s(r)&&(V||e>=0)){r=a(r,V||".",e)}}return r},[K,de,V]),[ge,ye]=d.useState(()=>{const e=R??D;return fe.isInvalidate()&&["string","number"].includes(typeof e)?Number.isNaN(e)?"":e:be(fe.toString(),!1)});function Ee(e,t){ye(be(e.isInvalidate()?e.toString(!1):e.toString(!t),t))}ve.current=ge;const he=d.useMemo(()=>y(C),[C,P]),Me=d.useMemo(()=>y(w),[w,P]),xe=d.useMemo(()=>!(!he||!fe||fe.isInvalidate())&&he.lessEquals(fe),[he,fe]),Ne=d.useMemo(()=>!(!Me||!fe||fe.isInvalidate())&&fe.lessEquals(Me),[Me,fe]),[Se,$e]=function(e,t){const n=d.useRef(null);return[function(){try{const{selectionStart:t,selectionEnd:r,value:s}=e,a=s.substring(0,t),o=s.substring(r);n.current={start:t,end:r,value:s,beforeTxt:a,afterTxt:o}}catch(t){}},function(){if(e&&n.current&&t)try{const{value:t}=e,{beforeTxt:r,afterTxt:s,start:a}=n.current;let o=t.length;if(t.startsWith(r))o=r.length;else if(t.endsWith(s))o=t.length-n.current.afterTxt.length;else{const e=r[a-1],n=t.indexOf(e,a-1);-1!==n&&(o=n+1)}e.setSelectionRange(o,o)}catch(r){o(!1,`Something warning of cursor restore. Please fire issue about this: ${r.message}`)}}]}(ie.current,se),we=e=>he&&!e.lessEquals(he)?he:Me&&!Me.lessEquals(e)?Me:null,Ce=e=>!we(e),Ie=(e,t)=>{let r=e,s=Ce(r)||r.isEmpty();if(r.isEmpty()||t||(r=we(r)||r,s=!0),!T&&!O&&s){const e=r.toString(),s=de(e,t);return s>=0&&(r=n(a(e,".",s)),Ce(r)||(r=n(a(e,".",s,!0)))),r.equals(fe)||(o=r,void 0===D&&pe(o),W?.(r.isEmpty()?null:g(B,r)),void 0===D&&Ee(r,t)),r}var o;return fe},Re=(()=>{const e=d.useRef(0),t=()=>{u.cancel(e.current)};return d.useEffect(()=>t,[]),n=>{t(),e.current=u(()=>{n()})}})(),De=e=>{if(Se(),ve.current=e,ye(e),!ue.current){const t=me(e),r=n(t);r.isNaN()||Ie(r,!0)}z?.(e),Re(()=>{let t=e;H||(t=e.replace(/ã€‚/g,".")),t!==e&&De(t)})},Oe=i((e,t)=>{if(e&&xe||!e&&Ne)return;oe.current=!1;let r=n(le.current?v(I):I);e||(r=r.negate());const s=(fe||n(0)).add(r.toString()),a=Ie(s,!1);Y?.(g(B,a),{offset:le.current?v(I):I,type:e?"up":"down",emitter:t}),ie.current?.focus()}),Te=e=>{const t=n(me(ge));let r;r=t.isNaN()?Ie(fe,e):Ie(t,e),void 0!==D?Ee(fe,!1):r.isNaN()||Ee(r,!1)};d.useEffect(()=>{if(q&&se){const e=e=>{Oe(e.deltaY<0,"wheel"),e.preventDefault()},t=ie.current;if(t)return t.addEventListener("wheel",e,{passive:!1}),()=>t.removeEventListener("wheel",e)}});f(()=>{fe.isInvalidate()||Ee(fe,!1)},[P,K]),f(()=>{const e=n(D);pe(e);const t=n(me(ge));e.equals(t)&&oe.current&&!K||Ee(e,oe.current)},[D]),f(()=>{K&&$e()},[ge]);const ke={prefixCls:M,onStep:Oe,className:S?.action,style:$?.action},Ue=d.createElement(m,b({},ke,{action:"up",disabled:xe}),k),je=d.createElement(m,b({},ke,{action:"down",disabled:Ne}),U);return d.createElement("div",{ref:ce,className:p(M,`${M}-mode-${h}`,x,S?.root,{[`${M}-focused`]:se,[`${M}-disabled`]:O,[`${M}-readonly`]:T,[`${M}-not-a-number`]:fe.isNaN(),[`${M}-out-of-range`]:!fe.isInvalidate()&&!Ce(fe)}),style:{...$?.root,...N},onMouseDown:e=>{ie.current&&e.target!==ie.current&&(ie.current.focus(),e.preventDefault()),G?.(e)},onMouseUp:Q,onMouseLeave:X,onMouseMove:Z,onMouseEnter:ee,onMouseOut:te,onClick:J,onFocus:()=>{ae(!0)},onBlur:()=>{ne&&Te(!1),ae(!1),oe.current=!1},onKeyDown:e=>{const{key:t,shiftKey:n}=e;oe.current=!0,le.current=n,"Enter"===t&&(ue.current||(oe.current=!1),Te(!1),F?.(e)),!1!==j&&!ue.current&&["Up","ArrowUp","Down","ArrowDown"].includes(t)&&(Oe("Up"===t||"ArrowUp"===t,"keyboard"),e.preventDefault())},onKeyUp:()=>{oe.current=!1,le.current=!1},onCompositionStart:()=>{ue.current=!0},onCompositionEnd:()=>{ue.current=!1,De(ie.current.value)},onBeforeInput:()=>{oe.current=!0}},"spinner"===h&&L&&je,void 0!==_&&d.createElement("div",{className:p(`${M}-prefix`,S?.prefix),style:$?.prefix},_),d.createElement("input",b({autoComplete:"off",role:"spinbutton","aria-valuemin":w,"aria-valuemax":C,"aria-valuenow":fe.isInvalidate()?null:fe.toString(),step:I,ref:ie,className:p(`${M}-input`,S?.input),style:$?.input,value:ge,onChange:e=>{De(e.target.value)},disabled:O,readOnly:T},re)),void 0!==A&&d.createElement("div",{className:p(`${M}-suffix`,S?.suffix),style:$?.suffix},A),"spinner"===h&&L&&Ue,"input"===h&&L&&d.createElement("div",{className:p(`${M}-actions`,S?.actions),style:$?.actions},Ue,je))});export{E as I};
