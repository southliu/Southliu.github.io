import{r as e,j as l}from"./react@19.1.0.BqYkxQ4a.js";import{t,u as r}from"./index.DqdG1Ldn.js";import{r as n}from"./react-resizable@3.0.5_react-dom@19.1.0_react@19.1.0.CjIiXov6.js";import{l as o}from"./lodash@4.17.21.DKG1Wmz_.js";import{u as i}from"./react-i18next@15.4.1_i18next@25.0.0_react-dom@19.1.0_react@19.1.0.Bl-q5qCL.js";import{w as s,B as a,C as c,x as d,s as u,y as h,T as p}from"./antd@5.24.7_react-dom@19.1.0_react@19.1.0.BhRsVBXN.js";import{m as g,n as f,e as m}from"./@ant-design_icons@6.0.0_react-dom@19.1.0_react@19.1.0.gU-S5sUu.js";function v(e){switch(e){case"large":return 54;case"middle":return 46;default:return 38}}function x(e){for(let l=0;l<(null==e?void 0:e.length);l++){const r=e[l];void 0===r.ellipsis&&(r.ellipsis=!0),r.render||(r.render=e=>e||(0===e?e:t))}return e}function b(e){const{onResize:t,width:r,...o}=e;return r?l.jsx(n.Resizable,{width:r,height:0,handle:l.jsx("span",{className:"react-resizable-handle",onClick:e=>{e.stopPropagation()}}),onResize:t,draggableOpts:{enableUserSelectHack:!1},children:l.jsx("th",{...o})}):l.jsx("th",{...o})}function w(e,l){switch(l.type){case"changeScroll":let t=l.curScrollTop||0,r=l.scrollHeight||0;const n=l.tableScrollY||0;return r<=0&&(r=0),0!==r&&n===e.tableScrollY&&(r=e.scrollHeight),e.scrollHeight&&t>e.scrollHeight&&(t=e.scrollHeight),{...e,curScrollTop:t,scrollHeight:r,tableScrollY:n};case"reset":return{...e,curScrollTop:0,scrollHeight:0};default:throw new Error("表格：未知错误类型!")}}function j(e){return"number"==typeof e&&isFinite(e)}const y=e.createContext({dispatch:void 0,renderLen:1,start:0,offsetStart:0,rowHeight:46,totalLen:0});function H(t){const{children:r,...n}=t,{renderLen:o,start:i,offsetStart:s}=e.useContext(y);let a=null;if(r&&null!==r){const e=null==r?void 0:r[1];a=Array.isArray(e)&&e.length?[null==r?void 0:r[0],e.slice(i,i+o).map((e=>Array.isArray(e)?e[0]:e))]:r}return l.jsx("tbody",{...n,style:{transform:`translateY(-${s}px)`},children:a})}const S={rowHeight:38,curScrollTop:0,scrollHeight:0,tableScrollY:0};let C=0;function N(t){var r,n,i,s,a;const{style:c,children:d,...u}=t,{width:h,...p}=c,[g,f]=e.useReducer(w,S),m=e.useRef(null),v=e.useRef(null),[x,b]=e.useState((null==(i=null==(n=null==(r=null==d?void 0:d[2])?void 0:r.props)?void 0:n.data)?void 0:i.length)??0);e.useEffect((()=>{var e,l,t,r,n,o;j(null==(t=null==(l=null==(e=null==d?void 0:d[1])?void 0:e.props)?void 0:l.data)?void 0:t.length)&&b(null==(o=null==(n=null==(r=null==d?void 0:d[1])?void 0:r.props)?void 0:n.data)?void 0:o.length)}),[d]);const H=e.useMemo((()=>{let e="auto";return g.rowHeight&&x&&(e=g.rowHeight*x),e}),[g.rowHeight,x]);let N=0;N="string"==typeof C?null==(a=null==(s=m.current)?void 0:s.parentNode)?void 0:a.offsetHeight:C,j(H)&&Number(H)<N&&(N=H),N<=0&&(N=0);const T=e.useMemo((()=>{let e=1;if(g.rowHeight&&x&&N)if(N<=0)e=0;else{const l=5+(N/g.rowHeight|0);e=l>x?x:l}return e}),[g.rowHeight,x,N]);let k=g.rowHeight?g.curScrollTop/g.rowHeight|0:0,z=g.rowHeight?g.curScrollTop%g.rowHeight:0;g.curScrollTop&&g.rowHeight&&g.curScrollTop>g.rowHeight?k>x-T?z=0:k>1&&(k-=1,z+=g.rowHeight):k=0,e.useEffect((()=>{var e;const l=null==(e=m.current)?void 0:e.parentNode;l&&(l.scrollTop=0),f({type:"reset"})}),[x]);const E=o.throttle((e=>{var l,t;const r=(null==(l=null==e?void 0:e.target)?void 0:l.scrollTop)??0;if(r!==g.curScrollTop){const l=(null==(t=null==e?void 0:e.target)?void 0:t.scrollHeight)-N;f({type:"changeScroll",curScrollTop:r,scrollHeight:l,tableScrollY:N})}}),60);return e.useEffect((()=>{var e;const l=null==(e=null==m?void 0:m.current)?void 0:e.parentNode;return l&&l.addEventListener("scroll",(e=>E(e))),()=>{l.removeEventListener("scroll",(e=>E(e)))}}),[m,g.curScrollTop,N,g.scrollHeight,E]),l.jsx("div",{className:"virtualTable",ref:m,style:{width:"100%",position:"relative",height:H,boxSizing:"border-box",paddingTop:g.curScrollTop},children:l.jsx(y.Provider,{value:{dispatch:f,rowHeight:g.rowHeight,start:k,offsetStart:z,renderLen:T,totalLen:x},children:l.jsx("table",{...u,ref:v,style:{...p,width:h,position:"relative"},children:d})})})}function T(t){const{columns:r,className:n,getTableChecks:o}=t,{t:h}=i(),[p,f]=e.useState(!1),[m,v]=e.useState([]),[x,b]=e.useState([]),w=m.length===x.length,j=x.length>0&&x.length<m.length,y={...t};delete y.getTableChecks,e.useEffect((()=>{S(r)}),[r]);const H=()=>{f(!p)},S=e=>{if(!(null==e?void 0:e.length))return[];const l=[],t=[];for(let r=0;r<(null==e?void 0:e.length);r++){const n=e[r],{dataIndex:o}=n;!n.hidden&&o&&(null==t||t.push(o)),l.push({label:n.title,value:o})}v(l),b(t)},C=e=>{b(e)},N=()=>{if(!(null==x?void 0:x.length))return u.warning({content:h("public.checkAllWarning"),key:"filter"});H(),o(x)},T=e=>{const l=e.target.checked?m.map((e=>e.value)):[];b(l)};return l.jsx(s,{content:()=>l.jsxs("div",{className:"min-w-130px flex flex-col",children:[l.jsx(c,{className:"!px-12px",indeterminate:j,onChange:T,checked:w,children:h("public.checkAll")}),l.jsx(c.Group,{className:"flex flex-col !px-12px",value:x,onChange:C,children:null==m?void 0:m.map((e=>l.jsx("div",{children:l.jsx(c,{value:e.value,children:e.label})},e.value)))}),l.jsx(d,{className:"!mt-10px !mb-5px"}),l.jsxs("div",{className:"flex justify-end px-10px",children:[l.jsx(a,{size:"small",className:"mr-5px",onClick:H,children:"取消"}),l.jsx(a,{type:"primary",size:"small",onClick:N,children:"筛选"})]})]}),trigger:"click",placement:"bottom",styles:{body:{padding:"12px 0 10px"}},open:p,onOpenChange:H,children:l.jsx("div",{...y,className:`${n} inline-block`,children:l.jsx(a,{icon:l.jsx(g,{}),className:"small-btn",children:h("public.columnFilter")})})})}function k(n){const{isLoading:o,isVirtual:s,isCreate:c,isZebra:d=!0,isBordered:g=!0,isOperate:w=!0,isAuthHeight:j,scrollX:y,scrollY:k,rowClassName:z,size:E,leftContent:R,rightContent:_,getPage:A,onCreate:L}=n,{t:Y}=i(),{isPhone:$}=r(),[B]=function(){const[l,t]=e.useState(!0);return[(e,r)=>{if(!(null==r?void 0:r.length)||!(null==e?void 0:e.length))return e||[];if(l)return t(!1),e||[];for(let l=0;l<(null==e?void 0:e.length);l++){const t=e[l];t.hidden=!r.includes(t.dataIndex)}return e}]}(),[P,M]=e.useState(x(n.columns)),W=e.useRef(null),[F,I]=e.useState([]);e.useEffect((()=>{M(x(n.columns))}),[n.columns]),e.useEffect((()=>{c&&!L&&u.warning(Y("public.createMethodWarning"))}),[c]),e.useEffect((()=>{w&&!A&&u.warning(Y("public.getPageWarning"))}),[A]);const O=function(e){var l,t;const r=document.documentElement.clientHeight||document.body.clientHeight,n=(null==(t=null==(l=null==e?void 0:e.getBoundingClientRect)?void 0:l.call(e))?void 0:t.top)||0,o=document.getElementById("pagination"),i=r-n-((null==o?void 0:o.offsetHeight)||0);return i>0?i-65:450}(W.current),K=e=>(l,{size:t})=>{const r=[...P];r[e]={...r[e],width:t.width},M(r)},D=function(e){const{height:l,size:t}=e;return C=l,S.rowHeight=v(t),{table:N,body:{wrapper:H}}}({height:O,size:E||"small"}),G=e.useMemo((()=>({header:{cell:b},body:{wrapper:D.body.wrapper},table:D.table})),[D]),U=s?G:{header:{cell:b}},V={...n.scroll,x:y??"max-content",y:k??(j?O:void 0)};return l.jsxs("div",{id:"table",className:`\n        overflow-auto\n        ${!1!==g?"bordered":""}\n        ${!1!==d?"zebra":""}\n      `,children:[w&&l.jsxs("div",{className:"flex justify-between !mb-10px",children:[l.jsxs("div",{className:"flex flex-wrap items-center gap-6px",children:[!!c&&l.jsx(a,{type:"primary",className:"small-btn",icon:l.jsx(f,{}),onClick:L,children:Y("public.create")}),R]}),l.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-6px",children:[_?l.jsx("div",{children:_}):void 0,l.jsx(a,{className:"small-btn",icon:l.jsx(m,{className:"transform rotate-270",disabled:!!o}),onClick:A,children:Y("public.refresh")}),l.jsx(T,{columns:P,getTableChecks:e=>{I(e)}})]})]}),l.jsx("div",{ref:W,children:l.jsx(h,{size:"small",rowKey:"id",pagination:!1,loading:o,...n,rowClassName:(e,l,t)=>`${("string"==typeof z?z:null==z?void 0:z(e,l,t))||""} ${`!h-${v(E)}px`}`,style:{borderRadius:10,borderRight:"1px solid rgba(0, 0, 0, .05)",borderBottom:"1px solid rgba(0, 0, 0, .05)",overflow:"auto",...n.style},bordered:!1!==g,scroll:V,components:U,columns:(()=>{const e=B(P,F);if(!e)return[];return e.map(((e,r)=>({...e,ellipsis:e.ellipsis??!0,fixed:!(!(null==e?void 0:e.fixed)||$&&!(null==e?void 0:e.isKeepFixed))&&e.fixed,onHeaderCell:(l,t)=>{var n;return{...null==(n=null==e?void 0:e.onHeaderCell)?void 0:n.call(e,l,t),width:e.width,onResize:K(r)}},onCell:(l,t)=>{var r,n,o;return{...null==(r=null==e?void 0:e.onCell)?void 0:r.call(e,l,t),style:{...null==(o=null==(n=null==e?void 0:e.onCell)?void 0:n.call(e,l,t))?void 0:o.style,maxWidth:e.width,width:e.width}}},render:(r,n,o)=>{var i;const s=null==(i=null==e?void 0:e.render)?void 0:i.call(e,r,n,o);let a,c=s;const d=null==e?void 0:e.enum;if(d&&"object"==typeof d)if(Array.isArray(d))for(let e=0;e<(null==d?void 0:d.length);e++){const l=d[e];if(String(l.value)===String(c)){c=l.label,a=l.color;break}}else for(const e in d)if(e===String(c)){c=d[e];break}return["object","function"].includes(typeof s)?s:l.jsx(p,{title:c,placement:"topLeft",children:l.jsx("span",{style:{color:a},className:"break-all",title:c,children:String(c??t)})})}})))})()})})]})}export{k as B};
