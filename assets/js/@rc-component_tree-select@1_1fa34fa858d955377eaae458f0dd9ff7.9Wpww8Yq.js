import{t as e,b as t,u as l,e as n,K as r,f as a,d as o}from"./@rc-component_util@1.4.0_re_a8b68d4fbe51b122ded4cf0ecf2ca619.D3_e-sfJ.js";import{u as s,B as c}from"./@rc-component_select@1.2.7__74ed97d747dedabe4414d1f4ea394a59.wDk9W6qW.js";import{r as i}from"./react@19.2.1.BpVBN_43.js";import{a as u,c as d,U as p,T as f}from"./@rc-component_tree@1.0.2_re_2bf9ae000d6effb62cf123da5373636b.B8saYfiW.js";import"./react-dom@19.2.1_react@19.2.1.BLi5rGn2.js";import"./@rc-component_resize-observ_eaaccb47489da2719f35257c4ad9d3c9.BynXlAVv.js";import"./@rc-component_motion@1.1.6__0afcbe001b0ce065bd610efbbf939bf0.BsUikez1.js";import"./rc-overflow@1.5.0_react-dom_ed71e382df4fb2eccbb1a2ad50316608.CUEIhwYs.js";const h=e=>!e||e.disabled||e.disableCheckbox||!1===e.checkable,m=e=>null==e,v=()=>null;function b(t){return e(t).map(e=>{if(!i.isValidElement(e)||!e.type)return null;const{key:t,props:{children:l,value:n,...r}}=e,a={key:t,value:n,...r},o=b(l);return o.length&&(a.children=o),a}).filter(e=>e)}function y(e){if(!e)return e;const l={...e};return"props"in l||Object.defineProperty(l,"props",{get:()=>(t(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),l)}),l}function g(e){const t=i.useRef();t.current=e;return i.useCallback((...e)=>t.current(...e),[])}function C(e,t,l){return i.useMemo(()=>{if(e){if(l){const t={id:"id",pId:"pId",rootPId:null,..."object"==typeof l?l:{}};return function(e,t){const{id:l,pId:n,rootPId:r}=t,a=new Map,o=[];return e.forEach(e=>{const t=e[l],n={...e,key:e.key||t};a.set(t,n)}),a.forEach(e=>{const t=e[n],l=a.get(t);l?(l.children=l.children||[],l.children.push(e)):t!==r&&null!==r||o.push(e)}),o}(e,t)}return e}return b(t)},[t,l,e])}const S=i.createContext(null),k=i.createContext(null);function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e},E.apply(this,arguments)}const w={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},N=(e,t)=>{const{prefixCls:a,multiple:o,searchValue:c,toggleOpen:u,open:d,notFoundContent:m}=s(),{virtual:v,listHeight:b,listItemHeight:y,listItemScrollOffset:g,treeData:C,fieldNames:N,onSelect:x,popupMatchSelectWidth:M,treeExpandAction:V,treeTitleRender:O,onPopupScroll:P,leftMaxCount:T,leafCountOnly:I,valueEntities:D,classNames:L,styles:_}=i.useContext(k),{checkable:K,checkedKeys:H,halfCheckedKeys:j,treeExpandedKeys:R,treeDefaultExpandAll:A,treeDefaultExpandedKeys:W,onTreeExpand:F,treeIcon:U,showTreeIcon:$,switcherIcon:z,treeLine:G,treeNodeFilterProp:B,loadData:J,treeLoadedKeys:q,treeMotion:Q,onTreeLoad:X,keyEntities:Y}=i.useContext(S),Z=i.useRef(),ee=l(()=>C,[d,C],(e,t)=>t[0]&&e[1]!==t[1]),te=i.useMemo(()=>K?{checked:H,halfChecked:j}:null,[K,H,j]);i.useEffect(()=>{d&&!o&&H.length&&Z.current?.scrollTo({key:H[0]})},[d]);const le=e=>{e.preventDefault()},ne=(e,t)=>{const{node:l}=t;K&&h(l)||(x(l.key,{selected:!H.includes(l.key)}),o||u(!1))},[re,ae]=i.useState(W),[oe,se]=i.useState(null),ce=i.useMemo(()=>R?[...R]:c?oe:re,[re,oe,R,c]),ie=String(c).toLowerCase(),ue=e=>!!ie&&String(e[B]).toLowerCase().includes(ie);i.useEffect(()=>{c&&se(((e,t)=>{const l=[],n=e=>{e.forEach(e=>{const r=e[t.children];r&&(l.push(e[t.value]),n(r))})};return n(e),l})(C,N))},[c]);const[de,pe]=i.useState(()=>new Map);i.useEffect(()=>{T&&pe(new Map)},[T]);const fe=n(e=>{const t=e[N.value];return!H.includes(t)&&(null!==T&&(T<=0||!(!I||!T)&&function(e){const t=e[N.value];if(!de.has(t)){const e=D.get(t);if(0===(e.children||[]).length)de.set(t,!1);else{const l=e.children.filter(e=>!e.node.disabled&&!e.node.disableCheckbox&&!H.includes(e.node[N.value])).length;de.set(t,l>T)}}return de.get(t)}(e)))}),he=e=>{for(const t of e)if(!t.disabled&&!1!==t.selectable){if(!c)return t;if(ue(t))return t;if(t[N.children]){const e=he(t[N.children]);if(e)return e}}return null},[me,ve]=i.useState(null),be=Y[me];i.useEffect(()=>{if(!d)return;let e=null;e=o||!H.length||c?(()=>{const e=he(ee);return e?e[N.value]:null})():H[0],ve(e)},[d,c]),i.useImperativeHandle(t,()=>({scrollTo:Z.current?.scrollTo,onKeyDown:e=>{const{which:t}=e;switch(t){case r.UP:case r.DOWN:case r.LEFT:case r.RIGHT:Z.current?.onKeyDown(e);break;case r.ENTER:if(be){const e=fe(be.node),{selectable:t,value:l,disabled:n}=be?.node||{};!1===t||n||e||ne(0,{node:{key:me},selected:!H.includes(l)})}break;case r.ESC:u(!1)}},onKeyUp:()=>{}}));const ye=l(()=>!c,[c,R||re],([e],[t,l])=>e!==t&&!(!t&&!l))?J:null;if(0===ee.length)return i.createElement("div",{role:"listbox",className:`${a}-empty`,onMouseDown:le},m);const ge={fieldNames:N};return q&&(ge.loadedKeys=q),ce&&(ge.expandedKeys=ce),i.createElement("div",{onMouseDown:le},be&&d&&i.createElement("span",{style:w,"aria-live":"assertive"},be.node.value),i.createElement(p.Provider,{value:{nodeDisabled:fe}},i.createElement(f,E({classNames:L?.popup,styles:_?.popup,ref:Z,focusable:!1,prefixCls:`${a}-tree`,treeData:ee,height:b,itemHeight:y,itemScrollOffset:g,virtual:!1!==v&&!1!==M,multiple:o,icon:U,showIcon:$,switcherIcon:z,showLine:G,loadData:ye,motion:Q,activeKey:me,checkable:K,checkStrictly:!0,checkedKeys:te,selectedKeys:K?[]:H,defaultExpandAll:A,titleRender:O},ge,{onActiveChange:ve,onSelect:ne,onCheck:ne,onExpand:e=>{ae(e),se(e),F&&F(e)},onLoad:X,filterTreeNode:ue,expandAction:V,onScroll:P}))))},x=i.forwardRef(N),M="SHOW_ALL",V="SHOW_PARENT",O="SHOW_CHILD";function P(e,t,l,n){const r=new Set(e);return t===O?e.filter(e=>{const t=l[e];return!(t&&t.children&&t.children.some(({node:e})=>r.has(e[n.value]))&&t.children.every(({node:e})=>h(e)||r.has(e[n.value])))}):t===V?e.filter(e=>{const t=l[e],n=t?t.parent:null;return!n||h(n.node)||!r.has(n.key)}):e}function T(){return T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e},T.apply(this,arguments)}const I=i.forwardRef((e,l)=>{const{id:n,prefixCls:r="rc-tree-select",value:s,defaultValue:p,onChange:f,onSelect:h,onDeselect:b,showSearch:E,searchValue:w,inputValue:N,onSearch:V,autoClearSearchValue:I,filterTreeNode:D,treeNodeFilterProp:L,showCheckedStrategy:_,treeNodeLabelProp:K,multiple:H,treeCheckable:j,treeCheckStrictly:R,labelInValue:A,maxCount:W,fieldNames:F,treeDataSimpleMode:U,treeData:$,children:z,loadData:G,treeLoadedKeys:B,onTreeLoad:J,treeDefaultExpandAll:q,treeExpandedKeys:Q,treeDefaultExpandedKeys:X,onTreeExpand:Y,treeExpandAction:Z,virtual:ee,listHeight:te=200,listItemHeight:le=20,listItemScrollOffset:ne=0,onPopupVisibleChange:re,popupMatchSelectWidth:ae=!0,treeLine:oe,treeIcon:se,showTreeIcon:ce,switcherIcon:ie,treeMotion:ue,treeTitleRender:de,onPopupScroll:pe,classNames:fe,styles:he,...me}=e,ve=a(n),be=j&&!R,ye=j||R,ge=R||A,Ce=ye||H,Se={searchValue:w,inputValue:N,onSearch:V,autoClearSearchValue:I,filterTreeNode:D,treeNodeFilterProp:L},[ke,Ee]=function(e,t){const{searchValue:l,inputValue:n,onSearch:r,autoClearSearchValue:a,filterTreeNode:o,treeNodeFilterProp:s}=t;return i.useMemo(()=>{const t="object"==typeof e,c={searchValue:l??n,onSearch:r,autoClearSearchValue:a,filterTreeNode:o,treeNodeFilterProp:s,...t?e:{}};return[!!t||e,c]},[e,l,n,r,a,o,s])}(E,Se),{searchValue:we,onSearch:Ne,autoClearSearchValue:xe=!0,filterTreeNode:Me,treeNodeFilterProp:Ve="value"}=Ee,[Oe,Pe]=o(p,s),Te=i.useMemo(()=>j?_||O:M,[_,j]),Ie=i.useMemo(()=>(e=>{const{label:t,value:l,children:n}=e||{};return{_title:t?[t]:["title","label"],value:l||"value",key:l||"value",children:n||"children"}})(F),[JSON.stringify(F)]),[De,Le]=o("",we),_e=De||"",Ke=C($,z,U),{keyEntities:He,valueEntities:je}=((e,t)=>i.useMemo(()=>d(e,{fieldNames:t,initWrapper:e=>({...e,valueEntities:new Map}),processEntity:(e,l)=>{const n=e.node[t.value];l.valueEntities.set(n,e)}}),[e,t]))(Ke,Ie),Re=i.useCallback(e=>{const t=[],l=[];return e.forEach(e=>{je.has(e)?l.push(e):t.push(e)}),{missingRawValues:t,existRawValues:l}},[je]),Ae=((e,t,l)=>{const{fieldNames:n,treeNodeFilterProp:r,filterTreeNode:a}=l,{children:o}=n;return i.useMemo(()=>{if(!t||!1===a)return e;const l="function"==typeof a?a:(e,l)=>String(l[r]).toUpperCase().includes(t.toUpperCase()),n=(e,r=!1)=>e.reduce((e,a)=>{const s=a[o],c=r||l(t,y(a)),i=n(s||[],c);return(c||i.length)&&e.push({...a,isLeaf:void 0,[o]:i}),e},[]);return n(e)},[e,t,o,r,a])})(Ke,_e,{fieldNames:Ie,treeNodeFilterProp:Ve,filterTreeNode:Me}),We=i.useCallback(e=>{if(e){if(K)return e[K];const{_title:t}=Ie;for(let l=0;l<t.length;l+=1){const n=e[t[l]];if(void 0!==n)return n}}},[Ie,K]),Fe=i.useCallback(e=>{const t=(e=>Array.isArray(e)?e:void 0!==e?[e]:[])(e);return t.map(e=>function(e){return!e||"object"!=typeof e}(e)?{value:e}:e)},[]),Ue=i.useCallback(e=>Fe(e).map(e=>{let{label:t}=e;const{value:l,halfChecked:n}=e;let r;const a=je.get(l);if(a)t=de?de(a.node):t??We(a.node),r=a.node.disabled;else if(void 0===t){t=Fe(Oe).find(e=>e.value===l).label}return{label:t,value:l,halfChecked:n,disabled:r}}),[je,We,Fe,Oe]),$e=i.useMemo(()=>Fe(null===Oe?[]:Oe),[Fe,Oe]),[ze,Ge]=i.useMemo(()=>{const e=[],t=[];return $e.forEach(l=>{l.halfChecked?t.push(l):e.push(l)}),[e,t]},[$e]),Be=i.useMemo(()=>ze.map(e=>e.value),[ze]),[Je,qe]=((e,t,l,n)=>i.useMemo(()=>{const r=e=>e.map(({value:e})=>e),a=r(e),o=r(t),s=a.filter(e=>!n[e]);let c=a,i=o;if(l){const e=u(a,!0,n);c=e.checkedKeys,i=e.halfCheckedKeys}return[Array.from(new Set([...s,...c])),i]},[e,t,l,n]))(ze,Ge,be,He),Qe=i.useMemo(()=>{const e=P(Je,Te,He,Ie).map(e=>He[e]?.node?.[Ie.value]??e).map(e=>{const t=ze.find(t=>t.value===e),l=A?t?.label:de?.(t);return{value:e,label:l}}),t=Ue(e),l=t[0];return!Ce&&l&&m(l.value)&&m(l.label)?[]:t.map(e=>({...e,label:e.label??e.value}))},[Ie,Ce,Je,ze,Ue,Te,He]),[Xe]=(e=>{const t=i.useRef({valueLabels:new Map});return i.useMemo(()=>{const{valueLabels:l}=t.current,n=new Map,r=e.map(e=>{const{value:t,label:r}=e,a=r??l.get(t);return n.set(t,a),{...e,label:a}});return t.current.valueLabels=n,[r]},[e])})(Qe),Ye=i.useMemo(()=>!Ce||"SHOW_CHILD"!==Te&&!R&&j?null:W,[W,Ce,R,Te,j]),Ze=g((e,l,n)=>{const r=P(e,Te,He,Ie);if(Ye&&r.length>Ye)return;const a=Ue(e);if(Pe(a),xe&&Le(""),f){let a=e;be&&(a=r.map(e=>{const t=je.get(e);return t?t.node[Ie.value]:e}));const{triggerValue:o,selected:s}=l||{triggerValue:void 0,selected:void 0};let c=a;if(R){const e=Ge.filter(e=>!a.includes(e.value));c=[...c,...e]}const u=Ue(c),d={preValue:ze,triggerValue:o};let p=!0;(R||"selection"===n&&!s)&&(p=!1),function(e,l,n,r,a,o){let s=null,c=null;function u(){c||(c=[],function e(t,r="0",a=!1){return t.map((t,u)=>{const d=`${r}-${u}`,p=t[o.value],f=n.includes(p),h=e(t[o.children]||[],d,f),m=i.createElement(v,t,h.map(e=>e.node));if(l===p&&(s=m),f){const e={pos:d,node:m,children:h};return a||c.push(e),e}return null}).filter(e=>e)}(r),c.sort(({node:{props:{value:e}}},{node:{props:{value:t}}})=>n.indexOf(e)-n.indexOf(t)))}Object.defineProperty(e,"triggerNode",{get:()=>(t(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),u(),s)}),Object.defineProperty(e,"allCheckedNodes",{get:()=>(t(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),u(),a?c:c.map(({node:e})=>e))})}(d,o,e,Ke,p,Ie),ye?d.checked=s:d.selected=s;const h=ge?u:u.map(e=>e.value);f(Ce?h:h[0],ge?null:u.map(e=>e.label),d)}}),et=i.useCallback((e,{selected:t,source:l})=>{const n=He[e],r=n?.node,a=r?.[Ie.value]??e;if(Ce){let e=t?[...Be,a]:Je.filter(e=>e!==a);if(be){const{missingRawValues:l,existRawValues:n}=Re(e),r=n.map(e=>je.get(e).key);let a;({checkedKeys:a}=u(r,!!t||{halfCheckedKeys:qe},He)),e=[...l,...a.map(e=>He[e].node[Ie.value])]}Ze(e,{selected:t,triggerValue:a},l||"option")}else Ze([a],{selected:!0,triggerValue:a},"option");t||!Ce?h?.(a,y(r)):b?.(a,y(r))},[Re,je,He,Ie,Ce,Be,Ze,be,h,b,Je,qe,W]),tt=i.useCallback(e=>{re&&re(e)},[re]),lt=g((e,t)=>{const l=e.map(e=>e.value);"clear"!==t.type?t.values.length&&et(t.values[0].value,{selected:!1,source:"selection"}):Ze(l,{},"selection")}),nt=i.useMemo(()=>({virtual:ee,popupMatchSelectWidth:ae,listHeight:te,listItemHeight:le,listItemScrollOffset:ne,treeData:Ae,fieldNames:Ie,onSelect:et,treeExpandAction:Z,treeTitleRender:de,onPopupScroll:pe,leftMaxCount:void 0===W?null:W-Xe.length,leafCountOnly:"SHOW_CHILD"===Te&&!R&&!!j,valueEntities:je,classNames:fe,styles:he}),[ee,ae,te,le,ne,Ae,Ie,et,Z,de,pe,W,Xe.length,Te,R,j,je,fe,he]),rt=i.useMemo(()=>({checkable:ye,loadData:G,treeLoadedKeys:B,onTreeLoad:J,checkedKeys:Je,halfCheckedKeys:qe,treeDefaultExpandAll:q,treeExpandedKeys:Q,treeDefaultExpandedKeys:X,onTreeExpand:Y,treeIcon:se,treeMotion:ue,showTreeIcon:ce,switcherIcon:ie,treeLine:oe,treeNodeFilterProp:Ve,keyEntities:He}),[ye,G,B,J,Je,qe,q,Q,X,Y,se,ue,ce,ie,oe,Ve,He]);return i.createElement(k.Provider,{value:nt},i.createElement(S.Provider,{value:rt},i.createElement(c,T({ref:l},me,{classNames:fe,styles:he,id:ve,prefixCls:r,mode:Ce?"multiple":void 0,displayValues:Xe,onDisplayValuesChange:lt,autoClearSearchValue:xe,showSearch:ke,searchValue:_e,onSearch:e=>{Le(e),Ne?.(e)},OptionList:x,emptyOptions:!Ke.length,onPopupVisibleChange:tt,popupMatchSelectWidth:ae}))))});I.TreeNode=v,I.SHOW_ALL=M,I.SHOW_PARENT=V,I.SHOW_CHILD=O;export{I as G,M as S,v as T,V as a,O as b};
