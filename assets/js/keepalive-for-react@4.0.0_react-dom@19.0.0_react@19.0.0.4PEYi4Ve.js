import{r as e,j as t}from"./react@19.0.0.C56gzhl-.js";import{r}from"./react-dom@19.0.0_react@19.0.0.BNMklCqC.js";function n(e){return null==e}function c(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function s(e){return Array.isArray(e)}function i(e){return"function"==typeof e}function o(e){return{set:(t,r)=>(e.setAttribute(t,r),o(e))}}function a(e=100){let t;return new Promise(((r,c)=>{t=setTimeout((()=>{r(),n(t)||clearTimeout(t)}),e)}))}function u(e,t){return(s(e)?e:n(e)?[]:[e]).some((e=>c(e)?e.test(t):t===e))}function l(e){setTimeout(e,0)}const d=e.createContext({active:!1,refresh:()=>{},destroy:()=>Promise.resolve(),destroyAll:()=>Promise.resolve(),destroyOther:()=>Promise.resolve(),getCacheNodes:()=>[]}),f=e.memo((function(r){const{children:n,active:c,refresh:s,destroy:i,destroyAll:o,destroyOther:a,getCacheNodes:u}=r,l=e.useMemo((()=>({active:c,refresh:s,destroy:i,destroyAll:o,destroyOther:a,getCacheNodes:u})),[c,s,i,o,a,u]);return t.jsx(d.Provider,{value:l,children:n})}));function m(e){return e?Array.from(e.children):[]}function h(e){e.forEach((e=>{e.remove()}))}function v(e,t){h(m(e)),e.appendChild(t),t.classList.remove("inactive"),t.classList.add("active")}function y(e,t){const r=m(e).filter((e=>e.classList.contains("active")&&e.getAttribute("data-cache-key")!==t));return r.forEach((e=>{e.classList.remove("active"),e.classList.add("inactive")})),r}"function"==typeof SuppressedError&&SuppressedError;const C=e.memo((function(n){const{errorElement:c=e.Fragment,cacheNodeClassName:s,children:i,cacheKey:l,exclude:d,include:f}=n,{active:m,renderCount:C,destroy:p,transition:x,viewTransition:g,duration:A,containerDivRef:T}=n,j=e.useRef(!1);j.current=j.current||m;const N=e.useMemo((()=>{const e=document.createElement("div");return o(e).set("data-cache-key",l).set("style","height: 100%").set("data-render-count",C.toString()),e.className=s,e}),[C,s]);return e.useEffect((()=>{const e=(r=l,n=d,(c=f)?u(c,r):!n||!u(n,r)),t=T.current;var r,n,c;if(t)if(x)(()=>{!function(e,t,r,n){new(r||(r=Promise))((function(t,c){function s(e){try{o(n.next(e))}catch(t){c(t)}}function i(e){try{o(n.throw(e))}catch(t){c(t)}}function o(e){var n;e.done?t(e.value):(n=e.value,n instanceof r?n:new r((function(e){e(n)}))).then(s,i)}o((n=n.apply(e,[])).next())}))}(this,0,void 0,(function*(){if(m){const e=y(t,l);if(yield a(A-40),h(e),t.contains(N))return;v(t,N)}else e||(yield a(A),p(l))}))})();else if(m){const e=()=>{h(y(t,l)),t.contains(N)||v(t,N)};g&&document.startViewTransition?document.startViewTransition(e):e()}else e||p(l)}),[m,T,l,d,f]),j.current?r.createPortal(t.jsx(c,{children:i}),N,l):null}),((e,t)=>e.active===t.active&&e.renderCount===t.renderCount&&e.children===t.children&&e.exclude===t.exclude&&e.include===t.include));function p(){return e.useRef()}function x(r){const{activeCacheKey:o,max:a=10,exclude:u,include:d,onBeforeActive:m,customContainerRef:h,cacheNodeClassName:v="cache-component",containerClassName:y="keep-alive-render",errorElement:p,transition:x=!1,viewTransition:g=!1,duration:A=200,children:T,aliveRef:j,maxAliveTime:N=0}=r,b=h||e.useRef(null),[w,E]=e.useState([]);e.useLayoutEffect((()=>{var t;n(o)||(t=()=>{E((e=>{const t=Date.now();if(e.find((e=>e.cacheKey===o)))return e.map((e=>{if(e.cacheKey===o){let r=!1;if(i(m)&&m(o),N){const n=e.lastActiveTime;if(s(N)){const e=N.find((e=>c(e.match)?e.match.test(o):e.match===o));e&&(r=e&&n+1e3*e.expire<t)}else r=n+1e3*N<t}return Object.assign(Object.assign({},e),{ele:T,lastActiveTime:t,renderCount:r?e.renderCount+1:e.renderCount})}return e}));if(i(m)&&m(o),e.length>a){const t=e.reduce(((e,t)=>e.lastActiveTime<t.lastActiveTime?e:t));e.splice(e.indexOf(t),1)}return[...e,{cacheKey:o,lastActiveTime:t,ele:T,renderCount:0}]}))},i(e.startTransition)?e.startTransition(t):t())}),[o,T]);const O=e.useCallback((e=>{E((t=>{const r=e||o;return t.map((e=>e.cacheKey===r?Object.assign(Object.assign({},e),{renderCount:e.renderCount+1}):e))}))}),[E,o]),K=e.useCallback((e=>{const t=e||o,r=s(t)?t:[t];return new Promise((e=>{l((()=>{E((e=>[...e.filter((e=>!r.includes(e.cacheKey)))])),e()}))}))}),[E,o]),P=e.useCallback((()=>new Promise((e=>{l((()=>{E([]),e()}))}))),[E]),R=e.useCallback((e=>{const t=e||o;return new Promise((e=>{l((()=>{E((e=>[...e.filter((e=>e.cacheKey===t))])),e()}))}))}),[o,E]),k=e.useCallback((()=>w),[w]);return e.useImperativeHandle(j,(()=>({refresh:O,destroy:K,destroyAll:P,destroyOther:R,getCacheNodes:k}))),t.jsxs(e.Fragment,{children:[t.jsx("div",{ref:b,className:y,style:{height:"100%"}}),w.map((e=>{const{cacheKey:r,ele:n,renderCount:c}=e;return t.jsx(f,{active:o===r,refresh:O,destroy:K,destroyAll:P,destroyOther:R,getCacheNodes:k,children:t.jsx(C,{destroy:K,include:d,exclude:u,transition:x,viewTransition:g,duration:A,renderCount:c,containerDivRef:b,errorElement:p,active:o===r,cacheNodeClassName:v,cacheKey:r,children:n})},`${r}-${c}`)}))]})}const g=()=>e.useContext(d);const A=(t,r,n=!1)=>{!function(t,r,n=!1,c){const{active:s}=g(),o=e.useRef(!1);c((()=>{if(!s)return;if(n&&!o.current)return void(o.current=!0);const e=t();return()=>{i(e)&&e()}}),[s,...r])}(t,r,n,e.useEffect)};export{A as D,p as L,x as R,g as k};
