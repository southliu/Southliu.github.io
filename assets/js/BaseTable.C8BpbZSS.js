import{r as e,j as t}from"./react@19.1.1.DAMsdXqD.js";import{q as r,C as l,a as s}from"./index.DFBbr9cK.js";import{l as n}from"./lodash@4.17.21.Ck-LUJIg.js";import{r as o}from"./react-resizable@3.0.5_react_491d9cc418165db19d7b9f84b7ebd170.C8ljQ2Y_.js";import{D as a}from"./@dnd-kit_core@6.3.1_react-d_b2d5886cf71f55202ee000d74755b8d0.DwHT28Ev.js";import{C as i}from"./@dnd-kit_utilities@3.2.2_react@19.1.1.OLaQZAX8.js";import{I as c}from"./@iconify_react@6.0.1_react@19.1.1.iW61ad1V.js";import{S as d,v as u,a as h,u as p}from"./@dnd-kit_sortable@10.0.0_@d_cdf393be866ffb195b557b7b22c22bad.CKGRRMB-.js";import{C as f,n as m,B as g,o as x,T as b,s as w,p as j,q as v}from"./antd@5.27.3_react-dom@19.1.1_react@19.1.1__react@19.1.1.DCqY8qcD.js";import{u as y}from"./react-i18next@15.7.3_i18nex_bb3bf288cc63cadde28a68d34dc3eb41.Lsshil7N.js";import{o as H,p as S,e as N}from"./@ant-design_icons@6.0.1_rea_2574d57b25e1c70f5c0e11cbf4eac649.CSgGuOKE.js";function C(e){switch(e){case"large":return 62;case"middle":return 54;default:return 46}}function k(e){const t=n.cloneDeep(e);for(let l=0;l<t?.length;l++){const e=t[l];void 0===e.ellipsis&&(e.ellipsis=!0),e.render||(e.render=e=>e||(0===e?e:r))}return t}function T(e){const{onResize:r,width:l,...s}=e;return l?t.jsx(o.Resizable,{width:l,height:0,handle:t.jsx("span",{className:"react-resizable-handle",onClick:e=>{e.stopPropagation()}}),onResize:r,draggableOpts:{enableUserSelectHack:!1},children:t.jsx("th",{...s})}):t.jsx("th",{...s})}function _(e,t){switch(t.type){case"changeScroll":let r=t.curScrollTop||0,l=t.scrollHeight||0;const s=t.tableScrollY||0;return l<=0&&(l=0),0!==l&&s===e.tableScrollY&&(l=e.scrollHeight),e.scrollHeight&&r>e.scrollHeight&&(r=e.scrollHeight),{...e,curScrollTop:r,scrollHeight:l,tableScrollY:s};case"reset":return{...e,curScrollTop:0,scrollHeight:0};default:throw new Error("表格：未知错误类型!")}}const E=e.createContext({dispatch:void 0,renderLen:1,start:0,offsetStart:0,rowHeight:46,totalLen:0});function R(r){const{children:l,...s}=r,{renderLen:n,start:o,offsetStart:a}=e.useContext(E);let i=null;if(l&&null!==l){const e=l?.[1];i=Array.isArray(e)&&e.length?[l?.[0],e.slice(o,o+n).map(e=>Array.isArray(e)?e[0]:e)]:l}return t.jsx("tbody",{...s,style:{transform:`translateY(-${a}px)`},children:i})}const z={rowHeight:46,curScrollTop:0,scrollHeight:0,tableScrollY:0,total:0};let A=0;function I(r){const{style:s,children:o,...a}=r,{width:i,...c}=s,[d,u]=e.useReducer(_,z),h=e.useRef(null),p=e.useRef(null),f=z.total,m=e.useMemo(()=>{let e="auto";return d.rowHeight&&f&&(e=d.rowHeight*(f+1)),e},[d.rowHeight,f]);let g=0;g="string"==typeof A?h.current?.parentNode?.offsetHeight:A,l(m)&&Number(m)<g&&(g=m),g<=0&&(g=0);const x=e.useMemo(()=>{let e=1;if(d.rowHeight&&f&&g)if(g<=0)e=0;else{const t=5+(g/d.rowHeight|0);e=t>f?f:t}return e},[d.rowHeight,f,g]);let b=d.rowHeight?d.curScrollTop/d.rowHeight|0:0,w=d.rowHeight?d.curScrollTop%d.rowHeight:0;d.curScrollTop&&d.rowHeight&&d.curScrollTop>d.rowHeight?b>f-x?w=0:b>1&&(b-=1,w+=d.rowHeight):b=0,e.useEffect(()=>{const e=h.current?.parentNode;e&&(e.scrollTop=0),u({type:"reset"})},[f]);const j=n.throttle(e=>{const t=e?.target?.scrollTop??0;if(t!==d.curScrollTop){u({type:"changeScroll",curScrollTop:t,scrollHeight:e?.target?.scrollHeight-g,tableScrollY:g})}},60);return e.useEffect(()=>{const e=h?.current?.parentNode;return e&&e.addEventListener("scroll",e=>j(e)),()=>{e.removeEventListener("scroll",e=>j(e))}},[h,d.curScrollTop,g,d.scrollHeight,j]),t.jsx("div",{className:"virtualTable",ref:h,style:{width:"100%",position:"relative",height:m,boxSizing:"border-box",paddingTop:d.curScrollTop},children:t.jsx(E.Provider,{value:{dispatch:u,rowHeight:d.rowHeight,start:b,offsetStart:w,renderLen:x,totalLen:f},children:t.jsx("table",{...a,ref:p,style:{...c,width:i,position:"relative"},children:o})})})}function B(e){const{item:r}=e,{attributes:l,listeners:s,setNodeRef:n,transform:o,transition:a}=p({id:r.value}),d={transform:i.Transform.toString(o),transition:a};return t.jsxs("div",{ref:n,className:"\n        h-28px\n        flex\n        items-center\n        pl-5px\n        hover:bg-blue-100\n        border-rd-5px\n      ",style:d,...l,children:[t.jsx("div",{className:"h-28px pr-5px cursor-move flex items-center justify-center drag-handle",...s,children:t.jsx(c,{icon:"icon-park-outline:drag"})}),t.jsx(f,{value:r.value,className:"flex-1",children:r.label})]})}function L(e){const{list:r,handleDragEnd:l}=e;return t.jsx(a,{onDragEnd:e=>{const{active:t,over:s}=e;if(!s)return;const n=r.findIndex(e=>e.value===t.id),o=r.findIndex(e=>e.value===s.id),a=h(r,n,o);l(a)},children:t.jsx(d,{items:r.map(e=>e.value),strategy:u,children:r?.map((e,r)=>t.jsx(B,{index:r,item:e},e.value))})})}function Y(r){const{columns:l,cacheColumns:s,className:n,getTableChecks:o}=r,{t:a}=y(),[i,c]=e.useState(!1),[d,u]=e.useState([]),[h,p]=e.useState([]),b=d.length===h.length,w=h.length>0&&h.length<d.length,j={...r};delete j.getTableChecks,delete j.cacheColumns,e.useEffect(()=>{v(l)},[l]);const v=e=>{if(!e?.length)return[];const t=[],r=[];for(let l=0;l<e?.length;l++){const s=e[l],{dataIndex:n}=s;!s.hidden&&n&&r?.push(n),t.push({label:s.title,value:n})}u(t),p(r)},S=e=>{p(e),N(e)},N=(e,t=d)=>{o(e,t.map(e=>e.value))},C=e=>{const t=e.target.checked?d.map(e=>e.value):[];p(t),N(t)},k=()=>{const e=[],t=s?.map(e=>e?.dataIndex)?.filter(Boolean);for(let r=0;r<s?.length;r++){const t=s[r];e.push({label:t.title,value:t.dataIndex})}p(t),u(e),N(t,e)},T=e=>{u(e),o(h,e.map(e=>e.value))};return t.jsx(m,{content:()=>t.jsxs("div",{className:"min-w-140px flex flex-col",children:[t.jsx("div",{className:"px-5px",children:t.jsx(f,{className:"w-full !pl-10px !py-3px hover:bg-blue-100 border-rd-5px",indeterminate:w,onChange:C,checked:b,children:a("public.checkAll")})}),t.jsx(x,{className:"!my-5px"}),t.jsx(f.Group,{className:"flex flex-col !px-5px !pb-5px relative",value:h,onChange:S,children:t.jsx(L,{list:d,handleDragEnd:T})}),t.jsx(x,{className:"!mt-10px !mb-5px"}),t.jsx(g,{className:"flex-1 text-center",type:"link",size:"small",onClick:k,children:a("public.reset")})]}),trigger:"click",placement:"bottom",styles:{body:{padding:"8px 0 5px"}},open:i,onOpenChange:()=>{c(!i)},children:t.jsx("div",{...j,className:`${n} inline-block`,children:t.jsx(g,{icon:t.jsx(H,{}),className:"small-btn",children:a("public.columnFilter")})})})}const $=r=>{const{width:l,text:s,color:n,className:o="",style:a}=r,i=e.useRef(null),[c,d]=e.useState(!1),u=e.useCallback(()=>{const e=i.current;e&&d(e.scrollWidth>e.clientWidth)},[s,l]);e.useEffect(()=>{u()},[u]);const h={color:n,...a},p=t.jsx("span",{ref:i,className:`inline-block w-full overflow-hidden text-ellipsis whitespace-nowrap ${o}`,style:h,children:s});return c?t.jsx(b,{title:s,placement:"top",children:p}):p};function D(l){const{isLoading:n,isVirtual:o,isCreate:a,isZebra:i=!0,isBordered:c=!0,isOperate:d=!0,isAuthHeight:u,scrollX:h,scrollY:p,rowClassName:f,size:m,leftContent:x,rightContent:b,getPage:H,onCreate:_}=l,{t:E}=y(),{isPhone:B}=s(),[L]=function(){const[t,r]=e.useState(!0);return[(e,l,s)=>{if(!l?.length||!e?.length)return[];if(t)return r(!1),e||[];e.sort((e,t)=>s.indexOf(e.dataIndex)-s.indexOf(t.dataIndex));for(let t=0;t<e?.length;t++){const r=e[t];r.hidden=!l.includes(r.dataIndex)}return e}]}(),[D,O]=e.useState(k(l.columns)),P=e.useRef(null),[W,q]=e.useState([]),[M,F]=e.useState([]),G=P.current?.querySelectorAll(".ant-table-row");e.useEffect(()=>{const e=k(l.columns),t=e?.map(e=>e.dataIndex).filter(Boolean);O(e),q(t),F(t)},[l.columns]),e.useEffect(()=>{a&&!_&&w.warning(E("public.createMethodWarning"))},[a]),e.useEffect(()=>{d&&!H&&w.warning(E("public.getPageWarning"))},[H]);const K=function(e){const t=document.documentElement.clientHeight||document.body.clientHeight,r=e?.getBoundingClientRect?.()?.top||0,l=document.getElementById("pagination"),s=t-r-(l?.offsetHeight||0);return s>0?s-65:450}(P.current),U=e=>(t,{size:r})=>{const l=[...D];l[e]={...l[e],width:r.width},O(l)},V=function(e){const{height:t,rowHeight:r,total:l}=e;return A=t,z.rowHeight=r,z.total=l,{table:I,body:{wrapper:R}}}({height:K,rowHeight:G?.[0]?.clientHeight||C(m),total:l.dataSource?.length||0}),X=e.useMemo(()=>({header:{cell:T},body:{wrapper:V.body.wrapper},table:V.table}),[V]),Z=o?X:{header:{cell:T}},J={...l.scroll,x:h??"max-content",y:p??(u?K:void 0)};return t.jsxs("div",{id:"table",className:`\n        overflow-auto\n        ${!1!==c?"bordered":""}\n        ${!1!==i?"zebra":""}\n      `,children:[d&&t.jsxs("div",{className:"flex justify-between !mb-10px",children:[t.jsxs("div",{className:"flex flex-wrap items-center gap-6px",children:[!!a&&t.jsx(g,{type:"primary",className:"small-btn",icon:t.jsx(S,{}),onClick:_,children:E("public.create")}),x]}),t.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-6px",children:[b?t.jsx("div",{children:b}):void 0,t.jsx(g,{className:"small-btn",icon:t.jsx(N,{className:"transform rotate-270",disabled:!!n}),onClick:H,children:E("public.refresh")}),t.jsx(Y,{columns:D,cacheColumns:l.columns,getTableChecks:(e,t)=>{q(e),F(t)}})]})]}),t.jsx("div",{ref:P,children:t.jsx(j,{size:"small",rowKey:"id",pagination:!1,loading:n,...l,rowClassName:(e,t,r)=>`${("string"==typeof f?f:f?.(e,t,r))||""}`,style:{borderRadius:10,borderRight:"1px solid rgba(0, 0, 0, .05)",borderBottom:"1px solid rgba(0, 0, 0, .05)",overflow:"auto",...l.style},bordered:!1!==c,scroll:J,components:Z,columns:(()=>{const e=L(D,W,M);if(!e)return[];return e.map((e,l)=>({...e,ellipsis:e.ellipsis??!0,fixed:!(!e?.fixed||B&&!e?.isKeepFixed)&&e.fixed,onHeaderCell:(t,r)=>({...e?.onHeaderCell?.(t,r),width:e.width,onResize:U(l)}),onCell:(t,r)=>({...e?.onCell?.(t,r),style:{...e?.onCell?.(t,r)?.style,maxWidth:e.width,width:e.width}}),render:(l,s,n)=>{const o=e?.render?.(l,s,n);let a,i=o,c="text",d=!1;const u=e?.enum;if(u&&"object"==typeof u)if(Array.isArray(u))for(let e=0;e<u?.length;e++){const t=u[e];if(String(t.value)===String(i)){i=t.label,a=t.color,c=t?.type||"text";break}}else for(const e in u)if(e===String(i)){i=u[e];break}if(Array.isArray(i)&&(d=i?.every(e=>"string"==typeof e),d&&(i=i?.join(", ")||r)),!["object","function"].includes(typeof o)||d){const l=String(i??r);return"tag"===c?t.jsx(v,{color:a,children:l}):void 0===e.ellipsis||e.ellipsis?t.jsx($,{width:e.width,text:l,color:a,className:"break-all"}):t.jsx("span",{className:"break-all break-words whitespace-pre-wrap",children:l})}return o}}))})()})})]})}export{D as B};
