import{n as e,t as n,g as t,a as r,v as s,b as a}from"./@rc-component_mini-decimal@1.1.0.BqhSKEoY.js";import{b as o,l as u,y as l,z as c,e as i,A as f}from"./@rc-component_util@1.7.0_re_97ed4941f5d27d044aa2ecbc4a75f304.OytLLzRX.js";import{c as d}from"./clsx@2.1.1.BvmCeSbq.js";import{r as p}from"./react@19.2.3.D3o_8b5j.js";function m({prefixCls:e,action:n,children:t,disabled:r,className:s,style:a,onStep:o}){const l="up"===n,c=p.useRef(),i=p.useRef([]),f=()=>{clearTimeout(c.current)};p.useEffect(()=>()=>{f(),i.current.forEach(e=>{u.cancel(e)})},[]);const m="".concat(e,"-action"),v=d(m,"".concat(m,"-").concat(n),{["".concat(m,"-").concat(n,"-disabled")]:r},s),b=()=>i.current.push(u(f));return p.createElement("span",{unselectable:"on",role:"button",onMouseUp:b,onMouseLeave:b,onMouseDown:e=>{(e=>{e.preventDefault(),f(),o(l,"handler"),c.current=setTimeout(function e(){o(l,"handler"),c.current=setTimeout(e,200)},600)})(e)},"aria-label":l?"Increase Value":"Decrease Value","aria-disabled":r,className:v,style:a},t||p.createElement("span",{unselectable:"on",className:"".concat(e,"-action-").concat(n,"-inner")}))}function v(t){const r="number"==typeof t?e(t):n(t).fullStr;return r.includes(".")?n(r.replace(/(\d)\.(\d)/g,"$1$2.")).fullStr:t+"0"}function b(){return b=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])}return e},b.apply(this,arguments)}const g=(e,n)=>e||n.isEmpty()?n.toString():n.toNumber(),y=e=>{const n=t(e);return n.isInvalidate()?null:n},E=p.forwardRef((n,E)=>{const{mode:h="input",prefixCls:M="rc-input-number",className:N,style:x,classNames:S,styles:w,min:C,max:I,step:R=1,defaultValue:D,value:O,disabled:T,readOnly:k,upHandler:U,downHandler:j,keyboard:q,changeOnWheel:L=!1,controls:A=!0,prefix:H,suffix:_,stringMode:B,parser:K,formatter:P,precision:V,decimalSeparator:W,onChange:$,onInput:z,onPressEnter:F,onStep:Y,onMouseDown:G,onClick:J,onMouseUp:Q,onMouseLeave:X,onMouseMove:Z,onMouseEnter:ee,onMouseOut:ne,changeOnBlur:te=!0,...re}=n,[se,ae]=p.useState(!1),oe=p.useRef(!1),ue=p.useRef(!1),le=p.useRef(!1),ce=p.useRef(null),ie=p.useRef(null);p.useImperativeHandle(E,()=>l(ie.current,{focus:e=>{c(ie.current,e)},blur:()=>{var e;null==(e=ie.current)||e.blur()},nativeElement:ce.current}));const[fe,de]=p.useState(()=>t(null!=O?O:D));const pe=p.useCallback((e,n)=>{if(!n)return V>=0?V:Math.max(r(e),r(R))},[V,R]),me=p.useCallback(e=>{const n=String(e);if(K)return K(n);let t=n;return W&&(t=t.replace(W,".")),t.replace(/[^\w.-]+/g,"")},[K,W]),ve=p.useRef(""),be=p.useCallback((n,t)=>{if(P)return P(n,{userTyping:t,input:String(ve.current)});let r="number"==typeof n?e(n):n;if(!t){const e=pe(r,t);if(s(r)&&(W||e>=0)){r=a(r,W||".",e)}}return r},[P,pe,W]),[ge,ye]=p.useState(()=>{const e=null!=D?D:O;return fe.isInvalidate()&&["string","number"].includes(typeof e)?Number.isNaN(e)?"":e:be(fe.toString(),!1)});function Ee(e,n){ye(be(e.isInvalidate()?e.toString(!1):e.toString(!n),n))}ve.current=ge;const he=p.useMemo(()=>y(I),[I,V]),Me=p.useMemo(()=>y(C),[C,V]),Ne=p.useMemo(()=>!(!he||!fe||fe.isInvalidate())&&he.lessEquals(fe),[he,fe]),xe=p.useMemo(()=>!(!Me||!fe||fe.isInvalidate())&&fe.lessEquals(Me),[Me,fe]),[Se,we]=function(e,n){const t=p.useRef(null);return[function(){try{const{selectionStart:n,selectionEnd:r,value:s}=e,a=s.substring(0,n),o=s.substring(r);t.current={start:n,end:r,value:s,beforeTxt:a,afterTxt:o}}catch(n){}},function(){if(e&&t.current&&n)try{const{value:n}=e,{beforeTxt:r,afterTxt:s,start:a}=t.current;let o=n.length;if(n.startsWith(r))o=r.length;else if(n.endsWith(s))o=n.length-t.current.afterTxt.length;else{const e=r[a-1],t=n.indexOf(e,a-1);-1!==t&&(o=t+1)}e.setSelectionRange(o,o)}catch(r){o(!1,"Something warning of cursor restore. Please fire issue about this: ".concat(r.message))}}]}(ie.current,se),Ce=e=>he&&!e.lessEquals(he)?he:Me&&!Me.lessEquals(e)?Me:null,Ie=e=>!Ce(e),Re=(e,n)=>{let r=e,s=Ie(r)||r.isEmpty();if(r.isEmpty()||n||(r=Ce(r)||r,s=!0),!k&&!T&&s){const e=r.toString(),s=pe(e,n);return s>=0&&(r=t(a(e,".",s)),Ie(r)||(r=t(a(e,".",s,!0)))),r.equals(fe)||(o=r,void 0===O&&de(o),null==$||$(r.isEmpty()?null:g(B,r)),void 0===O&&Ee(r,n)),r}var o;return fe},De=(()=>{const e=p.useRef(0),n=()=>{u.cancel(e.current)};return p.useEffect(()=>n,[]),t=>{n(),e.current=u(()=>{t()})}})(),Oe=e=>{if(Se(),ve.current=e,ye(e),!ue.current){const n=me(e),r=t(n);r.isNaN()||Re(r,!0)}null==z||z(e),De(()=>{let n=e;K||(n=e.replace(/ã€‚/g,".")),n!==e&&Oe(n)})},Te=i((e,n)=>{var r;if(e&&Ne||!e&&xe)return;oe.current=!1;let s=t(le.current?v(R):R);e||(s=s.negate());const a=(fe||t(0)).add(s.toString()),o=Re(a,!1);null==Y||Y(g(B,o),{offset:le.current?v(R):R,type:e?"up":"down",emitter:n}),null==(r=ie.current)||r.focus()}),ke=e=>{const n=t(me(ge));let r;r=n.isNaN()?Re(fe,e):Re(n,e),void 0!==O?Ee(fe,!1):r.isNaN()||Ee(r,!1)};p.useEffect(()=>{if(L&&se){const e=e=>{Te(e.deltaY<0,"wheel"),e.preventDefault()},n=ie.current;if(n)return n.addEventListener("wheel",e,{passive:!1}),()=>n.removeEventListener("wheel",e)}});f(()=>{fe.isInvalidate()||Ee(fe,!1)},[V,P]),f(()=>{const e=t(O);de(e);const n=t(me(ge));e.equals(n)&&oe.current&&!P||Ee(e,oe.current)},[O]),f(()=>{P&&we()},[ge]);const Ue={prefixCls:M,onStep:Te,className:null==S?void 0:S.action,style:null==w?void 0:w.action},je=p.createElement(m,b({},Ue,{action:"up",disabled:Ne}),U),qe=p.createElement(m,b({},Ue,{action:"down",disabled:xe}),j);return p.createElement("div",{ref:ce,className:d(M,"".concat(M,"-mode-").concat(h),N,null==S?void 0:S.root,{["".concat(M,"-focused")]:se,["".concat(M,"-disabled")]:T,["".concat(M,"-readonly")]:k,["".concat(M,"-not-a-number")]:fe.isNaN(),["".concat(M,"-out-of-range")]:!fe.isInvalidate()&&!Ie(fe)}),style:{...null==w?void 0:w.root,...x},onMouseDown:e=>{ie.current&&e.target!==ie.current&&(ie.current.focus(),e.preventDefault()),null==G||G(e)},onMouseUp:Q,onMouseLeave:X,onMouseMove:Z,onMouseEnter:ee,onMouseOut:ne,onClick:J,onFocus:()=>{ae(!0)},onBlur:()=>{te&&ke(!1),ae(!1),oe.current=!1},onKeyDown:e=>{const{key:n,shiftKey:t}=e;oe.current=!0,le.current=t,"Enter"===n&&(ue.current||(oe.current=!1),ke(!1),null==F||F(e)),!1!==q&&!ue.current&&["Up","ArrowUp","Down","ArrowDown"].includes(n)&&(Te("Up"===n||"ArrowUp"===n,"keyboard"),e.preventDefault())},onKeyUp:()=>{oe.current=!1,le.current=!1},onCompositionStart:()=>{ue.current=!0},onCompositionEnd:()=>{ue.current=!1,Oe(ie.current.value)},onBeforeInput:()=>{oe.current=!0}},"spinner"===h&&A&&qe,void 0!==H&&p.createElement("div",{className:d("".concat(M,"-prefix"),null==S?void 0:S.prefix),style:null==w?void 0:w.prefix},H),p.createElement("input",b({autoComplete:"off",role:"spinbutton","aria-valuemin":C,"aria-valuemax":I,"aria-valuenow":fe.isInvalidate()?null:fe.toString(),step:R,ref:ie,className:d("".concat(M,"-input"),null==S?void 0:S.input),style:null==w?void 0:w.input,value:ge,onChange:e=>{Oe(e.target.value)},disabled:T,readOnly:k},re)),void 0!==_&&p.createElement("div",{className:d("".concat(M,"-suffix"),null==S?void 0:S.suffix),style:null==w?void 0:w.suffix},_),"spinner"===h&&A&&je,"input"===h&&A&&p.createElement("div",{className:d("".concat(M,"-actions"),null==S?void 0:S.actions),style:null==w?void 0:w.actions},je,qe))});export{E as I};
