var e=Object.defineProperty,t=(t,i,s)=>((t,i,s)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s)(t,"symbol"!=typeof i?i+"":i,s);import{r as i}from"./react@19.2.1.BpVBN_43.js";import{b as s,o as r,q as n,v as a,i as o,t as l,e as h}from"./@rc-component_util@1.4.0_re_a8b68d4fbe51b122ded4cf0ecf2ca619.D3_e-sfJ.js";import{S as c}from"./@rc-component_async-validator@5.0.4.Cfriz9qX.js";const d="RC_FORM_INTERNAL_HOOKS",u=()=>{s(!1,"Can not find FormContext. Please make sure you wrap Field under Form.")},g=i.createContext({getFieldValue:u,getFieldsValue:u,getFieldError:u,getFieldWarning:u,getFieldsError:u,isFieldsTouched:u,isFieldTouched:u,isFieldValidating:u,isFieldsValidating:u,resetFields:u,setFields:u,setFieldValue:u,setFieldsValue:u,validateFields:u,submit:u,getInternalHooks:()=>(u(),{dispatch:u,initEntityValue:u,registerField:u,useSubscribe:u,setInitialValues:u,destroyForm:u,setCallbacks:u,registerWatch:u,getFields:u,setValidateMessages:u,setPreserve:u,getInitialValue:u,setBatchUpdate:u})}),m=i.createContext(null);function f(e){return null==e?[]:Array.isArray(e)?e:[e]}const p="'${name}' is not a valid ${type}",F={default:"Validation error on field '${name}'",required:"'${name}' is required",enum:"'${name}' must be one of [${enum}]",whitespace:"'${name}' cannot be empty",date:{format:"'${name}' is invalid for format date",parse:"'${name}' could not be parsed as date",invalid:"'${name}' is invalid date"},types:{string:p,method:p,array:p,object:p,number:p,date:p,boolean:p,integer:p,float:p,regexp:p,email:p,url:p,hex:p},string:{len:"'${name}' must be exactly ${len} characters",min:"'${name}' must be at least ${min} characters",max:"'${name}' cannot be longer than ${max} characters",range:"'${name}' must be between ${min} and ${max} characters"},number:{len:"'${name}' must equal ${len}",min:"'${name}' cannot be less than ${min}",max:"'${name}' cannot be greater than ${max}",range:"'${name}' must be between ${min} and ${max}"},array:{len:"'${name}' must be exactly ${len} in length",min:"'${name}' cannot be less than ${min} in length",max:"'${name}' cannot be greater than ${max} in length",range:"'${name}' must be between ${min} and ${max} in length"},pattern:{mismatch:"'${name}' does not match pattern ${pattern}"}},v=c;const y="CODE_LOGIC_ERROR";async function b(e,t,s,n,a){const o={...s};if(delete o.ruleIndex,v.warning=()=>{},o.validator){const e=o.validator;o.validator=(...t)=>{try{return e(...t)}catch(i){return Promise.reject(y)}}}let l=null;o&&"array"===o.type&&o.defaultField&&(l=o.defaultField,delete o.defaultField);const h=new v({[e]:[o]}),c=r(F,n.validateMessages);h.messages(c);let d=[];try{await Promise.resolve(h.validate({[e]:t},{...n}))}catch(m){m.errors&&(d=m.errors.map(({message:e},t)=>{const s=e===y?c.default:e;return i.isValidElement(s)?i.cloneElement(s,{key:`error_${t}`}):s}))}if(!d.length&&l&&Array.isArray(t)&&t.length>0){return(await Promise.all(t.map((t,i)=>b(`${e}.${i}`,t,l,n,a)))).reduce((e,t)=>[...e,...t],[])}const u={...s,name:e,enum:(s.enum||[]).join(", "),...a},g=d.map(e=>"string"==typeof e?function(e,t){return e.replace(/\\?\$\{\w+\}/g,e=>{if(e.startsWith("\\"))return e.slice(1);const i=e.slice(2,-1);return t[i]})}(e,u):e);return g}function V(e,t,i,r,n,a){const o=e.join("."),l=i.map((e,t)=>{const i=e.validator,r={...e,ruleIndex:t};return i&&(r.validator=(e,t,r)=>{let n=!1;const a=i(e,t,(...e)=>{Promise.resolve().then(()=>{s(!n,"Your validator function has already return a promise. `callback` will be ignored."),n||r(...e)})});n=a&&"function"==typeof a.then&&"function"==typeof a.catch,s(n,"`callback` is deprecated. Please return a promise instead."),n&&a.then(()=>{r()}).catch(e=>{r(e||" ")})}),r}).sort(({warningOnly:e,ruleIndex:t},{warningOnly:i,ruleIndex:s})=>!!e==!!i?t-s:e?1:-1);let h;if(!0===n)h=new Promise(async(e,i)=>{for(let s=0;s<l.length;s+=1){const e=l[s],n=await b(o,t,e,r,a);if(n.length)return void i([{errors:n,rule:e}])}e([])});else{const e=l.map(e=>b(o,t,e,r,a).then(t=>({errors:t,rule:e})));h=(n?async function(e){let t=0;return new Promise(i=>{e.forEach(s=>{s.then(s=>{s.errors.length&&i([s]),t+=1,t===e.length&&i([])})})})}(e):async function(e){return Promise.all(e).then(e=>[].concat(...e))}(e)).then(e=>Promise.reject(e))}return h.catch(e=>e),h}function E(e){return f(e)}function P(e,t){let i={};return t.forEach(t=>{const s=n(e,t);i=a(i,t,s)}),i}function w(e,t,i=!1){return e&&e.some(e=>k(t,e,i))}function k(e,t,i=!1){return!(!e||!t)&&(!(!i&&e.length!==t.length)&&t.every((t,i)=>e[i]===t))}function C(e,t,i){const{length:s}=e;if(t<0||t>=s||i<0||i>=s)return e;const r=e[t],n=t-i;return n>0?[...e.slice(0,i),r,...e.slice(i,t),...e.slice(t+1,s)]:n<0?[...e.slice(0,t),...e.slice(t+1,i+1),r,...e.slice(i+1,s)]:e}function N(){return N=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},N.apply(this,arguments)}const x=[],R=[];function $(e,t,i,s,r,n){return"function"==typeof e?e(t,i,"source"in n?{source:n.source}:{}):s!==r}class M extends i.Component{constructor(e){if(super(e),t(this,"state",{resetCount:0}),t(this,"cancelRegisterFunc",null),t(this,"mounted",!1),t(this,"touched",!1),t(this,"dirty",!1),t(this,"validatePromise"),t(this,"prevValidating"),t(this,"errors",x),t(this,"warnings",R),t(this,"cancelRegister",()=>{const{preserve:e,isListField:t,name:i}=this.props;this.cancelRegisterFunc&&this.cancelRegisterFunc(t,e,E(i)),this.cancelRegisterFunc=null}),t(this,"getNamePath",()=>{const{name:e,fieldContext:t}=this.props,{prefixName:i=[]}=t;return void 0!==e?[...i,...e]:[]}),t(this,"getRules",()=>{const{rules:e=[],fieldContext:t}=this.props;return e.map(e=>"function"==typeof e?e(t):e)}),t(this,"refresh",()=>{this.mounted&&this.setState(({resetCount:e})=>({resetCount:e+1}))}),t(this,"metaCache",null),t(this,"triggerMetaEvent",e=>{const{onMetaChange:t}=this.props;if(t){const i={...this.getMeta(),destroy:e};o(this.metaCache,i)||t(i),this.metaCache=i}else this.metaCache=null}),t(this,"onStoreChange",(e,t,i)=>{const{shouldUpdate:s,dependencies:r=[],onReset:n}=this.props,{store:a}=i,l=this.getNamePath(),h=this.getValue(e),c=this.getValue(a),d=t&&w(t,l);switch("valueUpdate"!==i.type||"external"!==i.source||o(h,c)||(this.touched=!0,this.dirty=!0,this.validatePromise=null,this.errors=x,this.warnings=R,this.triggerMetaEvent()),i.type){case"reset":if(!t||d)return this.touched=!1,this.dirty=!1,this.validatePromise=void 0,this.errors=x,this.warnings=R,this.triggerMetaEvent(),n?.(),void this.refresh();break;case"remove":if(s&&$(s,e,a,h,c,i))return void this.reRender();break;case"setField":{const{data:r}=i;if(d)return"touched"in r&&(this.touched=r.touched),"validating"in r&&!("originRCField"in r)&&(this.validatePromise=r.validating?Promise.resolve([]):null),"errors"in r&&(this.errors=r.errors||x),"warnings"in r&&(this.warnings=r.warnings||R),this.dirty=!0,this.triggerMetaEvent(),void this.reRender();if("value"in r&&w(t,l,!0))return void this.reRender();if(s&&!l.length&&$(s,e,a,h,c,i))return void this.reRender();break}case"dependenciesUpdate":if(r.map(E).some(e=>w(i.relatedFields,e)))return void this.reRender();break;default:if(d||(!r.length||l.length||s)&&$(s,e,a,h,c,i))return void this.reRender()}!0===s&&this.reRender()}),t(this,"validateRules",e=>{const t=this.getNamePath(),i=this.getValue(),{triggerName:s,validateOnly:r=!1}=e||{},n=Promise.resolve().then(async()=>{if(!this.mounted)return[];const{validateFirst:r=!1,messageVariables:a,validateDebounce:o}=this.props;let l=this.getRules();if(s&&(l=l.filter(e=>e).filter(e=>{const{validateTrigger:t}=e;if(!t)return!0;return f(t).includes(s)})),o&&s&&(await new Promise(e=>{setTimeout(e,o)}),this.validatePromise!==n))return[];const h=V(t,i,l,e,r,a);return h.catch(e=>e).then((e=x)=>{if(this.validatePromise===n){this.validatePromise=null;const t=[],i=[];e.forEach?.(({rule:{warningOnly:e},errors:s=x})=>{e?i.push(...s):t.push(...s)}),this.errors=t,this.warnings=i,this.triggerMetaEvent(),this.reRender()}}),h});return r||(this.validatePromise=n,this.dirty=!0,this.errors=x,this.warnings=R,this.triggerMetaEvent(),this.reRender()),n}),t(this,"isFieldValidating",()=>!!this.validatePromise),t(this,"isFieldTouched",()=>this.touched),t(this,"isFieldDirty",()=>{if(this.dirty||void 0!==this.props.initialValue)return!0;const{fieldContext:e}=this.props,{getInitialValue:t}=e.getInternalHooks(d);return void 0!==t(this.getNamePath())}),t(this,"getErrors",()=>this.errors),t(this,"getWarnings",()=>this.warnings),t(this,"isListField",()=>this.props.isListField),t(this,"isList",()=>this.props.isList),t(this,"isPreserve",()=>this.props.preserve),t(this,"getMeta",()=>{this.prevValidating=this.isFieldValidating();return{touched:this.isFieldTouched(),validating:this.prevValidating,errors:this.errors,warnings:this.warnings,name:this.getNamePath(),validated:null===this.validatePromise}}),t(this,"getOnlyChild",e=>{if("function"==typeof e){const t=this.getMeta();return{...this.getOnlyChild(e(this.getControlled(),t,this.props.fieldContext)),isFunction:!0}}const t=l(e);return 1===t.length&&i.isValidElement(t[0])?{child:t[0],isFunction:!1}:{child:t,isFunction:!1}}),t(this,"getValue",e=>{const{getFieldsValue:t}=this.props.fieldContext,i=this.getNamePath();return n(e||t(!0),i)}),t(this,"getControlled",(e={})=>{const{name:t,trigger:i="onChange",validateTrigger:s,getValueFromEvent:r,normalize:n,valuePropName:a="value",getValueProps:o,fieldContext:l}=this.props,h=void 0!==s?s:l.validateTrigger,c=this.getNamePath(),{getInternalHooks:u,getFieldsValue:g}=l,{dispatch:m}=u(d),p=this.getValue(),F=o||(e=>({[a]:e})),v=e[i],y=void 0!==t?F(p):{},b={...e,...y};b[i]=(...e)=>{let t;this.touched=!0,this.dirty=!0,this.triggerMetaEvent(),t=r?r(...e):function(e,...t){const i=t[0];return i&&i.target&&"object"==typeof i.target&&e in i.target?i.target[e]:i}(a,...e),n&&(t=n(t,p,g(!0))),t!==p&&m({type:"updateValue",namePath:c,value:t}),v&&v(...e)};return f(h||[]).forEach(e=>{const t=b[e];b[e]=(...i)=>{t&&t(...i);const{rules:s}=this.props;s&&s.length&&m({type:"validateField",namePath:c,triggerName:e})}}),b}),e.fieldContext){const{getInternalHooks:t}=e.fieldContext,{initEntityValue:i}=t(d);i(this)}}componentDidMount(){const{shouldUpdate:e,fieldContext:t}=this.props;if(this.mounted=!0,t){const{getInternalHooks:e}=t,{registerField:i}=e(d);this.cancelRegisterFunc=i(this)}!0===e&&this.reRender()}componentWillUnmount(){this.cancelRegister(),this.triggerMetaEvent(!0),this.mounted=!1}reRender(){this.mounted&&this.forceUpdate()}render(){const{resetCount:e}=this.state,{children:t}=this.props,{child:r,isFunction:n}=this.getOnlyChild(t);let a;return n?a=r:i.isValidElement(r)?a=i.cloneElement(r,this.getControlled(r.props)):(s(!r,"`children` of Field is not validate ReactElement."),a=r),i.createElement(i.Fragment,{key:e},a)}}function O({name:e,...t}){const s=i.useContext(g),r=i.useContext(m),n=void 0!==e?E(e):void 0,a=t.isListField??!!r;let o="keep";return a||(o=`_${(n||[]).join("_")}`),i.createElement(M,N({key:o,name:n,isListField:a},t,{fieldContext:s}))}function I({name:e,initialValue:t,children:r,rules:n,validateTrigger:a,isListField:o}){const l=i.useContext(g),h=i.useContext(m),c=i.useRef({keys:[],id:0}).current,d=i.useMemo(()=>[...E(l.prefixName)||[],...E(e)],[l.prefixName,e]),u=i.useMemo(()=>({...l,prefixName:d}),[l,d]),f=i.useMemo(()=>({getKey:e=>{const t=d.length,i=e[t];return[c.keys[i],e.slice(t+1)]}}),[c,d]);if("function"!=typeof r)return s(!1,"Form.List only accepts function as children."),null;return i.createElement(m.Provider,{value:f},i.createElement(g.Provider,{value:u},i.createElement(O,{name:[],shouldUpdate:(e,t,{source:i})=>"internal"!==i&&e!==t,rules:n,validateTrigger:a,initialValue:t,isList:!0,isListField:o??!!h},({value:e=[],onChange:t},i)=>{const{getFieldValue:s}=l,n=()=>s(d||[])||[],a={add:(e,i)=>{const s=n();i>=0&&i<=s.length?(c.keys=[...c.keys.slice(0,i),c.id,...c.keys.slice(i)],t([...s.slice(0,i),e,...s.slice(i)])):(c.keys=[...c.keys,c.id],t([...s,e])),c.id+=1},remove:e=>{const i=n(),s=new Set(Array.isArray(e)?e:[e]);s.size<=0||(c.keys=c.keys.filter((e,t)=>!s.has(t)),t(i.filter((e,t)=>!s.has(t))))},move(e,i){if(e===i)return;const s=n();e<0||e>=s.length||i<0||i>=s.length||(c.keys=C(c.keys,e,i),t(C(s,e,i)))}};let o=e||[];return Array.isArray(o)||(o=[]),r(o.map((e,t)=>{let i=c.keys[t];return void 0===i&&(c.keys[t]=c.id,i=c.keys[t],c.id+=1),{name:t,key:i,isListField:!0}}),a,i)})))}t(M,"contextType",g);const L="__@field_split__";function U(e){return e.map(e=>`${typeof e}:${e}`).join(L)}class W{constructor(){t(this,"kvs",new Map)}set(e,t){this.kvs.set(U(e),t)}get(e){return this.kvs.get(U(e))}update(e,t){const i=t(this.get(e));i?this.set(e,i):this.delete(e)}delete(e){this.kvs.delete(U(e))}map(e){return[...this.kvs.entries()].map(([t,i])=>{const s=t.split(L);return e({key:s.map(e=>{const[,t,i]=e.match(/^([^:]*):(.*)$/);return"number"===t?Number(i):i}),value:i})})}toJSON(){const e={};return this.map(({key:t,value:i})=>(e[t.join(".")]=i,null)),e}}class S{constructor(e){t(this,"formHooked",!1),t(this,"forceRootUpdate"),t(this,"subscribable",!0),t(this,"store",{}),t(this,"fieldEntities",[]),t(this,"initialValues",{}),t(this,"callbacks",{}),t(this,"validateMessages",null),t(this,"preserve",null),t(this,"lastValidatePromise",null),t(this,"getForm",()=>({getFieldValue:this.getFieldValue,getFieldsValue:this.getFieldsValue,getFieldError:this.getFieldError,getFieldWarning:this.getFieldWarning,getFieldsError:this.getFieldsError,isFieldsTouched:this.isFieldsTouched,isFieldTouched:this.isFieldTouched,isFieldValidating:this.isFieldValidating,isFieldsValidating:this.isFieldsValidating,resetFields:this.resetFields,setFields:this.setFields,setFieldValue:this.setFieldValue,setFieldsValue:this.setFieldsValue,validateFields:this.validateFields,submit:this.submit,_init:!0,getInternalHooks:this.getInternalHooks})),t(this,"getInternalHooks",e=>e===d?(this.formHooked=!0,{dispatch:this.dispatch,initEntityValue:this.initEntityValue,registerField:this.registerField,useSubscribe:this.useSubscribe,setInitialValues:this.setInitialValues,destroyForm:this.destroyForm,setCallbacks:this.setCallbacks,setValidateMessages:this.setValidateMessages,getFields:this.getFields,setPreserve:this.setPreserve,getInitialValue:this.getInitialValue,registerWatch:this.registerWatch,setBatchUpdate:this.setBatchUpdate}):(s(!1,"`getInternalHooks` is internal usage. Should not call directly."),null)),t(this,"useSubscribe",e=>{this.subscribable=e}),t(this,"prevWithoutPreserves",null),t(this,"setInitialValues",(e,t)=>{if(this.initialValues=e||{},t){let t=r(e,this.store);this.prevWithoutPreserves?.map(({key:i})=>{t=a(t,i,n(e,i))}),this.prevWithoutPreserves=null,this.updateStore(t)}}),t(this,"destroyForm",e=>{if(e)this.updateStore({});else{const e=new W;this.getFieldEntities(!0).forEach(t=>{this.isMergedPreserve(t.isPreserve())||e.set(t.getNamePath(),!0)}),this.prevWithoutPreserves=e}}),t(this,"getInitialValue",e=>{const t=n(this.initialValues,e);return e.length?r(t):t}),t(this,"setCallbacks",e=>{this.callbacks=e}),t(this,"setValidateMessages",e=>{this.validateMessages=e}),t(this,"setPreserve",e=>{this.preserve=e}),t(this,"watchList",[]),t(this,"registerWatch",e=>(this.watchList.push(e),()=>{this.watchList=this.watchList.filter(t=>t!==e)})),t(this,"notifyWatch",(e=[])=>{if(this.watchList.length){const t=this.getFieldsValue(),i=this.getFieldsValue(!0);this.watchList.forEach(s=>{s(t,i,e)})}}),t(this,"notifyWatchNamePathList",[]),t(this,"batchNotifyWatch",e=>{this.notifyWatchNamePathList.push(e),this.batch("notifyWatch",()=>{this.notifyWatch(this.notifyWatchNamePathList),this.notifyWatchNamePathList=[]})}),t(this,"batchUpdate"),t(this,"setBatchUpdate",e=>{this.batchUpdate=e}),t(this,"batch",(e,t)=>{this.batchUpdate(e,t)}),t(this,"timeoutId",null),t(this,"warningUnhooked",()=>{}),t(this,"updateStore",e=>{this.store=e}),t(this,"getFieldEntities",(e=!1)=>e?this.fieldEntities.filter(e=>e.getNamePath().length):this.fieldEntities),t(this,"getFieldsMap",(e=!1)=>{const t=new W;return this.getFieldEntities(e).forEach(e=>{const i=e.getNamePath();t.set(i,e)}),t}),t(this,"getFieldEntitiesForNamePathList",e=>{if(!e)return this.getFieldEntities(!0);const t=this.getFieldsMap(!0);return e.map(e=>{const i=E(e);return t.get(i)||{INVALIDATE_NAME_PATH:E(e)}})}),t(this,"getFieldsValue",(e,t)=>{let i,s;if(this.warningUnhooked(),!0===e||Array.isArray(e)?(i=e,s=t):e&&"object"==typeof e&&(s=e.filter),!0===i&&!s)return this.store;const r=this.getFieldEntitiesForNamePathList(Array.isArray(i)?i:null),o=[],l=[];r.forEach(e=>{const t=e.INVALIDATE_NAME_PATH||e.getNamePath();if(e.isList?.())l.push(t);else if(s){const i="getMeta"in e?e.getMeta():null;s(i)&&o.push(t)}else o.push(t)});let h=P(this.store,o.map(E));return l.forEach(e=>{n(h,e)||(h=a(h,e,[]))}),h}),t(this,"getFieldValue",e=>{this.warningUnhooked();const t=E(e);return n(this.store,t)}),t(this,"getFieldsError",e=>{this.warningUnhooked();return this.getFieldEntitiesForNamePathList(e).map((t,i)=>t&&!t.INVALIDATE_NAME_PATH?{name:t.getNamePath(),errors:t.getErrors(),warnings:t.getWarnings()}:{name:E(e[i]),errors:[],warnings:[]})}),t(this,"getFieldError",e=>{this.warningUnhooked();const t=E(e);return this.getFieldsError([t])[0].errors}),t(this,"getFieldWarning",e=>{this.warningUnhooked();const t=E(e);return this.getFieldsError([t])[0].warnings}),t(this,"isFieldsTouched",(...e)=>{this.warningUnhooked();const[t,i]=e;let s,r=!1;0===e.length?s=null:1===e.length?Array.isArray(t)?(s=t.map(E),r=!1):(s=null,r=t):(s=t.map(E),r=i);const n=this.getFieldEntities(!0),a=e=>e.isFieldTouched();if(!s)return r?n.every(e=>a(e)||e.isList()):n.some(a);const o=new W;s.forEach(e=>{o.set(e,[])}),n.forEach(e=>{const t=e.getNamePath();s.forEach(i=>{i.every((e,i)=>t[i]===e)&&o.update(i,t=>[...t,e])})});const l=e=>e.some(a),h=o.map(({value:e})=>e);return r?h.every(l):h.some(l)}),t(this,"isFieldTouched",e=>(this.warningUnhooked(),this.isFieldsTouched([e]))),t(this,"isFieldsValidating",e=>{this.warningUnhooked();const t=this.getFieldEntities();if(!e)return t.some(e=>e.isFieldValidating());const i=e.map(E);return t.some(e=>{const t=e.getNamePath();return w(i,t)&&e.isFieldValidating()})}),t(this,"isFieldValidating",e=>(this.warningUnhooked(),this.isFieldsValidating([e]))),t(this,"resetWithFieldInitialValue",(e={})=>{const t=new W,i=this.getFieldEntities(!0);i.forEach(e=>{const{initialValue:i}=e.props,s=e.getNamePath();if(void 0!==i){const r=t.get(s)||new Set;r.add({entity:e,value:i}),t.set(s,r)}});let r;e.entities?r=e.entities:e.namePathList?(r=[],e.namePathList.forEach(e=>{const i=t.get(e);i&&r.push(...[...i].map(e=>e.entity))})):r=i,(i=>{i.forEach(i=>{const{initialValue:r}=i.props;if(void 0!==r){const r=i.getNamePath();if(void 0!==this.getInitialValue(r))s(!1,`Form already set 'initialValues' with path '${r.join(".")}'. Field can not overwrite it.`);else{const n=t.get(r);if(n&&n.size>1)s(!1,`Multiple Field with path '${r.join(".")}' set 'initialValue'. Can not decide which one to pick.`);else if(n){const t=this.getFieldValue(r);i.isListField()||e.skipExist&&void 0!==t||this.updateStore(a(this.store,r,[...n][0].value))}}}})})(r)}),t(this,"resetFields",e=>{this.warningUnhooked();const t=this.store;if(!e)return this.updateStore(r(this.initialValues)),this.resetWithFieldInitialValue(),this.notifyObservers(t,null,{type:"reset"}),void this.notifyWatch();const i=e.map(E);i.forEach(e=>{const t=this.getInitialValue(e);this.updateStore(a(this.store,e,t))}),this.resetWithFieldInitialValue({namePathList:i}),this.notifyObservers(t,i,{type:"reset"}),this.notifyWatch(i)}),t(this,"setFields",e=>{this.warningUnhooked();const t=this.store,i=[];e.forEach(e=>{const{name:s,...r}=e,n=E(s);i.push(n),"value"in r&&this.updateStore(a(this.store,n,r.value)),this.notifyObservers(t,[n],{type:"setField",data:e})}),this.notifyWatch(i)}),t(this,"getFields",()=>this.getFieldEntities(!0).map(e=>{const t=e.getNamePath(),i={...e.getMeta(),name:t,value:this.getFieldValue(t)};return Object.defineProperty(i,"originRCField",{value:!0}),i})),t(this,"initEntityValue",e=>{const{initialValue:t}=e.props;if(void 0!==t){const i=e.getNamePath();void 0===n(this.store,i)&&this.updateStore(a(this.store,i,t))}}),t(this,"isMergedPreserve",e=>(void 0!==e?e:this.preserve)??!0),t(this,"registerField",e=>{this.fieldEntities.push(e);const t=e.getNamePath();if(this.batchNotifyWatch(t),void 0!==e.props.initialValue){const t=this.store;this.resetWithFieldInitialValue({entities:[e],skipExist:!0}),this.notifyObservers(t,[e.getNamePath()],{type:"valueUpdate",source:"internal"})}return(i,s,r=[])=>{if(this.fieldEntities=this.fieldEntities.filter(t=>t!==e),!this.isMergedPreserve(s)&&(!i||r.length>1)){const e=i?void 0:this.getInitialValue(t);if(t.length&&this.getFieldValue(t)!==e&&this.fieldEntities.every(e=>!k(e.getNamePath(),t))){const i=this.store;this.updateStore(a(i,t,e,!0)),this.notifyObservers(i,[t],{type:"remove"}),this.triggerDependenciesUpdate(i,t)}}this.batchNotifyWatch(t)}}),t(this,"dispatch",e=>{switch(e.type){case"updateValue":{const{namePath:t,value:i}=e;this.updateValue(t,i);break}case"validateField":{const{namePath:t,triggerName:i}=e;this.validateFields([t],{triggerName:i});break}}}),t(this,"notifyObservers",(e,t,i)=>{if(this.subscribable){const s={...i,store:this.getFieldsValue(!0)};this.getFieldEntities().forEach(({onStoreChange:i})=>{i(e,t,s)})}else this.forceRootUpdate()}),t(this,"triggerDependenciesUpdate",(e,t)=>{const i=this.getDependencyChildrenFields(t);return i.length&&this.validateFields(i),this.notifyObservers(e,i,{type:"dependenciesUpdate",relatedFields:[t,...i]}),i}),t(this,"updateValue",(e,t)=>{const i=E(e),s=this.store;this.updateStore(a(this.store,i,t)),this.notifyObservers(s,[i],{type:"valueUpdate",source:"internal"}),this.notifyWatch([i]);const n=this.triggerDependenciesUpdate(s,i),{onValuesChange:o}=this.callbacks;if(o){const e=P(this.store,[i]),t=this.getFieldsValue();o(e,r(t,e))}this.triggerOnFieldsChange([i,...n])}),t(this,"setFieldsValue",e=>{this.warningUnhooked();const t=this.store;if(e){const t=r(this.store,e);this.updateStore(t)}this.notifyObservers(t,null,{type:"valueUpdate",source:"external"}),this.notifyWatch()}),t(this,"setFieldValue",(e,t)=>{this.setFields([{name:e,value:t,errors:[],warnings:[],touched:!0}])}),t(this,"getDependencyChildrenFields",e=>{const t=new Set,i=[],s=new W;this.getFieldEntities().forEach(e=>{const{dependencies:t}=e.props;(t||[]).forEach(t=>{const i=E(t);s.update(i,(t=new Set)=>(t.add(e),t))})});const r=e=>{(s.get(e)||new Set).forEach(e=>{if(!t.has(e)){t.add(e);const s=e.getNamePath();e.isFieldDirty()&&s.length&&(i.push(s),r(s))}})};return r(e),i}),t(this,"triggerOnFieldsChange",(e,t)=>{const{onFieldsChange:i}=this.callbacks;if(i){const s=this.getFields();if(t){const e=new W;t.forEach(({name:t,errors:i})=>{e.set(t,i)}),s.forEach(t=>{t.errors=e.get(t.name)||t.errors})}const r=s.filter(({name:t})=>w(e,t));r.length&&i(r,s)}}),t(this,"validateFields",(e,t)=>{let i,s;this.warningUnhooked(),Array.isArray(e)||"string"==typeof e||"string"==typeof t?(i=e,s=t):s=e;const r=!!i,n=r?i.map(E):[],a=[...n],o=[],l=String(Date.now()),h=new Set,{recursive:c,dirty:d}=s||{};this.getFieldEntities(!0).forEach(e=>{const t=e.getNamePath();if(r||(e.isList()&&n.some(e=>k(e,t,!0))||a.push(t),n.push(t)),e.props.rules&&e.props.rules.length&&(!d||e.isFieldDirty())&&(h.add(t.join(l)),!r||w(n,t,c))){const i=e.validateRules({validateMessages:{...F,...this.validateMessages},...s});o.push(i.then(()=>({name:t,errors:[],warnings:[]})).catch(e=>{const i=[],s=[];return e.forEach?.(({rule:{warningOnly:e},errors:t})=>{e?s.push(...t):i.push(...t)}),i.length?Promise.reject({name:t,errors:i,warnings:s}):{name:t,errors:i,warnings:s}}))}});const u=function(e){let t=!1,i=e.length;const s=[];return e.length?new Promise((r,n)=>{e.forEach((e,a)=>{e.catch(e=>(t=!0,e)).then(e=>{i-=1,s[a]=e,i>0||(t&&n(s),r(s))})})}):Promise.resolve([])}(o);this.lastValidatePromise=u,u.catch(e=>e).then(e=>{const t=e.map(({name:e})=>e);this.notifyObservers(this.store,t,{type:"validateFinish"}),this.triggerOnFieldsChange(t,e)});const g=u.then(()=>this.lastValidatePromise===u?Promise.resolve(this.getFieldsValue(a)):Promise.reject([])).catch(e=>{const t=e.filter(e=>e&&e.errors.length),i=t[0]?.errors?.[0];return Promise.reject({message:i,values:this.getFieldsValue(n),errorFields:t,outOfDate:this.lastValidatePromise!==u})});g.catch(e=>e);const m=n.filter(e=>h.has(e.join(l)));return this.triggerOnFieldsChange(m),g}),t(this,"submit",()=>{this.warningUnhooked(),this.validateFields().then(e=>{const{onFinish:t}=this.callbacks;if(t)try{t(e)}catch(i){}}).catch(e=>{const{onFinishFailed:t}=this.callbacks;t&&t(e)})}),this.forceRootUpdate=e}}function j(e){const t=i.useRef(null),[,s]=i.useState({});if(!t.current)if(e)t.current=e;else{const e=new S(()=>{s({})});t.current=e.getForm()}return[t.current]}const A=i.createContext({triggerFormChange:()=>{},triggerFormFinish:()=>{},registerForm:()=>{},unregisterForm:()=>{}}),T=({validateMessages:e,onFormChange:t,onFormFinish:s,children:r})=>{const n=i.useContext(A),a=i.useRef({});return i.createElement(A.Provider,{value:{...n,validateMessages:{...n.validateMessages,...e},triggerFormChange:(e,i)=>{t&&t(e,{changedFields:i,forms:a.current}),n.triggerFormChange(e,i)},triggerFormFinish:(e,t)=>{s&&s(e,{values:t,forms:a.current}),n.triggerFormFinish(e,t)},registerForm:(e,t)=>{e&&(a.current={...a.current,[e]:t}),n.registerForm(e,t)},unregisterForm:e=>{const t={...a.current};delete t[e],a.current=t,n.unregisterForm(e)}}},r)},_=i.forwardRef((e,t)=>{const[s,r]=i.useState({});return i.useLayoutEffect(()=>{const e=Object.keys(s);e.length&&(e.forEach(e=>{s[e]?.()}),r({}))},[s]),i.useImperativeHandle(t,()=>({batch:(e,t)=>{r(i=>({...i,[e]:t}))}})),null});function D(){return D=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)Object.prototype.hasOwnProperty.call(i,s)&&(e[s]=i[s])}return e},D.apply(this,arguments)}const H=({name:e,initialValues:t,fields:s,form:r,preserve:n,children:a,component:o="form",validateMessages:l,validateTrigger:h="onChange",onValuesChange:c,onFieldsChange:u,onFinish:f,onFinishFailed:p,clearOnDestroy:F,...v},y)=>{const b=i.useRef(null),V=i.useContext(A),[E]=j(r),{useSubscribe:P,setInitialValues:w,setCallbacks:k,setValidateMessages:C,setPreserve:N,destroyForm:x,setBatchUpdate:R}=E.getInternalHooks(d);i.useImperativeHandle(y,()=>({...E,nativeElement:b.current})),i.useEffect(()=>(V.registerForm(e,E),()=>{V.unregisterForm(e)}),[V,E,e]),C({...V.validateMessages,...l}),k({onValuesChange:c,onFieldsChange:(t,...i)=>{V.triggerFormChange(e,t),u&&u(t,...i)},onFinish:t=>{V.triggerFormFinish(e,t),f&&f(t)},onFinishFailed:p}),N(n);const $=i.useRef(null);w(t,!$.current),$.current||($.current=!0);const M=i.useRef(null),O=i.useRef([]),I=()=>{M.current&&(O.current.forEach(([e,t])=>{M.current.batch(e,t)}),O.current=[])},L=i.useCallback(e=>{M.current=e,I()},[]);let U;R((e,t)=>{O.current.push([e,t]),I()}),i.useEffect(()=>()=>x(F),[]);const W="function"==typeof a;if(W){U=a(E.getFieldsValue(!0),E)}else U=a;P(!W);const S=i.useRef(null);i.useEffect(()=>{(function(e,t){if(e===t)return!0;if(!e&&t||e&&!t)return!1;if(!e||!t||"object"!=typeof e||"object"!=typeof t)return!1;const i=Object.keys(e),s=Object.keys(t);return[...new Set([...i,...s])].every(i=>{const s=e[i],r=t[i];return"function"==typeof s&&"function"==typeof r||s===r})})(S.current||[],s||[])||E.setFields(s||[]),S.current=s},[s,E]);const T=i.useMemo(()=>({...E,validateTrigger:h}),[E,h]),H=i.createElement(m.Provider,{value:null},i.createElement(g.Provider,{value:T},U),i.createElement(_,{ref:L}));return!1===o?H:i.createElement(o,D({},v,{ref:b,onSubmit:e=>{e.preventDefault(),e.stopPropagation(),E.submit()},onReset:e=>{e.preventDefault(),E.resetFields(),v.onReset?.(e)}}),H)};function B(e){try{return JSON.stringify(e)}catch{return Math.random()}}function q(...e){const[t,s={}]=e,r=function(e){return e&&!!e._init}(s)?{form:s}:s,a=r.form,[o,l]=i.useState(()=>"function"==typeof t?t({}):void 0),c=i.useMemo(()=>B(o),[o]);i.useRef(c).current=c;const u=i.useContext(g),m=a||u,f=m&&m._init,{getFieldsValue:p,getInternalHooks:F}=m,{registerWatch:v}=F(d),y=h((e,i)=>{const s=r.preserve?i??p(!0):e??p(),a="function"==typeof t?t(s):n(s,E(t));B(o)!==B(a)&&l(a)}),b="function"==typeof t?t:JSON.stringify(t);return i.useEffect(()=>{f&&y()},[f,b]),i.useEffect(()=>{if(!f)return;return v((e,t)=>{y(e,t)})},[f]),o}const z=i.forwardRef(H);z.FormProvider=T,z.Field=O,z.List=I,z.useForm=j,z.useWatch=q;export{g as C,T as F,m as L,z as R,O as W,I as a,q as b,j as u};
