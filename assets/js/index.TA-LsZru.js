import{j as e,r as a}from"./react@19.2.3.D3o_8b5j.js";import{S as l,u as t,v as n}from"./antd@6.1.3_react-dom@19.2.3_react@19.2.3__react@19.2.3.B59SJbiP.js";import{u as o}from"./react-i18next@16.5.1_i18nex_e0732ae603aefaca3ccb08379955d50d.CFoO-yg_.js";import{l as r}from"./lodash@4.17.21.BUwJ2jlQ.js";function i(){return e.jsx("div",{className:"absolute left-50% top-50% -translate-x-1/2 -translate-y-1/2 text-center",children:e.jsx(l,{spinning:!0})})}const s=a.memo(function(l){var n;const{t:r}=o(),[s,u]=a.useState(!1),[c,p]=a.useState([]),d={...l};delete d.api,delete d.params,delete d.apiResultKey;const v=a.useCallback(async()=>{if(l.api)try{const{api:e,params:a,apiResultKey:t}=l;if(u(!0),e){const l=Array.isArray(a)?e(...a):e(a),{code:n,data:o}=await l;if(200!==Number(n))return;const r=t?null==o?void 0:o[t]:o;p(r)}}finally{u(!1)}},[l.api,l.params,l.apiResultKey]);return a.useEffect(()=>{l.value&&0===c.length&&v()},[l.value]),e.jsx(t,{allowClear:!0,showSearch:!0,maxTagCount:f,placeholder:r("public.inputPleaseSelect"),optionFilterProp:(null==(n=null==d?void 0:d.fieldNames)?void 0:n.label)||"label",...d,loading:s,options:c,notFoundContent:s&&e.jsx(i,{}),onOpenChange:e=>{var a;e&&v(),null==(a=l.onOpenChange)||a.call(l,e)}})},(e,a)=>e.value===a.value&&e.api===a.api),u=Object.freeze(Object.defineProperty({__proto__:null,default:s},Symbol.toStringTag,{value:"Module"}));const c=a.memo(function(l){var t;const{t:r}=o(),[s,u]=a.useState(!1),[c,p]=a.useState([]),d={...l};delete d.api,delete d.params,delete d.apiResultKey;const v=a.useCallback(async()=>{if(l.api)try{const{api:e,params:a,apiResultKey:t}=l;if(u(!0),e){const l=Array.isArray(a)?e(...a):e(a),{code:n,data:o}=await l;if(200!==Number(n))return;const r=t?null==o?void 0:o[t]:o;p(r)}}finally{u(!1)}},[l.api,l.params,l.apiResultKey]);return a.useEffect(()=>{l.value&&0===(null==c?void 0:c.length)&&v()},[l.value]),e.jsx(n,{allowClear:!0,showSearch:!0,maxTagCount:f,treeNodeFilterProp:(null==(t=null==d?void 0:d.fieldNames)?void 0:t.label)||"label",placeholder:r("public.inputPleaseSelect"),...d,loading:s,treeData:c,notFoundContent:s&&e.jsx(i,{}),onOpenChange:e=>{var a;e&&v(),null==(a=l.onOpenChange)||a.call(l,e)}})},(e,a)=>e.value===a.value&&e.api===a.api),p=Object.freeze(Object.defineProperty({__proto__:null,default:c},Symbol.toStringTag,{value:"Module"}));const d=a.memo(function(n){var s;const{pageKey:u="page",pageSizeKey:c="pageSize",queryKey:p="query",page:d=1,pageSize:v=20}=n,{t:m}=o(),[y,g]=a.useState(!1),[b,h]=a.useState(d),[S,j]=a.useState([]),[x,C]=a.useState(!1),[_,K]=a.useState(""),N=a.useRef(!0),O={...n};delete O.api,delete O.params,delete O.apiResultKey,delete O.pageKey,delete O.pageSizeKey,a.useEffect(()=>{x&&(C(!1),R())},[x]);const R=a.useCallback(async()=>{if(n.api&&N.current)try{const{api:e,params:a,apiResultKey:l}=n,t={[u]:b,[c]:v,[p]:_||void 0};if(Array.isArray(a))for(let n=0;n<(null==a?void 0:a.length);n++){const e=a[n];e.constructor===Object&&(a[n]={...e,...t})}if(g(!0),e){const o=Array.isArray(a)?e(...a):e({...a,...t}),{code:r,data:i}=await o;if(200!==Number(r))return;const s=l?null==i?void 0:i[l]:i;if(null==s?void 0:s.length){const e=S.concat(s);j(e)}N.current=!!(null==s?void 0:s.length),N.current||j(e=>{var a,l;return e.length?e.concat([{[(null==(a=null==n?void 0:n.fieldNames)?void 0:a.label)||"label"]:m("public.noMoreData"),[(null==(l=null==n?void 0:n.fieldNames)?void 0:l.value)||"value"]:m("public.noMoreData"),disabled:!0,className:"text-center"}]):e})}}finally{g(!1)}},[n.api,n.params,n.apiResultKey,n.fieldNames,b,_,u,c,p,v,S,m]);a.useEffect(()=>{n.value&&0===S.length&&R()},[n.value]);const P=a.useCallback(async e=>{const{scrollTop:a,scrollHeight:l,clientHeight:t}=e.currentTarget;a+t>=l-10&&!y&&N.current&&(h(e=>e+1),C(!0))},[y]),w=r.debounce(e=>{var a;null==(a=null==n?void 0:n.onSearch)||a.call(n,e),j([]),h(d),N.current=!0,K(e),C(!0)},200);return e.jsx(t,{allowClear:!0,showSearch:!0,maxTagCount:f,placeholder:m("public.inputPleaseSelect"),optionFilterProp:(null==(s=null==O?void 0:O.fieldNames)?void 0:s.label)||"label",...O,onSearch:w,onPopupScroll:P,popupRender:a=>e.jsxs(e.Fragment,{children:[a,e.jsx("div",{className:"py-3px text-center",children:y&&N&&!!(null==S?void 0:S.length)&&e.jsx(l,{size:"small",spinning:!0})})]}),loading:y,options:S,notFoundContent:y&&e.jsx(i,{}),onOpenChange:e=>{var a;e&&!(null==S?void 0:S.length)&&R(),null==(a=n.onOpenChange)||a.call(n,e)}})},(e,a)=>e.value===a.value&&e.api===a.api),v=Object.freeze(Object.defineProperty({__proto__:null,default:d},Symbol.toStringTag,{value:"Module"})),f="responsive";export{s as A,f as M,u as a,p as b,v as c};
