import{i as e,l as t,e as n,K as o,h as r,d as c}from"./@rc-component_util@1.4.0_re_a8b68d4fbe51b122ded4cf0ecf2ca619.D3_e-sfJ.js";import{c as s}from"./clsx@2.1.1.BvmCeSbq.js";import{r as i,e as a}from"./react@19.2.1.BpVBN_43.js";import{C as l}from"./@rc-component_motion@1.1.6__0afcbe001b0ce065bd610efbbf939bf0.BsUikez1.js";import{P as u}from"./@rc-component_portal@2.0.1__3d144a3e75e5531d8ca8009183b58415.Bf4rG5sj.js";const m=i.createContext(null);function f(){return{width:document.documentElement.clientWidth,height:window.innerHeight||document.documentElement.clientHeight}}const d={x:0,y:0,rotate:0,scale:1,flipX:!1,flipY:!1};function p(e,t,n,o){const r=t+n,c=(n-o)/2;if(n>o){if(t>0)return{[e]:c};if(t<0&&r<o)return{[e]:-c}}else if(t<0||r>o)return{[e]:t<0?c:-c};return{}}function h(e,t,n,o){const{width:r,height:c}=f();let s=null;return e<=r&&t<=c?s={x:0,y:0}:(e>r||t>c)&&(s={...p("x",n,e,r),...p("y",o,t,c)}),s}function g({src:e,isCustomPlaceholder:t,fallback:n}){const[o,r]=i.useState(t?"loading":"normal"),c=i.useRef(!1),s="error"===o;i.useEffect(()=>{let t=!0;return function(e){return new Promise(t=>{if(!e)return void t(!1);const n=document.createElement("img");n.onerror=()=>t(!1),n.onload=()=>t(!0),n.src=e})}(e).then(e=>{!e&&t&&r("error")}),()=>{t=!1}},[e]),i.useEffect(()=>{t&&!c.current?r("loading"):s&&r("normal")},[e]);const a=()=>{r("normal")};return[e=>{c.current=!1,"loading"===o&&e?.complete&&(e.naturalWidth||e.naturalHeight)&&(c.current=!0,a())},s&&n?{src:n}:{onLoad:a,src:e},o]}function v(e,t){const n=e.x-t.x,o=e.y-t.y;return Math.hypot(n,o)}function y(e,t,n,o,r,c,s){const{rotate:a,scale:l,x:u,y:m}=r,[f,d]=i.useState(!1),p=i.useRef({point1:{x:0,y:0},point2:{x:0,y:0},eventType:"none"}),g=e=>{p.current={...p.current,...e}};return i.useEffect(()=>{const e=e=>{e.preventDefault()};return n&&t&&window.addEventListener("touchmove",e,{passive:!1}),()=>{window.removeEventListener("touchmove",e)}},[n,t]),{isTouching:f,onTouchStart:e=>{if(!t)return;e.stopPropagation(),d(!0);const{touches:n=[]}=e;n.length>1?g({point1:{x:n[0].clientX,y:n[0].clientY},point2:{x:n[1].clientX,y:n[1].clientY},eventType:"touchZoom"}):g({point1:{x:n[0].clientX-u,y:n[0].clientY-m},eventType:"move"})},onTouchMove:e=>{const{touches:t=[]}=e,{point1:n,point2:o,eventType:r}=p.current;if(t.length>1&&"touchZoom"===r){const e={x:t[0].clientX,y:t[0].clientY},r={x:t[1].clientX,y:t[1].clientY},[c,i]=function(e,t,n,o){const r=v(e,n),c=v(t,o);if(0===r&&0===c)return[e.x,e.y];const s=r/(r+c);return[e.x+s*(t.x-e.x),e.y+s*(t.y-e.y)]}(n,o,e,r),a=v(e,r)/v(n,o);s(a,"touchZoom",c,i,!0),g({point1:e,point2:r,eventType:"touchZoom"})}else"move"===r&&(c({x:t[0].clientX-n.x,y:t[0].clientY-n.y},"move"),g({eventType:"move"}))},onTouchEnd:()=>{if(!n)return;if(f&&d(!1),g({eventType:"none"}),o>l)return c({x:0,y:0,scale:o},"touchZoom");const t=e.current.offsetWidth*l,r=e.current.offsetHeight*l,{left:s,top:i}=e.current.getBoundingClientRect(),u=a%180!=0,m=h(u?r:t,u?t:r,s,i);m&&c({...m},"dragRebound")}}}function C(e){const{prefixCls:t,icon:n,onClick:o}=e;return i.createElement("button",{className:`${t}-close`,onClick:o},n)}function w(e){const{prefixCls:t,showProgress:n,current:o,count:r,showSwitch:c,classNames:a,styles:l,icons:u,image:m,transform:f,countRender:d,actionsRender:p,scale:h,minScale:g,maxScale:v,onActive:y,onFlipY:C,onFlipX:w,onRotateLeft:x,onRotateRight:b,onZoomOut:E,onZoomIn:k,onClose:R,onReset:$}=e,{left:N,right:Y,prev:S,next:T,flipY:X,flipX:O,rotateLeft:P,rotateRight:I,zoomOut:L,zoomIn:j}=u,M=n&&i.createElement("div",{className:`${t}-progress`},d?d(o+1,r):i.createElement("bdi",null,`${o+1} / ${r}`)),Z=`${t}-actions-action`,z=({type:e,disabled:t,onClick:n,icon:o})=>i.createElement("div",{key:e,className:s(Z,`${Z}-${e}`,{[`${Z}-disabled`]:!!t}),onClick:n},o),F=c?z({icon:S??N,onClick:()=>y(-1),type:"prev",disabled:0===o}):void 0,W=c?z({icon:T??Y,onClick:()=>y(1),type:"next",disabled:o===r-1}):void 0,_=z({icon:X,onClick:C,type:"flipY"}),H=z({icon:O,onClick:w,type:"flipX"}),D=z({icon:P,onClick:x,type:"rotateLeft"}),A=z({icon:I,onClick:b,type:"rotateRight"}),B=z({icon:L,onClick:E,type:"zoomOut",disabled:h<=g}),G=z({icon:j,onClick:k,type:"zoomIn",disabled:h===v}),K=i.createElement("div",{className:s(`${t}-actions`,a.actions),style:l.actions},_,H,D,A,B,G);return i.createElement("div",{className:s(`${t}-footer`,a.footer),style:l.footer},M,p?p(K,{icons:{prevIcon:F,nextIcon:W,flipYIcon:_,flipXIcon:H,rotateLeftIcon:D,rotateRightIcon:A,zoomOutIcon:B,zoomInIcon:G},actions:{onActive:y,onFlipY:C,onFlipX:w,onRotateLeft:x,onRotateRight:b,onZoomOut:E,onZoomIn:k,onReset:$,onClose:R},transform:f,current:o,total:r,image:m}):K)}function x(e){const{prefixCls:t,onActive:n,current:o,count:r,icons:{left:c,right:a,prev:l,next:u}}=e,m=`${t}-switch`;return i.createElement(i.Fragment,null,i.createElement("div",{className:s(m,`${m}-prev`,{[`${m}-disabled`]:0===o}),onClick:()=>n(-1)},l??c),i.createElement("div",{className:s(m,`${m}-next`,{[`${m}-disabled`]:o===r-1}),onClick:()=>n(1)},u??a))}function b(){return b=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},b.apply(this,arguments)}const E=({fallback:e,src:t,imgRef:n,...o})=>{const[r,c]=g({src:t,fallback:e});return a.createElement("img",b({ref:e=>{n.current=e,r(e)}},o,c))},k=c=>{const{prefixCls:p,rootClassName:g,src:v,alt:k,imageInfo:R,fallback:$,movable:N=!0,onClose:Y,open:S,afterOpenChange:T,icons:X={},closeIcon:O,getContainer:P,current:I=0,count:L=1,countRender:j,scaleStep:M=.5,minScale:Z=1,maxScale:z=50,motionName:F="fade",imageRender:W,imgCommonProps:_,actionsRender:H,onTransform:D,onChange:A,classNames:B={},styles:G={},mousePosition:K,zIndex:U}=c,V=i.useRef(),q=i.useContext(m),J=q&&L>1,Q=q&&L>=1,[ee,te]=i.useState(!0),{transform:ne,resetTransform:oe,updateTransform:re,dispatchZoomChange:ce}=function(n,o,r,c){const s=i.useRef(null),a=i.useRef([]),[l,u]=i.useState(d),m=(e,n)=>{null===s.current&&(a.current=[],s.current=t(()=>{u(e=>{let t=e;return a.current.forEach(e=>{t={...t,...e}}),s.current=null,c?.({transform:t,action:n}),t})})),a.current.push({...l,...e})};return{transform:l,resetTransform:t=>{u(d),e(d,l)||c?.({transform:d,action:t})},updateTransform:m,dispatchZoomChange:(e,t,c,s,i)=>{const{width:a,height:u,offsetWidth:d,offsetHeight:p,offsetLeft:h,offsetTop:g}=n.current;let v=e,y=l.scale*e;y>r?(y=r,v=r/l.scale):y<o&&(y=i?y:o,v=y/l.scale);const C=c??innerWidth/2,w=s??innerHeight/2,x=v-1,b=x*a*.5,E=x*u*.5,k=x*(C-l.x-h),R=x*(w-l.y-g);let $=l.x-(k-b),N=l.y-(R-E);if(e<1&&1===y){const e=d*y,t=p*y,{width:n,height:o}=f();e<=n&&t<=o&&($=0,N=0)}m({x:$,y:N,scale:y},t)}}}(V,Z,z,D),{isMoving:se,onMouseDown:ie,onWheel:ae}=function(e,t,n,o,r,c,s){const{rotate:a,scale:l,x:u,y:m}=r,[f,d]=i.useState(!1),p=i.useRef({diffX:0,diffY:0,transformX:0,transformY:0}),g=e=>{n&&f&&c({x:e.pageX-p.current.diffX,y:e.pageY-p.current.diffY},"move")},v=()=>{if(n&&f){d(!1);const{transformX:t,transformY:n}=p.current;if(u===t||m===n)return;const o=e.current.offsetWidth*l,r=e.current.offsetHeight*l,{left:s,top:i}=e.current.getBoundingClientRect(),f=a%180!=0,g=h(f?r:o,f?o:r,s,i);g&&c({...g},"dragRebound")}};return i.useEffect(()=>{if(t){window.addEventListener("mouseup",v,!1),window.addEventListener("mousemove",g,!1);try{window.top!==window.self&&(window.top.addEventListener("mouseup",v,!1),window.top.addEventListener("mousemove",g,!1))}catch(e){}}return()=>{window.removeEventListener("mouseup",v),window.removeEventListener("mousemove",g),window.top?.removeEventListener("mouseup",v),window.top?.removeEventListener("mousemove",g)}},[n,f,u,m,a,t]),{isMoving:f,onMouseDown:e=>{t&&0===e.button&&(e.preventDefault(),e.stopPropagation(),p.current={diffX:e.pageX-u,diffY:e.pageY-m,transformX:u,transformY:m},d(!0))},onMouseMove:g,onMouseUp:v,onWheel:e=>{if(!n||0==e.deltaY)return;const t=Math.abs(e.deltaY/100);let r=1+Math.min(t,1)*o;e.deltaY>0&&(r=1/r),s(r,"wheel",e.clientX,e.clientY)}}}(V,N,S,M,ne,re,ce),{isTouching:le,onTouchStart:ue,onTouchMove:me,onTouchEnd:fe}=y(V,N,S,Z,ne,re,ce),{rotate:de,scale:pe}=ne;i.useEffect(()=>{ee||te(!0)},[ee]),i.useEffect(()=>{S||oe("close")},[S]);const he=a.createElement(E,b({},_,{width:c.width,height:c.height,imgRef:V,className:`${p}-img`,alt:k,style:{transform:`translate3d(${ne.x}px, ${ne.y}px, 0) scale3d(${ne.flipX?"-":""}${pe}, ${ne.flipY?"-":""}${pe}, 1) rotate(${de}deg)`,transitionDuration:(!ee||le)&&"0s"},fallback:$,src:v,onWheel:ae,onMouseDown:ie,onDoubleClick:e=>{S&&(1!==pe?re({x:0,y:0,scale:1},"doubleClick"):ce(1+M,"doubleClick",e.clientX,e.clientY))},onTouchStart:ue,onTouchMove:me,onTouchEnd:fe,onTouchCancel:fe})),ge={url:v,alt:k,...R},ve=()=>{ce(1+M,"zoomIn")},ye=()=>{ce(1/(1+M),"zoomOut")},Ce=()=>{re({rotate:de+90},"rotateRight")},we=()=>{re({rotate:de-90},"rotateLeft")},xe=()=>{re({flipX:!ne.flipX},"flipX")},be=()=>{re({flipY:!ne.flipY},"flipY")},Ee=()=>{oe("reset")},ke=e=>{const t=I+e;t>=0&&t<=L-1&&(te(!1),oe(e<0?"prev":"next"),A?.(t,I))},Re=n(e=>{if(S){const{keyCode:t}=e;t===o.ESC&&Y?.(),J&&(t===o.LEFT?ke(-1):t===o.RIGHT&&ke(1))}});i.useEffect(()=>{if(S)return window.addEventListener("keydown",Re),()=>{window.removeEventListener("keydown",Re)}},[S]);const[$e,Ne]=i.useState(!1);a.useEffect(()=>{S&&Ne(!0)},[S]);const[Ye,Se]=i.useState(!1);r(()=>{S&&Se(!0)},[S]);const Te={...G.body};return K&&(Te.transformOrigin=`${K.x}px ${K.y}px`),a.createElement(u,{open:Ye,getContainer:P,autoLock:$e},a.createElement(l,{motionName:F,visible:Ye&&S,motionAppear:!0,motionEnter:!0,motionLeave:!0,onVisibleChanged:e=>{e||Ne(!1),T?.(e)}},({className:e,style:t})=>{const n={...G.root,...t};return U&&(n.zIndex=U),a.createElement("div",{className:s(p,g,B.root,e,{[`${p}-moving`]:se}),style:n},a.createElement("div",{className:s(`${p}-mask`,B.mask),style:G.mask,onClick:Y}),a.createElement("div",{className:s(`${p}-body`,B.body),style:Te},W?W(he,{transform:ne,image:ge,...q?{current:I}:{}}):he),!1!==O&&null!==O&&a.createElement(C,{prefixCls:p,icon:!0===O?X.close:O||X.close,onClick:Y}),J&&a.createElement(x,{prefixCls:p,current:I,count:L,icons:X,onActive:ke}),a.createElement(w,{prefixCls:p,showProgress:Q,current:I,count:L,showSwitch:J,classNames:B,styles:G,image:ge,transform:ne,icons:X,countRender:j,actionsRender:H,scale:pe,minScale:Z,maxScale:z,onActive:ke,onFlipY:be,onFlipX:xe,onRotateLeft:we,onRotateRight:Ce,onZoomOut:ye,onZoomIn:ve,onClose:Y,onReset:Ee}))}))},R=["crossOrigin","decoding","draggable","loading","referrerPolicy","sizes","srcSet","useMap","alt"];function $(){return $=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},$.apply(this,arguments)}let N=0;function Y(){return Y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},Y.apply(this,arguments)}const S=e=>{const{prefixCls:t="rc-image",previewPrefixCls:n=`${t}-preview`,rootClassName:o,className:r,style:a,classNames:l={},styles:u={},width:f,height:d,src:p,alt:h,placeholder:v,fallback:y,preview:C=!0,onClick:w,onError:x,...b}=e,E=i.useContext(m),$=!!C,{src:S,open:T,onOpenChange:X,cover:O,rootClassName:P,...I}=C&&"object"==typeof C?C:{},L="object"==typeof O&&O.placement&&O.placement||"center",j="object"==typeof O&&O.coverNode?O.coverNode:O,[M,Z]=c(!!T,T),[z,F]=i.useState(null),W=e=>{Z(e),X?.(e)},_=v&&!0!==v,H=S??p,[D,A,B]=g({src:p,isCustomPlaceholder:_,fallback:y}),G=i.useMemo(()=>{const t={};return R.forEach(n=>{void 0!==e[n]&&(t[n]=e[n])}),t},R.map(t=>e[t])),K=function(e,t){const[n]=i.useState(()=>(N+=1,String(N))),o=i.useContext(m),r={data:t,canPreview:e};return i.useEffect(()=>{if(o)return o.register(n,r)},[]),i.useEffect(()=>{o&&o.register(n,r)},[e,t]),n}($,i.useMemo(()=>({...G,src:H}),[H,G]));return i.createElement(i.Fragment,null,i.createElement("div",Y({},b,{className:s(t,o,l.root,{[`${t}-error`]:"error"===B}),onClick:$?e=>{const t=e.target.getBoundingClientRect(),n=t.x+t.width/2,o=t.y+t.height/2;E?E.onPreview(K,H,n,o):(F({x:n,y:o}),W(!0)),w?.(e)}:w,style:{width:f,height:d,...u.root}}),i.createElement("img",Y({},G,{className:s(`${t}-img`,{[`${t}-img-placeholder`]:!0===v},l.image,r),style:{height:d,...u.image,...a},ref:D},A,{width:f,height:d,onError:x})),"loading"===B&&i.createElement("div",{"aria-hidden":"true",className:`${t}-placeholder`},v),!1!==O&&$&&i.createElement("div",{className:s(`${t}-cover`,l.cover,`${t}-cover-${L}`),style:{display:"none"===a?.display?"none":void 0,...u.cover}},j)),!E&&$&&i.createElement(k,Y({"aria-hidden":!M,open:M,prefixCls:n,onClose:()=>{W(!1)},mousePosition:z,src:H,alt:h,imageInfo:{width:f,height:d},fallback:y,imgCommonProps:G},I,{classNames:l?.popup,styles:u?.popup,rootClassName:s(P,o)})))};S.PreviewGroup=({previewPrefixCls:e="rc-image-preview",classNames:t,styles:o,children:r,icons:s={},items:a,preview:l,fallback:u})=>{const{open:f,onOpenChange:d,current:p,onChange:h,...g}=l&&"object"==typeof l?l:{},[v,y,C]=function(e){const[t,n]=i.useState({}),o=i.useCallback((e,t)=>(n(n=>({...n,[e]:t})),()=>{n(t=>{const n={...t};return delete n[e],n})}),[]);return[i.useMemo(()=>e?e.map(e=>{if("string"==typeof e)return{data:{src:e}};const t={};return Object.keys(e).forEach(n=>{["src",...R].includes(n)&&(t[n]=e[n])}),{data:t}}):Object.keys(t).reduce((e,n)=>{const{canPreview:o,data:r}=t[n];return o&&e.push({data:r,id:n}),e},[]),[e,t]),o,!!e]}(a),[w,x]=c(0,p),[b,E]=i.useState(!1),{src:N,...Y}=v[w]?.data||{},[S,T]=c(!!f,f),X=n(e=>{T(e),e!==S&&d?.(e,{current:w})}),[O,P]=i.useState(null),I=i.useCallback((e,t,n,o)=>{const r=C?v.findIndex(e=>e.data.src===t):v.findIndex(t=>t.id===e);x(r<0?0:r),X(!0),P({x:n,y:o}),E(!0)},[v,C]);i.useEffect(()=>{S?b||x(0):E(!1)},[S]);const L=i.useMemo(()=>({register:y,onPreview:I}),[y,I]);return i.createElement(m.Provider,{value:L},r,i.createElement(k,$({"aria-hidden":!S,open:S,prefixCls:e,onClose:()=>{X(!1),P(null)},mousePosition:O,imgCommonProps:Y,src:N,fallback:u,icons:s,current:w,count:v.length,onChange:(e,t)=>{x(e),h?.(e,t)}},g,{classNames:t?.popup,styles:o?.popup})))};export{S as I};
