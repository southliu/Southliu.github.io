import{r as e,j as l}from"./react@19.2.3.DikTGMTS.js";import{q as t,a as n}from"./index.Dcz_rTgs.js";import{l as r}from"./lodash@4.17.21.CxmCRF7_.js";import{r as o}from"./react-resizable@3.1.2_react_5d246e7116c7c3f8eee3a59a08959a6f.D783z1Em.js";import{i as s}from"./is.BeBpkxAQ.js";import{D as i}from"./@dnd-kit_core@6.3.1_react-d_faeaa4ec592555ff24d378ec7b025ac6.ESzEybd1.js";import{C as a}from"./@dnd-kit_utilities@3.2.2_react@19.2.3.Zu-YmhMD.js";import{I as c}from"./@iconify_react@6.0.2_react@19.2.3.Cu4YUmvy.js";import{S as d,v as u,a as h,u as p}from"./@dnd-kit_sortable@10.0.0_@d_bb9a87c2c20c367037e96a5cfbc9db8c.C_1onwqd.js";import{C as f,h as m,B as g,i as x,T as v,s as b,j,k as w}from"./antd@6.1.3_react-dom@19.2.3_react@19.2.3__react@19.2.3.Ch9cb9eU.js";import{u as y}from"./react-i18next@16.5.1_i18nex_e0732ae603aefaca3ccb08379955d50d.7gdm5IiX.js";import{$ as S,n as H,a0 as C}from"./@ant-design_icons@6.1.0_rea_578d967b89ca52aedd84b4dfb2c6cf72.Dcsljnpe.js";function N(e){switch(e){case"large":return 62;case"middle":return 54;default:return 46}}function k(e){const l=r.cloneDeep(e);for(let n=0;n<(null==l?void 0:l.length);n++){const e=l[n];void 0===e.ellipsis&&(e.ellipsis=!0),e.render||(e.render=e=>e||(0===e?e:t))}return l}function T(e){const{onResize:t,width:n,...r}=e;return n?l.jsx(o.Resizable,{width:n,height:0,handle:l.jsx("span",{className:"react-resizable-handle",onClick:e=>{e.stopPropagation()}}),onResize:t,draggableOpts:{enableUserSelectHack:!1},children:l.jsx("th",{...r})}):l.jsx("th",{...r})}function _(e,l){switch(l.type){case"changeScroll":let t=l.curScrollTop||0,n=l.scrollHeight||0;const r=l.tableScrollY||0;return n<=0&&(n=0),0!==n&&r===e.tableScrollY&&(n=e.scrollHeight),e.scrollHeight&&t>e.scrollHeight&&(t=e.scrollHeight),{...e,curScrollTop:t,scrollHeight:n,tableScrollY:r};case"reset":return{...e,curScrollTop:0,scrollHeight:0};default:throw new Error("表格：未知错误类型!")}}const E=e.createContext({dispatch:void 0,renderLen:1,start:0,offsetStart:0,rowHeight:46,totalLen:0});function R(t){const{children:n,...r}=t,{renderLen:o,start:s,offsetStart:i}=e.useContext(E);let a=null;if(n&&null!==n){const e=null==n?void 0:n[1];a=Array.isArray(e)&&e.length?[null==n?void 0:n[0],e.slice(s,s+o).map(e=>Array.isArray(e)?e[0]:e)]:n}return l.jsx("tbody",{...r,style:{transform:"translateY(-".concat(i,"px)")},children:a})}const z={rowHeight:46,curScrollTop:0,scrollHeight:0,tableScrollY:0,total:0};let A=0;const I=e.memo(function(t){var n,o;const{style:i,children:a,...c}=t,{width:d,...u}=i,[h,p]=e.useReducer(_,z),f=e.useRef(null),m=e.useRef(null),g=z.total,x=e.useMemo(()=>{let e="auto";return h.rowHeight&&g&&(e=h.rowHeight*(g+1)),e},[h.rowHeight,g]);let v=0;v="string"==typeof A?null==(o=null==(n=f.current)?void 0:n.parentNode)?void 0:o.offsetHeight:A,s(x)&&Number(x)<v&&(v=x),v<=0&&(v=0);const b=e.useMemo(()=>{let e=1;if(h.rowHeight&&g&&v)if(v<=0)e=0;else{const l=5+(v/h.rowHeight|0);e=l>g?g:l}return e},[h.rowHeight,g,v]);let j=h.rowHeight?h.curScrollTop/h.rowHeight|0:0,w=h.rowHeight?h.curScrollTop%h.rowHeight:0;h.curScrollTop&&h.rowHeight&&h.curScrollTop>h.rowHeight?j>g-b?w=0:j>1&&(j-=1,w+=h.rowHeight):j=0,e.useEffect(()=>{var e;const l=null==(e=f.current)?void 0:e.parentNode;l&&(l.scrollTop=0),p({type:"reset"})},[g]);const y=e.useCallback(r.throttle(e=>{var l,t,n;const r=null!=(t=null==(l=null==e?void 0:e.target)?void 0:l.scrollTop)?t:0;if(r!==h.curScrollTop){const l=(null==(n=null==e?void 0:e.target)?void 0:n.scrollHeight)-v;p({type:"changeScroll",curScrollTop:r,scrollHeight:l,tableScrollY:v})}},60),[h.curScrollTop,v]);return e.useEffect(()=>{var e;const l=null==(e=null==f?void 0:f.current)?void 0:e.parentNode;if(l){const e=e=>y(e);return l.addEventListener("scroll",e),()=>{l.removeEventListener("scroll",e),y.cancel()}}},[f,y]),l.jsx("div",{className:"virtualTable",ref:f,style:{width:"100%",position:"relative",height:x,boxSizing:"border-box",paddingTop:h.curScrollTop},children:l.jsx(E.Provider,{value:{dispatch:p,rowHeight:h.rowHeight,start:j,offsetStart:w,renderLen:b,totalLen:g},children:l.jsx("table",{...c,ref:m,style:{...u,width:d,position:"relative"},children:a})})})},(e,l)=>e.style===l.style);function L(e){const{item:t}=e,{attributes:n,listeners:r,setNodeRef:o,transform:s,transition:i}=p({id:t.value}),d={transform:a.Transform.toString(s),transition:i};return l.jsxs("div",{ref:o,className:"\n        h-28px\n        flex\n        items-center\n        pl-5px\n        hover:bg-blue-100\n        border-rd-5px\n      ",style:d,...n,children:[l.jsx("div",{className:"h-28px pr-5px cursor-move flex items-center justify-center drag-handle",...r,children:l.jsx(c,{icon:"icon-park-outline:drag"})}),l.jsx(f,{value:t.value,className:"flex-1",children:t.label})]})}function B(e){const{list:t,handleDragEnd:n}=e;return l.jsx(i,{onDragEnd:e=>{const{active:l,over:r}=e;if(!r)return;const o=t.findIndex(e=>e.value===l.id),s=t.findIndex(e=>e.value===r.id),i=h(t,o,s);n(i)},children:l.jsx(d,{items:t.map(e=>e.value),strategy:u,children:null==t?void 0:t.map((e,t)=>l.jsx(L,{index:t,item:e},e.value))})})}const Y=e.memo(function(t){const{columns:n,cacheColumns:r,className:o,getTableChecks:s}=t,{t:i}=y(),[a,c]=e.useState(!1),[d,u]=e.useState([]),[h,p]=e.useState([]),v=d.length===h.length,b=h.length>0&&h.length<d.length,j={...t};delete j.getTableChecks,delete j.cacheColumns,e.useEffect(()=>{w(n)},[n]);const w=e=>{if(!(null==e?void 0:e.length))return[];const l=[],t=[];for(let n=0;n<(null==e?void 0:e.length);n++){const r=e[n],{dataIndex:o}=r;!r.hidden&&o&&(null==t||t.push(o)),l.push({label:r.title,value:o})}u(l),p(t)},H=e=>{p(e),C(e)},C=(e,l=d)=>{s(e,l.map(e=>e.value))},N=e=>{const l=e.target.checked?d.map(e=>e.value):[];p(l),C(l)},k=()=>{var e;const l=[],t=null==(e=null==r?void 0:r.map(e=>null==e?void 0:e.dataIndex))?void 0:e.filter(Boolean);for(let n=0;n<(null==r?void 0:r.length);n++){const e=r[n];l.push({label:e.title,value:e.dataIndex})}p(t),u(l),C(t,l)},T=e=>{u(e),s(h,e.map(e=>e.value))};return l.jsx(m,{content:()=>l.jsxs("div",{className:"min-w-140px flex flex-col",children:[l.jsx("div",{className:"px-5px",children:l.jsx(f,{className:"w-full !pl-10px !py-3px hover:bg-blue-100 border-rd-5px",indeterminate:b,onChange:N,checked:v,children:i("public.checkAll")})}),l.jsx(x,{className:"!my-5px"}),l.jsx(f.Group,{className:"flex flex-col !px-5px !pb-5px relative",value:h,onChange:H,children:l.jsx(B,{list:d,handleDragEnd:T})}),l.jsx(x,{className:"!mt-10px !mb-5px"}),l.jsx(g,{className:"flex-1 text-center",type:"link",size:"small",onClick:k,children:i("public.reset")})]}),trigger:"click",placement:"bottom",styles:{container:{padding:"8px 0 5px"}},open:a,onOpenChange:()=>{c(!a)},children:l.jsx("div",{...j,className:"".concat(o," inline-block"),children:l.jsx(g,{icon:l.jsx(S,{}),className:"small-btn",children:i("public.columnFilter")})})})},(e,l)=>e.columns===l.columns&&e.cacheColumns===l.cacheColumns),D=t=>{const{width:n,text:r,color:o,className:s="",style:i}=t,a=e.useRef(null),[c,d]=e.useState(!1),u=e.useCallback(()=>{const e=a.current;e&&d(e.scrollWidth>e.clientWidth)},[r,n,a.current]);e.useEffect(()=>{u()},[u]);const h={color:o,...i},p=l.jsx("span",{ref:a,className:"inline-block w-full overflow-hidden text-ellipsis whitespace-nowrap ".concat(s),style:h,children:r});return c?l.jsx(v,{title:r,placement:"top",children:p}):p};const M=e.memo(function(r){var o,s,i;const{isLoading:a,isVirtual:c,isCreate:d,isZebra:u=!0,isBordered:h=!0,isOperate:p=!0,isAuthHeight:f,scrollX:m,scrollY:x,rowClassName:v,size:S,leftContent:_,rightContent:E,getPage:L,onCreate:B}=r,{t:M}=y(),{isPhone:O}=n(),[P]=function(){const[l,t]=e.useState(!0);return[(e,n,r)=>{if(!(null==n?void 0:n.length)||!(null==e?void 0:e.length))return[];if(l)return t(!1),e||[];e.sort((e,l)=>r.indexOf(e.dataIndex)-r.indexOf(l.dataIndex));for(let l=0;l<(null==e?void 0:e.length);l++){const t=e[l];t.hidden=!n.includes(t.dataIndex)}return e}]}(),[W,q]=e.useState(k(r.columns)),F=e.useRef(null),[K,G]=e.useState([]),[U,V]=e.useState([]),X=null==(o=F.current)?void 0:o.querySelectorAll(".ant-table-row");e.useEffect(()=>{const e=k(r.columns),l=null==e?void 0:e.map(e=>e.dataIndex).filter(Boolean);q(e),G(l),V(l)},[r.columns]),e.useEffect(()=>{d&&!B&&b.warning(M("public.createMethodWarning"))},[d]),e.useEffect(()=>{p&&!L&&b.warning(M("public.getPageWarning"))},[L]);const Z=function(e){var l,t;const n=document.documentElement.clientHeight||document.body.clientHeight,r=(null==(t=null==(l=null==e?void 0:e.getBoundingClientRect)?void 0:l.call(e))?void 0:t.top)||0,o=document.getElementById("pagination"),s=n-r-((null==o?void 0:o.offsetHeight)||0);return s>0?s-65:450}(F.current),$=e.useCallback(e=>(l,{size:t})=>{const n=[...W];n[e]={...n[e],width:t.width},q(n)},[W]),J=e.useMemo(()=>{const e=P(W,K,U);if(!e)return[];return e.map((e,n)=>{var r;return{...e,ellipsis:null==(r=e.ellipsis)||r,fixed:!(!(null==e?void 0:e.fixed)||O&&!(null==e?void 0:e.isKeepFixed))&&e.fixed,onHeaderCell:(l,t)=>{var r;return{...null==(r=null==e?void 0:e.onHeaderCell)?void 0:r.call(e,l,t),width:e.width,onResize:$(n)}},onCell:(l,t)=>{var n,r,o;return{...null==(n=null==e?void 0:e.onCell)?void 0:n.call(e,l,t),style:{...null==(o=null==(r=null==e?void 0:e.onCell)?void 0:r.call(e,l,t))?void 0:o.style,maxWidth:e.width,width:e.width}}},render:(n,r,o)=>{var s;const i=null==(s=null==e?void 0:e.render)?void 0:s.call(e,n,r,o);let a,c=i,d="text",u=!1;const h=null==e?void 0:e.enum;if(h&&"object"==typeof h)if(Array.isArray(h))for(let e=0;e<(null==h?void 0:h.length);e++){const l=h[e];if(String(l.value)===String(c)){c=l.label,a=l.color,d=(null==l?void 0:l.type)||"text";break}}else for(const e in h)if(e===String(c)){c=h[e];break}if(Array.isArray(c)&&(u=null==c?void 0:c.every(e=>"string"==typeof e),u&&(c=(null==c?void 0:c.join(", "))||t)),!["object","function"].includes(typeof i)||u){const n=String(null!=c?c:t);return"tag"===d?l.jsx(j,{color:a,children:n}):void 0===e.ellipsis||e.ellipsis?l.jsx(D,{width:e.width,text:n,color:a,className:"break-all"}):l.jsx("span",{className:"break-all break-words whitespace-pre-wrap",children:n})}return i}}})},[W,K,U,O,S,P]),Q=function(e){const{height:l,rowHeight:t,total:n}=e;return A=l,z.rowHeight=t,z.total=n,{table:I,body:{wrapper:R}}}({height:Z,rowHeight:(null==(s=null==X?void 0:X[0])?void 0:s.clientHeight)||N(S),total:(null==(i=r.dataSource)?void 0:i.length)||0}),ee=e.useMemo(()=>({header:{cell:T},body:{wrapper:Q.body.wrapper},table:Q.table}),[Q]),le=c?ee:{header:{cell:T}},te={...r.scroll,x:null!=m?m:"max-content",y:null!=x?x:f?Z:void 0};return l.jsxs("div",{id:"table",className:"\n        overflow-auto\n        ".concat(!1!==h?"bordered":"","\n        ").concat(!1!==u?"zebra":"","\n      "),children:[p&&l.jsxs("div",{className:"flex justify-between !mb-10px",children:[l.jsxs("div",{className:"flex flex-wrap items-center gap-6px",children:[!!d&&l.jsx(g,{type:"primary",className:"small-btn",icon:l.jsx(H,{}),onClick:B,children:M("public.create")}),_]}),l.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-6px",children:[E?l.jsx("div",{children:E}):void 0,l.jsx(g,{className:"small-btn",icon:l.jsx(C,{className:"transform rotate-270",disabled:!!a}),onClick:L,children:M("public.refresh")}),l.jsx(Y,{columns:W,cacheColumns:r.columns,getTableChecks:(e,l)=>{G(e),V(l)}})]})]}),l.jsx("div",{ref:F,children:l.jsx(w,{size:"small",rowKey:"id",pagination:!1,loading:a,...r,rowClassName:(e,l,t)=>{const n="string"==typeof v?v:null==v?void 0:v(e,l,t);return"".concat(n||"")},style:{borderRadius:10,borderRight:"1px solid rgba(0, 0, 0, .05)",borderBottom:"1px solid rgba(0, 0, 0, .05)",overflow:"auto",...r.style},bordered:!1!==h,scroll:te,components:le,columns:J})})]})},(e,l)=>e.isLoading===l.isLoading&&e.dataSource===l.dataSource&&e.columns===l.columns);export{M as B};
