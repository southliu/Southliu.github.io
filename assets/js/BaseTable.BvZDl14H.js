import{r as e,j as l}from"./react@19.1.0.QBh3HWPD.js";import{t,w as n,u as r}from"./index.BLLfZWfb.js";import{l as o}from"./lodash@4.17.21.HHZ9h80f.js";import{r as s}from"./react-resizable@3.0.5_react-dom@19.1.0_react@19.1.0.DUvuNxA3.js";import{I as i}from"./@iconify_react@5.2.1_react@19.1.0.BMViFkUw.js";import{D as a}from"./react-draggable@4.4.6_react-dom@19.1.0_react@19.1.0.BjQ5V6d-.js";import{u as c}from"./react-i18next@15.5.2_i18next@25.2.1_react-dom@19.1.0_react@19.1.0_typescript@5.8.3.BPrJqYVj.js";import{w as d,B as u,C as h,x as p,s as g,y as f,T as v}from"./antd@5.25.4_react-dom@19.1.0_react@19.1.0.kHAmv6cZ.js";import{m,n as x,e as b}from"./@ant-design_icons@6.0.0_react-dom@19.1.0_react@19.1.0.BE6VjIg_.js";function j(e){switch(e){case"large":return 54;case"middle":return 46;default:return 38}}function w(e){const l=o.cloneDeep(e);for(let n=0;n<(null==l?void 0:l.length);n++){const e=l[n];void 0===e.ellipsis&&(e.ellipsis=!0),e.render||(e.render=e=>e||(0===e?e:t))}return l}function y(e){const{onResize:t,width:n,...r}=e;return n?l.jsx(s.Resizable,{width:n,height:0,handle:l.jsx("span",{className:"react-resizable-handle",onClick:e=>{e.stopPropagation()}}),onResize:t,draggableOpts:{enableUserSelectHack:!1},children:l.jsx("th",{...r})}):l.jsx("th",{...r})}function S(e,l){switch(l.type){case"changeScroll":let t=l.curScrollTop||0,n=l.scrollHeight||0;const r=l.tableScrollY||0;return n<=0&&(n=0),0!==n&&r===e.tableScrollY&&(n=e.scrollHeight),e.scrollHeight&&t>e.scrollHeight&&(t=e.scrollHeight),{...e,curScrollTop:t,scrollHeight:n,tableScrollY:r};case"reset":return{...e,curScrollTop:0,scrollHeight:0};default:throw new Error("表格：未知错误类型!")}}const H=e.createContext({dispatch:void 0,renderLen:1,start:0,offsetStart:0,rowHeight:46,totalLen:0});function N(t){const{children:n,...r}=t,{renderLen:o,start:s,offsetStart:i}=e.useContext(H);let a=null;if(n&&null!==n){const e=null==n?void 0:n[1];a=Array.isArray(e)&&e.length?[null==n?void 0:n[0],e.slice(s,s+o).map((e=>Array.isArray(e)?e[0]:e))]:n}return l.jsx("tbody",{...r,style:{transform:`translateY(-${i}px)`},children:a})}const C={rowHeight:38,curScrollTop:0,scrollHeight:0,tableScrollY:0};let k=0;function T(t){var r,s,i,a,c;const{style:d,children:u,...h}=t,{width:p,...g}=d,[f,v]=e.useReducer(S,C),m=e.useRef(null),x=e.useRef(null),[b,j]=e.useState((null==(i=null==(s=null==(r=null==u?void 0:u[2])?void 0:r.props)?void 0:s.data)?void 0:i.length)??0);e.useEffect((()=>{var e,l,t,r,o,s;n(null==(t=null==(l=null==(e=null==u?void 0:u[1])?void 0:e.props)?void 0:l.data)?void 0:t.length)&&j(null==(s=null==(o=null==(r=null==u?void 0:u[1])?void 0:r.props)?void 0:o.data)?void 0:s.length)}),[u]);const w=e.useMemo((()=>{let e="auto";return f.rowHeight&&b&&(e=f.rowHeight*b),e}),[f.rowHeight,b]);let y=0;y="string"==typeof k?null==(c=null==(a=m.current)?void 0:a.parentNode)?void 0:c.offsetHeight:k,n(w)&&Number(w)<y&&(y=w),y<=0&&(y=0);const N=e.useMemo((()=>{let e=1;if(f.rowHeight&&b&&y)if(y<=0)e=0;else{const l=5+(y/f.rowHeight|0);e=l>b?b:l}return e}),[f.rowHeight,b,y]);let T=f.rowHeight?f.curScrollTop/f.rowHeight|0:0,z=f.rowHeight?f.curScrollTop%f.rowHeight:0;f.curScrollTop&&f.rowHeight&&f.curScrollTop>f.rowHeight?T>b-N?z=0:T>1&&(T-=1,z+=f.rowHeight):T=0,e.useEffect((()=>{var e;const l=null==(e=m.current)?void 0:e.parentNode;l&&(l.scrollTop=0),v({type:"reset"})}),[b]);const _=o.throttle((e=>{var l,t;const n=(null==(l=null==e?void 0:e.target)?void 0:l.scrollTop)??0;if(n!==f.curScrollTop){const l=(null==(t=null==e?void 0:e.target)?void 0:t.scrollHeight)-y;v({type:"changeScroll",curScrollTop:n,scrollHeight:l,tableScrollY:y})}}),60);return e.useEffect((()=>{var e;const l=null==(e=null==m?void 0:m.current)?void 0:e.parentNode;return l&&l.addEventListener("scroll",(e=>_(e))),()=>{l.removeEventListener("scroll",(e=>_(e)))}}),[m,f.curScrollTop,y,f.scrollHeight,_]),l.jsx("div",{className:"virtualTable",ref:m,style:{width:"100%",position:"relative",height:w,boxSizing:"border-box",paddingTop:f.curScrollTop},children:l.jsx(H.Provider,{value:{dispatch:v,rowHeight:f.rowHeight,start:T,offsetStart:z,renderLen:N,totalLen:b},children:l.jsx("table",{...h,ref:x,style:{...g,width:p,position:"relative"},children:u})})})}function z(t){const{columns:n,cacheColumns:r,className:o,getTableChecks:s}=t,{t:g}=c(),[f,v]=e.useState(!1),[x,b]=e.useState([]),[j,w]=e.useState([]),[y,S]=e.useState(null),H=x.length===j.length,N=j.length>0&&j.length<x.length,C={...t},k=e.useRef({});delete C.getTableChecks,e.useEffect((()=>{T(n)}),[n]);const T=l=>{if(!(null==l?void 0:l.length))return[];const t=[],n=[],r={};for(let o=0;o<(null==l?void 0:l.length);o++){const s=l[o],{dataIndex:i}=s;!s.hidden&&i&&(null==n||n.push(i)),r[i]=e.createRef(),t.push({label:s.title,value:i})}b(t),k.current=r,w(n)},z=e=>{w(e),_(e)},_=(e,l=x)=>{s(e,l.map((e=>e.value)))},R=e=>{const l=e.target.checked?x.map((e=>e.value)):[];w(l),_(l)},E=()=>{var e;const l=[],t=null==(e=null==r?void 0:r.map((e=>null==e?void 0:e.dataIndex)))?void 0:e.filter(Boolean);for(let n=0;n<(null==r?void 0:r.length);n++){const e=r[n];l.push({label:e.title,value:e.dataIndex})}w(t),b(l),_(t,l)};return l.jsx(d,{content:()=>l.jsxs("div",{className:"min-w-140px flex flex-col",children:[l.jsx("div",{className:"px-5px",children:l.jsx(h,{className:"w-full !pl-10px !py-3px hover:bg-blue-100 border-rd-5px",indeterminate:N,onChange:R,checked:H,children:g("public.checkAll")})}),l.jsx(p,{className:"!my-5px"}),l.jsx(h.Group,{className:"flex flex-col !px-5px !pb-5px relative",value:j,onChange:z,children:null==x?void 0:x.map(((e,t)=>{var n,r;return l.jsx(a,{nodeRef:null==(n=k.current)?void 0:n[e.value],axis:"y",position:{x:0,y:t},bounds:"parent",handle:".drag-handle",onStart:()=>S(t),onStop:(e,l)=>((e,l)=>{let t=e+Math.round(l/28);t<0&&(t=0),t>=x.length&&(t=x.length-1);const n=[...x],[r]=n.splice(e,1);n.splice(t,0,r),b(n);const o=n.map((e=>e.value)).filter((e=>j.includes(e)));w(o),_(o,n),S(null)})(t,l.y),children:l.jsxs("div",{ref:null==(r=k.current)?void 0:r[e.value],className:`\n                  h-28px\n                  flex\n                  items-center\n                  pl-5px\n                  hover:bg-blue-100\n                  border-rd-5px\n                  ${y===t?"bg-blue-100 z-10":""}\n                `,style:{transition:"background 0.2s"},children:[l.jsx("div",{className:"h-28px pr-5px cursor-move flex items-center justify-center drag-handle",children:l.jsx(i,{icon:"icon-park-outline:drag"})}),l.jsx(h,{value:e.value,className:"flex-1",children:e.label})]})},e.value)}))}),l.jsx(p,{className:"!mt-10px !mb-5px"}),l.jsx(u,{className:"flex-1 text-center",type:"link",size:"small",onClick:E,children:g("public.reset")})]}),trigger:"click",placement:"bottom",styles:{body:{padding:"8px 0 5px"}},open:f,onOpenChange:()=>{v(!f)},children:l.jsx("div",{...C,className:`${o} inline-block`,children:l.jsx(u,{icon:l.jsx(m,{}),className:"small-btn",children:g("public.columnFilter")})})})}function _(n){const{isLoading:o,isVirtual:s,isCreate:i,isZebra:a=!0,isBordered:d=!0,isOperate:h=!0,isAuthHeight:p,scrollX:m,scrollY:S,rowClassName:H,size:_,leftContent:R,rightContent:E,getPage:A,onCreate:B}=n,{t:I}=c(),{isPhone:L}=r(),[$]=function(){const[l,t]=e.useState(!0);return[(e,n,r)=>{if(!(null==n?void 0:n.length)||!(null==e?void 0:e.length))return[];if(l)return t(!1),e||[];e.sort(((e,l)=>r.indexOf(e.dataIndex)-r.indexOf(l.dataIndex)));for(let l=0;l<(null==e?void 0:e.length);l++){const t=e[l];t.hidden=!n.includes(t.dataIndex)}return e}]}(),[Y,M]=e.useState(w(n.columns)),O=e.useRef(null),[P,W]=e.useState([]),[D,F]=e.useState([]);e.useEffect((()=>{const e=w(n.columns),l=null==e?void 0:e.map((e=>e.dataIndex)).filter(Boolean);M(e),W(l),F(l)}),[n.columns]),e.useEffect((()=>{i&&!B&&g.warning(I("public.createMethodWarning"))}),[i]),e.useEffect((()=>{h&&!A&&g.warning(I("public.getPageWarning"))}),[A]);const K=function(e){var l,t;const n=document.documentElement.clientHeight||document.body.clientHeight,r=(null==(t=null==(l=null==e?void 0:e.getBoundingClientRect)?void 0:l.call(e))?void 0:t.top)||0,o=document.getElementById("pagination"),s=n-r-((null==o?void 0:o.offsetHeight)||0);return s>0?s-65:450}(O.current),G=e=>(l,{size:t})=>{const n=[...Y];n[e]={...n[e],width:t.width},M(n)},U=function(e){const{height:l,size:t}=e;return k=l,C.rowHeight=j(t),{table:T,body:{wrapper:N}}}({height:K,size:_||"small"}),V=e.useMemo((()=>({header:{cell:y},body:{wrapper:U.body.wrapper},table:U.table})),[U]),X=s?V:{header:{cell:y}},Z={...n.scroll,x:m??"max-content",y:S??(p?K:void 0)};return l.jsxs("div",{id:"table",className:`\n        overflow-auto\n        ${!1!==d?"bordered":""}\n        ${!1!==a?"zebra":""}\n      `,children:[h&&l.jsxs("div",{className:"flex justify-between !mb-10px",children:[l.jsxs("div",{className:"flex flex-wrap items-center gap-6px",children:[!!i&&l.jsx(u,{type:"primary",className:"small-btn",icon:l.jsx(x,{}),onClick:B,children:I("public.create")}),R]}),l.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-6px",children:[E?l.jsx("div",{children:E}):void 0,l.jsx(u,{className:"small-btn",icon:l.jsx(b,{className:"transform rotate-270",disabled:!!o}),onClick:A,children:I("public.refresh")}),l.jsx(z,{columns:Y,cacheColumns:n.columns,getTableChecks:(e,l)=>{W(e),F(l)}})]})]}),l.jsx("div",{ref:O,children:l.jsx(f,{size:"small",rowKey:"id",pagination:!1,loading:o,...n,rowClassName:(e,l,t)=>`${("string"==typeof H?H:null==H?void 0:H(e,l,t))||""} ${`!h-${j(_)}px`}`,style:{borderRadius:10,borderRight:"1px solid rgba(0, 0, 0, .05)",borderBottom:"1px solid rgba(0, 0, 0, .05)",overflow:"auto",...n.style},bordered:!1!==d,scroll:Z,components:X,columns:(()=>{const e=$(Y,P,D);if(!e)return[];return e.map(((e,n)=>({...e,ellipsis:e.ellipsis??!0,fixed:!(!(null==e?void 0:e.fixed)||L&&!(null==e?void 0:e.isKeepFixed))&&e.fixed,onHeaderCell:(l,t)=>{var r;return{...null==(r=null==e?void 0:e.onHeaderCell)?void 0:r.call(e,l,t),width:e.width,onResize:G(n)}},onCell:(l,t)=>{var n,r,o;return{...null==(n=null==e?void 0:e.onCell)?void 0:n.call(e,l,t),style:{...null==(o=null==(r=null==e?void 0:e.onCell)?void 0:r.call(e,l,t))?void 0:o.style,maxWidth:e.width,width:e.width}}},render:(n,r,o)=>{var s;const i=null==(s=null==e?void 0:e.render)?void 0:s.call(e,n,r,o);let a,c=i;const d=null==e?void 0:e.enum;if(d&&"object"==typeof d)if(Array.isArray(d))for(let e=0;e<(null==d?void 0:d.length);e++){const l=d[e];if(String(l.value)===String(c)){c=l.label,a=l.color;break}}else for(const e in d)if(e===String(c)){c=d[e];break}return["object","function"].includes(typeof i)?i:l.jsx(v,{title:c,placement:"topLeft",children:l.jsx("span",{style:{color:a},className:"break-all",title:c,children:String(c??t)})})}})))})()})})]})}export{_ as B};
