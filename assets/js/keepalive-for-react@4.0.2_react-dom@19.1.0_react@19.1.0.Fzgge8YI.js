import{r as e,j as t}from"./react@19.1.0.C7ehVy-W.js";import{r as n}from"./react-dom@19.1.0_react@19.1.0.BAIWZmk7.js";function r(e){return null==e}function c(e){return"[object RegExp]"===Object.prototype.toString.call(e)}function s(e){return Array.isArray(e)}function i(e){return"function"==typeof e}function o(e){return{set:(t,n)=>(e.setAttribute(t,n),o(e))}}function a(e=100){let t;return new Promise(((n,c)=>{t=setTimeout((()=>{n(),r(t)||clearTimeout(t)}),e)}))}function u(e,t){return(s(e)?e:r(e)?[]:[e]).some((e=>c(e)?e.test(t):t===e))}function l(e){setTimeout(e,0)}const d=e.createContext({active:!1,refresh:()=>{},destroy:()=>Promise.resolve(),destroyAll:()=>Promise.resolve(),destroyOther:()=>Promise.resolve(),getCacheNodes:()=>[]}),f=e.memo((function(n){const{children:r,active:c,refresh:s,destroy:i,destroyAll:o,destroyOther:a,getCacheNodes:u}=n,l=e.useMemo((()=>({active:c,refresh:s,destroy:i,destroyAll:o,destroyOther:a,getCacheNodes:u})),[c,s,i,o,a,u]);return t.jsx(d.Provider,{value:l,children:r})}));"function"==typeof SuppressedError&&SuppressedError;const h="keepalive-cache-div";function m(e){return e?Array.from(e.children):[]}function v(e){e.forEach((e=>{e.classList.contains(h)&&e.remove()}))}function y(e,t){v(m(e)),e.appendChild(t),t.classList.remove("inactive"),t.classList.add("active")}function C(e,t){const n=m(e).filter((e=>e.classList.contains("active")&&e.getAttribute("data-cache-key")!==t));return n.forEach((e=>{e.classList.remove("active"),e.classList.add("inactive")})),n}const p=e.memo((function(r){const{errorElement:c=e.Fragment,cacheNodeClassName:s,children:i,cacheKey:l,exclude:d,include:f}=r,{active:m,renderCount:p,destroy:x,transition:g,viewTransition:A,duration:T,containerDivRef:j}=r,N=e.useRef(!1);N.current=N.current||m;const b=e.useMemo((()=>{const e=document.createElement("div");return o(e).set("data-cache-key",l).set("style","height: 100%").set("data-render-count",p.toString()),e.className=h+(s?` ${s}`:""),e}),[p,s]);return e.useEffect((()=>{const e=(n=l,r=d,(c=f)?u(c,n):!r||!u(r,n)),t=j.current;var n,r,c;if(t)if(g)(()=>{!function(e,t,n,r){new(n||(n=Promise))((function(t,c){function s(e){try{o(r.next(e))}catch(t){c(t)}}function i(e){try{o(r.throw(e))}catch(t){c(t)}}function o(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(e){e(r)}))).then(s,i)}o((r=r.apply(e,[])).next())}))}(this,0,void 0,(function*(){if(m){const e=C(t,l);if(yield a(T-40),v(e),t.contains(b))return;y(t,b)}else e||(yield a(T),x(l))}))})();else if(m){const e=()=>{v(C(t,l)),t.contains(b)||y(t,b)};A&&document.startViewTransition?document.startViewTransition(e):e()}else e||x(l)}),[m,j,l,d,f]),N.current?n.createPortal(t.jsx(c,{children:i}),b,l):null}),((e,t)=>e.active===t.active&&e.renderCount===t.renderCount&&e.children===t.children&&e.exclude===t.exclude&&e.include===t.include));function x(){return e.useRef()}function g(n){const{activeCacheKey:o,max:a=10,exclude:u,include:d,onBeforeActive:h,customContainerRef:m,cacheNodeClassName:v="cache-component",containerClassName:y="keep-alive-render",errorElement:C,transition:x=!1,viewTransition:g=!1,duration:A=200,children:T,aliveRef:j,maxAliveTime:N=0}=n,b=m||e.useRef(null),[w,E]=e.useState([]);e.useLayoutEffect((()=>{var t;r(o)||(t=()=>{E((e=>{const t=Date.now();if(e.find((e=>e.cacheKey===o)))return e.map((e=>{if(e.cacheKey===o){let n=!1;if(i(h)&&h(o),N){const r=e.lastActiveTime;if(s(N)){const e=N.find((e=>c(e.match)?e.match.test(o):e.match===o));e&&(n=e&&r+1e3*e.expire<t)}else n=r+1e3*N<t}return Object.assign(Object.assign({},e),{ele:T,lastActiveTime:t,renderCount:n?e.renderCount+1:e.renderCount})}return e}));if(i(h)&&h(o),e.length>a){const t=e.reduce(((e,t)=>e.lastActiveTime<t.lastActiveTime?e:t));e.splice(e.indexOf(t),1)}return[...e,{cacheKey:o,lastActiveTime:t,ele:T,renderCount:0}]}))},void 0!==e.startTransition&&i(e.startTransition)?e.startTransition(t):t())}),[o,T]);const O=e.useCallback((e=>{E((t=>{const n=e||o;return t.map((e=>e.cacheKey===n?Object.assign(Object.assign({},e),{renderCount:e.renderCount+1}):e))}))}),[E,o]),K=e.useCallback((e=>{const t=e||o,n=s(t)?t:[t];return new Promise((e=>{l((()=>{E((e=>[...e.filter((e=>!n.includes(e.cacheKey)))])),e()}))}))}),[E,o]),P=e.useCallback((()=>new Promise((e=>{l((()=>{E([]),e()}))}))),[E]),k=e.useCallback((e=>{const t=e||o;return new Promise((e=>{l((()=>{E((e=>[...e.filter((e=>e.cacheKey===t))])),e()}))}))}),[o,E]),R=e.useCallback((()=>w),[w]);return e.useImperativeHandle(j,(()=>({refresh:O,destroy:K,destroyAll:P,destroyOther:k,getCacheNodes:R}))),t.jsxs(e.Fragment,{children:[t.jsx("div",{ref:b,className:y,style:{height:"100%"}}),w.map((e=>{const{cacheKey:n,ele:r,renderCount:c}=e;return t.jsx(f,{active:o===n,refresh:O,destroy:K,destroyAll:P,destroyOther:k,getCacheNodes:R,children:t.jsx(p,{destroy:K,include:d,exclude:u,transition:x,viewTransition:g,duration:A,renderCount:c,containerDivRef:b,errorElement:C,active:o===n,cacheNodeClassName:v,cacheKey:n,children:r})},`${n}-${c}`)}))]})}const A=()=>e.useContext(d);const T=(t,n,r=!1)=>{!function(t,n,r=!1,c){const{active:s}=A(),o=e.useRef(!1);c((()=>{if(!s)return;if(r&&!o.current)return void(o.current=!0);const e=t();return()=>{i(e)&&e()}}),[s,...n])}(t,n,r,e.useEffect)};export{T as $,g as R,A as S,x as k};
