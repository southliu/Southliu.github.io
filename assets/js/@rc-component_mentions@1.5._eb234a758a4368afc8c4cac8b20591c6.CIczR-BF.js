import{c as e}from"./clsx@2.1.1.BvmCeSbq.js";import{B as t}from"./@rc-component_input@1.1.2_r_1c03f691cf199869e40e9ad757b3122a.B576X-cK.js";import{d as n,f as o,t as r,K as s}from"./@rc-component_util@1.4.0_re_a8b68d4fbe51b122ded4cf0ecf2ca619.D3_e-sfJ.js";import{r as a,e as l}from"./react@19.2.1.BpVBN_43.js";import{T as c}from"./@rc-component_textarea@1.1._a474e38c852e3eae75fb9bb75f036798.Cny0KHsH.js";import"./@rc-component_resize-observ_eaaccb47489da2719f35257c4ad9d3c9.BynXlAVv.js";import{T as i}from"./@rc-component_trigger@3.7.1_9234358db6ac4d4b221fe18208ab417c.KUVSKQ8O.js";import{E as u,M as p}from"./@rc-component_menu@1.1.5_re_da6e9a4264264ff4447421a5fe5a070f.YCn4PgqI.js";const f=a.createContext(null);function m(e){const{notFoundContent:t,activeIndex:n,setActiveIndex:o,selectOption:r,onFocus:s,onBlur:c,onScroll:i}=l.useContext(f),{prefixCls:m,options:d,opened:x}=e,b=d[n]||{},h=a.useRef(null);return a.useEffect(()=>{if(-1===n||!h.current||!x)return;const e=h.current?.findItem?.({key:b.key});e&&e.scrollIntoView({block:"nearest",inline:"nearest"})},[n,b.key,x]),l.createElement(u,{ref:h,prefixCls:`${m}-menu`,activeKey:b.key,onSelect:({key:e})=>{const t=d.find(({key:t})=>t===e);r(t)},onFocus:s,onBlur:c,onScroll:i},d.map((e,t)=>{const{key:n,disabled:r,className:s,style:a,label:c}=e;return l.createElement(p,{key:n,disabled:r,className:s,style:a,onMouseEnter:()=>{o(t)}},c)}),!d.length&&l.createElement(p,{disabled:!0},t))}const d={bottomRight:{points:["tl","br"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},bottomLeft:{points:["tr","bl"],offset:[0,4],overflow:{adjustX:1,adjustY:1}},topRight:{points:["bl","tr"],offset:[0,-4],overflow:{adjustX:1,adjustY:1}},topLeft:{points:["br","tl"],offset:[0,-4],overflow:{adjustX:1,adjustY:1}}},x=e=>{const{prefixCls:t,options:n,children:o,visible:r,transitionName:s,getPopupContainer:l,popupClassName:c,popupStyle:u,direction:p,placement:f}=e,x=`${t}-dropdown`,[b,h]=a.useState(!1),v=a.createElement(m,{prefixCls:x,options:n,opened:b}),C=a.useMemo(()=>{let e;return e="rtl"===p?"top"===f?"topLeft":"bottomLeft":"top"===f?"topRight":"bottomRight",e},[p,f]);return a.createElement(i,{prefixCls:x,popupVisible:r,popup:v,popupPlacement:C,popupMotion:{motionName:s},builtinPlacements:d,getPopupContainer:l,popupClassName:c,popupStyle:u,afterOpenChange:h},o)};function b(e){return(e||"").toLowerCase()}function h(e,t){const{measureLocation:n,prefix:o,targetText:r,selectionStart:s,split:a}=t;let l=e.slice(0,n);l[l.length-a.length]===a&&(l=l.slice(0,l.length-a.length)),l&&(l=`${l}${a}`);let c=function(e,t,n){const o=e[0];if(!o||o===n)return e;let r=e;const s=t.length;for(let a=0;a<s;a+=1){if(b(r[a])!==b(t[a])){r=r.slice(a);break}a===s-1&&(r=r.slice(s))}return r}(e.slice(s),r.slice(s-n-o.length),a);c.slice(0,a.length)===a&&(c=c.slice(a.length));const i=`${l}${o}${r}${a}`;return{text:`${i}${c}`,selectionLocation:i.length}}function v(e,t){return!t||-1===e.indexOf(t)}function C(e,{value:t=""}){const n=e.toLowerCase();return-1!==t.toLowerCase().indexOf(n)}const g=a.createContext({});function y(){return y=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},y.apply(this,arguments)}const E=a.forwardRef((t,i)=>{const{prefixCls:u,className:p,style:m,classNames:d,styles:b,prefix:E="@",split:N=" ",notFoundContent:S="Not Found",value:w,defaultValue:k,children:j,options:R,allowClear:O,hasWrapper:$,silent:P,validateSearch:_=v,filterOption:T=C,onChange:L,onKeyDown:I,onKeyUp:A,onPressEnter:F,onSearch:M,onSelect:z,onFocus:B,onBlur:D,transitionName:K,placement:U,direction:V,getPopupContainer:W,popupClassName:X,rows:Y=1,visible:H,onPopupScroll:G,...Q}=t,q=a.useMemo(()=>Array.isArray(E)?E:[E],[E]),J=a.useRef(null),Z=a.useRef(null),ee=a.useRef(null),te=()=>Z.current?.resizableTextArea?.textArea;l.useImperativeHandle(i,()=>({focus:()=>Z.current?.focus(),blur:()=>Z.current?.blur(),textarea:Z.current?.resizableTextArea?.textArea,nativeElement:J.current}));const[ne,oe]=a.useState(!1),[re,se]=a.useState(""),[ae,le]=a.useState(""),[ce,ie]=a.useState(0),[ue,pe]=a.useState(0),[fe,me]=a.useState(!1),de=o(t.id),[xe,be]=n(k||"",w),{open:he}=a.useContext(g);a.useEffect(()=>{ne&&ee.current&&(ee.current.scrollTop=te().scrollTop)},[ne]);const[ve,Ce,ge,ye]=l.useMemo(()=>{if(he)for(let e=0;e<q.length;e+=1){const t=q[e],n=xe.lastIndexOf(t);if(n>=0)return[!0,"",t,n]}return[ne,re,ae,ce]},[he,ne,q,xe,re,ae,ce]),Ee=l.useCallback(e=>{let t;return t=R&&R.length>0?R.map(e=>({...e,key:`${e?.key??e.value}-${de}`})):r(j).map(({props:e,key:t})=>({...e,label:e.children,key:`${t||e.value}-${de}`})),t.filter(t=>!1===T||T(e,t))},[R,de,j,T]),Ne=l.useMemo(()=>Ee(Ce),[Ee,Ce]),Se=function(){const[e,t]=a.useState({id:0,callback:null}),n=a.useCallback(e=>{t(({id:t})=>({id:t+1,callback:e}))},[]);return a.useEffect(()=>{e.callback?.()},[e]),n}(),we=e=>{oe(!1),ie(0),se(""),Se(e)},ke=e=>{be(e),L?.(e)},je=e=>{const{value:t=""}=e,{text:n,selectionLocation:o}=h(xe,{measureLocation:ye,targetText:t,prefix:ge,selectionStart:te()?.selectionStart,split:N});ke(n),we(()=>{var e,t;e=te(),t=o,e.setSelectionRange(t,t),e.blur(),e.focus()}),z?.(e,ge)},Re=a.useRef(),Oe=e=>{window.clearTimeout(Re.current),!fe&&e&&B&&B(e),me(!0)},$e=e=>{Re.current=window.setTimeout(()=>{me(!1),we(),D?.(e)},0)},Pe=l.useMemo(()=>{const e=b?.textarea?.resize??m?.resize,t={...b?.textarea};return void 0!==e&&(t.resize=e),{...b,textarea:t}},[m,b]),_e=l.createElement(l.Fragment,null,l.createElement(c,y({classNames:{textarea:d?.textarea},styles:Pe,ref:Z,value:xe},Q,{rows:Y,onChange:({target:{value:e}})=>{ke(e)},onKeyDown:e=>{const{which:t}=e;if(I?.(e),ve)if(t===s.UP||t===s.DOWN){const n=Ne.length,o=t===s.UP?-1:1;pe((ue+o+n)%n),e.preventDefault()}else if(t===s.ESC)we();else if(t===s.ENTER){if(e.preventDefault(),P)return;if(!Ne.length)return void we();const t=Ne[ue];je(t)}},onKeyUp:e=>{const{key:t,which:n}=e,o=function(e){const{selectionStart:t}=e;return e.value.slice(0,t)}(e.target),{location:r,prefix:a}=function(e,t){return t.reduce((t,n)=>{const o=e.lastIndexOf(n);return o>t.location?{location:o,prefix:n}:t},{location:-1,prefix:""})}(o,q);if(A?.(e),-1===[s.ESC,s.UP,s.DOWN,s.ENTER].indexOf(n))if(-1!==r){const e=o.slice(r+a.length),l=_(e,N),c=!!Ee(e).length;l?(t===a||"Shift"===t||n===s.ALT||"AltGraph"===t||ve||e!==Ce&&c)&&((e,t,n)=>{oe(!0),se(e),le(t),ie(n),pe(0)})(e,a,r):ve&&we(),M&&l&&M(e,a)}else ve&&we()},onPressEnter:e=>{!ve&&F&&F(e)},onFocus:Oe,onBlur:$e})),ve&&l.createElement("div",{ref:ee,className:`${u}-measure`},xe.slice(0,ye),l.createElement(f.Provider,{value:{notFoundContent:S,activeIndex:ue,setActiveIndex:pe,selectOption:je,onFocus:()=>{Oe()},onBlur:()=>{$e()},onScroll:e=>{G?.(e)}}},l.createElement(x,{prefixCls:u,transitionName:K,placement:U,direction:V,options:Ne,visible:!0,getPopupContainer:W,popupClassName:e(X,d?.popup),popupStyle:b?.popup},l.createElement("span",null,ge))),xe.slice(ye+ge.length)));return $?_e:l.createElement("div",{className:e(u,p),style:m,ref:J},_e)}),N=a.forwardRef(({suffix:o,prefixCls:r="rc-mentions",defaultValue:s,value:c,id:i,allowClear:u,onChange:p,classNames:f,styles:m,className:d,disabled:x,onClear:b,...h},v)=>{const C=!(!o&&!u),g=a.useRef(null),N=a.useRef(null);a.useImperativeHandle(v,()=>({...N.current,nativeElement:g.current?.nativeElement||N.current?.nativeElement}));const[S,w]=n(s||"",c),k=e=>{w(e),p?.(e)};return l.createElement(t,{suffix:o,prefixCls:r,value:S,allowClear:u,handleReset:()=>{k("")},className:e(r,d,{[`${r}-has-suffix`]:C}),classNames:f,disabled:x,ref:g,onClear:b},l.createElement(E,y({className:f?.mentions,styles:m,classNames:f,prefixCls:r,id:i,ref:N,onChange:k,disabled:x,hasWrapper:C},h)))});N.Option=()=>null;export{N as M};
