import{r as e,j as l}from"./react@19.1.0.QBh3HWPD.js";import{t,u as r}from"./index.CbzFokE6.js";import{r as n}from"./react-resizable@3.0.5_react-dom@19.1.0_react@19.1.0.DUvuNxA3.js";import{l as o}from"./lodash@4.17.21.HHZ9h80f.js";import{I as i}from"./@iconify_react@5.2.1_react@19.1.0.BMViFkUw.js";import{D as s}from"./react-draggable@4.4.6_react-dom@19.1.0_react@19.1.0.BjQ5V6d-.js";import{u as a}from"./react-i18next@15.5.2_i18next@25.2.1_react-dom@19.1.0_react@19.1.0_typescript@5.8.3.BPrJqYVj.js";import{w as c,B as d,C as u,x as h,s as p,y as g,T as f}from"./antd@5.25.4_react-dom@19.1.0_react@19.1.0.kHAmv6cZ.js";import{m as v,n as m,e as x}from"./@ant-design_icons@6.0.0_react-dom@19.1.0_react@19.1.0.BE6VjIg_.js";function b(e){switch(e){case"large":return 54;case"middle":return 46;default:return 38}}function j(e){for(let l=0;l<(null==e?void 0:e.length);l++){const r=e[l];void 0===r.ellipsis&&(r.ellipsis=!0),r.render||(r.render=e=>e||(0===e?e:t))}return e}function w(e){const{onResize:t,width:r,...o}=e;return r?l.jsx(n.Resizable,{width:r,height:0,handle:l.jsx("span",{className:"react-resizable-handle",onClick:e=>{e.stopPropagation()}}),onResize:t,draggableOpts:{enableUserSelectHack:!1},children:l.jsx("th",{...o})}):l.jsx("th",{...o})}function y(e,l){switch(l.type){case"changeScroll":let t=l.curScrollTop||0,r=l.scrollHeight||0;const n=l.tableScrollY||0;return r<=0&&(r=0),0!==r&&n===e.tableScrollY&&(r=e.scrollHeight),e.scrollHeight&&t>e.scrollHeight&&(t=e.scrollHeight),{...e,curScrollTop:t,scrollHeight:r,tableScrollY:n};case"reset":return{...e,curScrollTop:0,scrollHeight:0};default:throw new Error("表格：未知错误类型!")}}function S(e){return"number"==typeof e&&isFinite(e)}const H=e.createContext({dispatch:void 0,renderLen:1,start:0,offsetStart:0,rowHeight:46,totalLen:0});function N(t){const{children:r,...n}=t,{renderLen:o,start:i,offsetStart:s}=e.useContext(H);let a=null;if(r&&null!==r){const e=null==r?void 0:r[1];a=Array.isArray(e)&&e.length?[null==r?void 0:r[0],e.slice(i,i+o).map((e=>Array.isArray(e)?e[0]:e))]:r}return l.jsx("tbody",{...n,style:{transform:`translateY(-${s}px)`},children:a})}const C={rowHeight:38,curScrollTop:0,scrollHeight:0,tableScrollY:0};let T=0;function k(t){var r,n,i,s,a;const{style:c,children:d,...u}=t,{width:h,...p}=c,[g,f]=e.useReducer(y,C),v=e.useRef(null),m=e.useRef(null),[x,b]=e.useState((null==(i=null==(n=null==(r=null==d?void 0:d[2])?void 0:r.props)?void 0:n.data)?void 0:i.length)??0);e.useEffect((()=>{var e,l,t,r,n,o;S(null==(t=null==(l=null==(e=null==d?void 0:d[1])?void 0:e.props)?void 0:l.data)?void 0:t.length)&&b(null==(o=null==(n=null==(r=null==d?void 0:d[1])?void 0:r.props)?void 0:n.data)?void 0:o.length)}),[d]);const j=e.useMemo((()=>{let e="auto";return g.rowHeight&&x&&(e=g.rowHeight*x),e}),[g.rowHeight,x]);let w=0;w="string"==typeof T?null==(a=null==(s=v.current)?void 0:s.parentNode)?void 0:a.offsetHeight:T,S(j)&&Number(j)<w&&(w=j),w<=0&&(w=0);const N=e.useMemo((()=>{let e=1;if(g.rowHeight&&x&&w)if(w<=0)e=0;else{const l=5+(w/g.rowHeight|0);e=l>x?x:l}return e}),[g.rowHeight,x,w]);let k=g.rowHeight?g.curScrollTop/g.rowHeight|0:0,z=g.rowHeight?g.curScrollTop%g.rowHeight:0;g.curScrollTop&&g.rowHeight&&g.curScrollTop>g.rowHeight?k>x-N?z=0:k>1&&(k-=1,z+=g.rowHeight):k=0,e.useEffect((()=>{var e;const l=null==(e=v.current)?void 0:e.parentNode;l&&(l.scrollTop=0),f({type:"reset"})}),[x]);const _=o.throttle((e=>{var l,t;const r=(null==(l=null==e?void 0:e.target)?void 0:l.scrollTop)??0;if(r!==g.curScrollTop){const l=(null==(t=null==e?void 0:e.target)?void 0:t.scrollHeight)-w;f({type:"changeScroll",curScrollTop:r,scrollHeight:l,tableScrollY:w})}}),60);return e.useEffect((()=>{var e;const l=null==(e=null==v?void 0:v.current)?void 0:e.parentNode;return l&&l.addEventListener("scroll",(e=>_(e))),()=>{l.removeEventListener("scroll",(e=>_(e)))}}),[v,g.curScrollTop,w,g.scrollHeight,_]),l.jsx("div",{className:"virtualTable",ref:v,style:{width:"100%",position:"relative",height:j,boxSizing:"border-box",paddingTop:g.curScrollTop},children:l.jsx(H.Provider,{value:{dispatch:f,rowHeight:g.rowHeight,start:k,offsetStart:z,renderLen:N,totalLen:x},children:l.jsx("table",{...u,ref:m,style:{...p,width:h,position:"relative"},children:d})})})}function z(t){const{columns:r,className:n,getTableChecks:o}=t,{t:p}=a(),[g,f]=e.useState(!1),[m,x]=e.useState([]),[b,j]=e.useState([]),[w,y]=e.useState(null),S=m.length===b.length,H=b.length>0&&b.length<m.length,N={...t},C=e.useRef({});delete N.getTableChecks,e.useEffect((()=>{T(r)}),[r]);const T=l=>{if(!(null==l?void 0:l.length))return[];const t=[],r=[],n={};for(let o=0;o<(null==l?void 0:l.length);o++){const i=l[o],{dataIndex:s}=i;!i.hidden&&s&&(null==r||r.push(s)),n[s]=e.createRef(),t.push({label:i.title,value:s})}x(t),C.current=n,j(r)},k=e=>{j(e),z(e)},z=(e,l=m)=>{o(e,l.map((e=>e.value)))},_=e=>{const l=e.target.checked?m.map((e=>e.value)):[];j(l),z(l)};return l.jsx(c,{content:()=>l.jsxs("div",{className:"min-w-130px flex flex-col",children:[l.jsx("div",{className:"px-5px",children:l.jsx(u,{className:"w-full !pl-10px !py-3px hover:bg-blue-200 border-rd-5px",indeterminate:H,onChange:_,checked:S,children:p("public.checkAll")})}),l.jsx(h,{className:"!my-5px"}),l.jsx(u.Group,{className:"flex flex-col !px-5px !pb-5px relative",value:b,onChange:k,children:null==m?void 0:m.map(((e,t)=>{var r,n;return l.jsx(s,{nodeRef:null==(r=C.current)?void 0:r[e.value],axis:"y",position:{x:0,y:t},bounds:"parent",handle:".drag-handle",onStart:()=>y(t),onStop:(e,l)=>((e,l)=>{let t=e+Math.round(l/28);t<0&&(t=0),t>=m.length&&(t=m.length-1);const r=[...m],[n]=r.splice(e,1);r.splice(t,0,n),x(r);const o=r.map((e=>e.value)).filter((e=>b.includes(e)));j(o),z(o,r),y(null)})(t,l.y),children:l.jsxs("div",{ref:null==(n=C.current)?void 0:n[e.value],className:`\n                  h-28px\n                  flex\n                  items-center\n                  pl-5px\n                  hover:bg-blue-200\n                  border-rd-5px\n                  ${w===t?"bg-blue-100 z-10":""}\n                `,style:{transition:"background 0.2s"},children:[l.jsx("div",{className:"h-28px pr-5px cursor-move flex items-center justify-center drag-handle",children:l.jsx(i,{icon:"icon-park-outline:drag"})}),l.jsx(u,{value:e.value,className:"flex-1",children:e.label})]})},e.value)}))})]}),trigger:"click",placement:"bottom",styles:{body:{padding:"12px 0 10px"}},open:g,onOpenChange:()=>{f(!g)},children:l.jsx("div",{...N,className:`${n} inline-block`,children:l.jsx(d,{icon:l.jsx(v,{}),className:"small-btn",children:p("public.columnFilter")})})})}function _(n){const{isLoading:o,isVirtual:i,isCreate:s,isZebra:c=!0,isBordered:u=!0,isOperate:h=!0,isAuthHeight:v,scrollX:y,scrollY:S,rowClassName:H,size:_,leftContent:R,rightContent:E,getPage:A,onCreate:L}=n,{t:B}=a(),{isPhone:$}=r(),[I]=function(){const[l,t]=e.useState(!0);return[(e,r,n)=>{if(!(null==r?void 0:r.length)||!(null==e?void 0:e.length))return[];if(l)return t(!1),e||[];e.sort(((e,l)=>n.indexOf(e.dataIndex)-n.indexOf(l.dataIndex)));for(let l=0;l<(null==e?void 0:e.length);l++){const t=e[l];t.hidden=!r.includes(t.dataIndex)}return e}]}(),[Y,M]=e.useState(j(n.columns)),O=e.useRef(null),[P,F]=e.useState([]),[W,K]=e.useState([]);e.useEffect((()=>{const e=j(n.columns),l=null==e?void 0:e.map((e=>e.dataIndex)).filter(Boolean);M(e),F(l),K(l)}),[n.columns]),e.useEffect((()=>{s&&!L&&p.warning(B("public.createMethodWarning"))}),[s]),e.useEffect((()=>{h&&!A&&p.warning(B("public.getPageWarning"))}),[A]);const D=function(e){var l,t;const r=document.documentElement.clientHeight||document.body.clientHeight,n=(null==(t=null==(l=null==e?void 0:e.getBoundingClientRect)?void 0:l.call(e))?void 0:t.top)||0,o=document.getElementById("pagination"),i=r-n-((null==o?void 0:o.offsetHeight)||0);return i>0?i-65:450}(O.current),G=e=>(l,{size:t})=>{const r=[...Y];r[e]={...r[e],width:t.width},M(r)},U=function(e){const{height:l,size:t}=e;return T=l,C.rowHeight=b(t),{table:k,body:{wrapper:N}}}({height:D,size:_||"small"}),V=e.useMemo((()=>({header:{cell:w},body:{wrapper:U.body.wrapper},table:U.table})),[U]),X=i?V:{header:{cell:w}},Z={...n.scroll,x:y??"max-content",y:S??(v?D:void 0)};return l.jsxs("div",{id:"table",className:`\n        overflow-auto\n        ${!1!==u?"bordered":""}\n        ${!1!==c?"zebra":""}\n      `,children:[h&&l.jsxs("div",{className:"flex justify-between !mb-10px",children:[l.jsxs("div",{className:"flex flex-wrap items-center gap-6px",children:[!!s&&l.jsx(d,{type:"primary",className:"small-btn",icon:l.jsx(m,{}),onClick:L,children:B("public.create")}),R]}),l.jsxs("div",{className:"flex flex-wrap items-center justify-end gap-6px",children:[E?l.jsx("div",{children:E}):void 0,l.jsx(d,{className:"small-btn",icon:l.jsx(x,{className:"transform rotate-270",disabled:!!o}),onClick:A,children:B("public.refresh")}),l.jsx(z,{columns:Y,getTableChecks:(e,l)=>{F(e),K(l)}})]})]}),l.jsx("div",{ref:O,children:l.jsx(g,{size:"small",rowKey:"id",pagination:!1,loading:o,...n,rowClassName:(e,l,t)=>`${("string"==typeof H?H:null==H?void 0:H(e,l,t))||""} ${`!h-${b(_)}px`}`,style:{borderRadius:10,borderRight:"1px solid rgba(0, 0, 0, .05)",borderBottom:"1px solid rgba(0, 0, 0, .05)",overflow:"auto",...n.style},bordered:!1!==u,scroll:Z,components:X,columns:(()=>{const e=I(Y,P,W);if(!e)return[];return e.map(((e,r)=>({...e,ellipsis:e.ellipsis??!0,fixed:!(!(null==e?void 0:e.fixed)||$&&!(null==e?void 0:e.isKeepFixed))&&e.fixed,onHeaderCell:(l,t)=>{var n;return{...null==(n=null==e?void 0:e.onHeaderCell)?void 0:n.call(e,l,t),width:e.width,onResize:G(r)}},onCell:(l,t)=>{var r,n,o;return{...null==(r=null==e?void 0:e.onCell)?void 0:r.call(e,l,t),style:{...null==(o=null==(n=null==e?void 0:e.onCell)?void 0:n.call(e,l,t))?void 0:o.style,maxWidth:e.width,width:e.width}}},render:(r,n,o)=>{var i;const s=null==(i=null==e?void 0:e.render)?void 0:i.call(e,r,n,o);let a,c=s;const d=null==e?void 0:e.enum;if(d&&"object"==typeof d)if(Array.isArray(d))for(let e=0;e<(null==d?void 0:d.length);e++){const l=d[e];if(String(l.value)===String(c)){c=l.label,a=l.color;break}}else for(const e in d)if(e===String(c)){c=d[e];break}return["object","function"].includes(typeof s)?s:l.jsx(f,{title:c,placement:"topLeft",children:l.jsx("span",{style:{color:a},className:"break-all",title:c,children:String(c??t)})})}})))})()})})]})}export{_ as B};
