import{x as e,d as n,u as t,K as r,A as a}from"./rc-util.b2252098.js";import{d as o,g as l,c as u,b as i,e as c,h as d,f as s}from"./@babel_runtime.d775819b.js";import{u as f,b as v,B as p}from"./rc-select.d5a0882c.js";import{r as h}from"./react.a7da97a2.js";import{d as m,c as y,T as g}from"./rc-tree.ae71b273.js";import"./classnames.71976509.js";import"./react-is.90ab392a.js";function b(e){return!e||e.disabled||e.disableCheckbox||!1===e.checkable}function k(e){return null==e}var C=function(){return null},E=["children","value"];function w(n){return e(n).map((function(e){if(!h.isValidElement(e)||!e.type)return null;var n=e,t=n.key,r=n.props,a=r.children,l=r.value,i=u(r,E),c=o({key:t,value:l},i),d=w(a);return d.length&&(c.children=d),c})).filter((function(e){return e}))}function x(e){if(!e)return e;var t=o({},e);return"props"in t||Object.defineProperty(t,"props",{get:function(){return n(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),t}}),t}function S(e){var n=h.useRef();n.current=e;var t=h.useCallback((function(){return n.current.apply(n,arguments)}),[]);return t}function D(e,n,t){return h.useMemo((function(){return e?t?function(e,n){var t=n.id,r=n.pId,a=n.rootPId,l={},u=[];return e.map((function(e){var n=o({},e),r=n[t];return l[r]=n,n.key=n.key||r,n})).forEach((function(e){var n=e[r],t=l[n];t&&(t.children=t.children||[],t.children.push(e)),(n===a||!t&&null===a)&&u.push(e)})),u}(e,o({id:"id",pId:"pId",rootPId:null},!0!==t?t:{})):e:w(n)}),[n,t,e])}var N=h.createContext(null),L=h.createContext(null),M={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},K=function(e,n){var a=f(),o=a.prefixCls,u=a.multiple,i=a.searchValue,s=a.toggleOpen,v=a.open,p=a.notFoundContent,m=h.useContext(L),y=m.virtual,k=m.listHeight,C=m.listItemHeight,E=m.treeData,w=m.fieldNames,x=m.onSelect,S=m.dropdownMatchSelectWidth,D=m.treeExpandAction,K=h.useContext(N),I=K.checkable,V=K.checkedKeys,T=K.halfCheckedKeys,P=K.treeExpandedKeys,A=K.treeDefaultExpandAll,H=K.treeDefaultExpandedKeys,O=K.onTreeExpand,W=K.treeIcon,j=K.showTreeIcon,R=K.switcherIcon,_=K.treeLine,F=K.treeNodeFilterProp,U=K.loadData,G=K.treeLoadedKeys,J=K.treeMotion,B=K.onTreeLoad,q=K.keyEntities,z=h.useRef(),Q=t((function(){return E}),[v,E],(function(e,n){return n[0]&&e[1]!==n[1]})),X=h.useMemo((function(){return I?{checked:V,halfChecked:T}:null}),[I,V,T]);h.useEffect((function(){var e;v&&!u&&V.length&&(null===(e=z.current)||void 0===e||e.scrollTo({key:V[0]}))}),[v]);var Y=String(i).toLowerCase(),Z=h.useState(H),$=c(Z,2),ee=$[0],ne=$[1],te=h.useState(null),re=c(te,2),ae=re[0],oe=re[1],le=h.useMemo((function(){return P?l(P):i?ae:ee}),[ee,ae,P,i]);h.useEffect((function(){i&&oe(function(e,n){var t=[];return function e(r){r.forEach((function(r){var a=r[n.children];a&&(t.push(r[n.value]),e(a))}))}(e),t}(E,w))}),[i]);var ue=function(e){e.preventDefault()},ie=function(e,n){var t=n.node;I&&b(t)||(x(t.key,{selected:!V.includes(t.key)}),u||s(!1))},ce=h.useState(null),de=c(ce,2),se=de[0],fe=de[1],ve=q[se];if(h.useImperativeHandle(n,(function(){var e;return{scrollTo:null===(e=z.current)||void 0===e?void 0:e.scrollTo,onKeyDown:function(e){var n;switch(e.which){case r.UP:case r.DOWN:case r.LEFT:case r.RIGHT:null===(n=z.current)||void 0===n||n.onKeyDown(e);break;case r.ENTER:if(ve){var t=(null==ve?void 0:ve.node)||{},a=t.selectable,o=t.value;!1!==a&&ie(0,{node:{key:se},selected:!V.includes(o)})}break;case r.ESC:s(!1)}},onKeyUp:function(){}}})),0===Q.length)return h.createElement("div",{role:"listbox",className:"".concat(o,"-empty"),onMouseDown:ue},p);var pe={fieldNames:w};return G&&(pe.loadedKeys=G),le&&(pe.expandedKeys=le),h.createElement("div",{onMouseDown:ue},ve&&v&&h.createElement("span",{style:M,"aria-live":"assertive"},ve.node.value),h.createElement(g,d({ref:z,focusable:!1,prefixCls:"".concat(o,"-tree"),treeData:Q,height:k,itemHeight:C,virtual:!1!==y&&!1!==S,multiple:u,icon:W,showIcon:j,switcherIcon:R,showLine:_,loadData:i?null:U,motion:J,activeKey:se,checkable:I,checkStrictly:!0,checkedKeys:X,selectedKeys:I?[]:V,defaultExpandAll:A},pe,{onActiveChange:fe,onSelect:ie,onCheck:ie,onExpand:function(e){ne(e),oe(e),O&&O(e)},onLoad:B,filterTreeNode:function(e){return!!Y&&String(e[F]).toLowerCase().includes(Y)},expandAction:D})))},I=h.forwardRef(K);I.displayName="OptionList";var V="SHOW_ALL",T="SHOW_PARENT",P="SHOW_CHILD";function A(e,n,t,r){var a=new Set(e);return n===P?e.filter((function(e){var n=t[e];return!(n&&n.children&&n.children.some((function(e){var n=e.node;return a.has(n[r.value])}))&&n.children.every((function(e){var n=e.node;return b(n)||a.has(n[r.value])})))})):n===T?e.filter((function(e){var n=t[e],r=n?n.parent:null;return!(r&&!b(r.node)&&a.has(r.key))})):e}var H=["id","prefixCls","value","defaultValue","onChange","onSelect","onDeselect","searchValue","inputValue","onSearch","autoClearSearchValue","filterTreeNode","treeNodeFilterProp","showCheckedStrategy","treeNodeLabelProp","multiple","treeCheckable","treeCheckStrictly","labelInValue","fieldNames","treeDataSimpleMode","treeData","children","loadData","treeLoadedKeys","onTreeLoad","treeDefaultExpandAll","treeExpandedKeys","treeDefaultExpandedKeys","onTreeExpand","treeExpandAction","virtual","listHeight","listItemHeight","onDropdownVisibleChange","dropdownMatchSelectWidth","treeLine","treeIcon","showTreeIcon","switcherIcon","treeMotion"];var O=h.forwardRef((function(e,t){var r,f,g=e.id,b=e.prefixCls,E=void 0===b?"rc-tree-select":b,w=e.value,M=e.defaultValue,K=e.onChange,T=e.onSelect,O=e.onDeselect,W=e.searchValue,j=e.inputValue,R=e.onSearch,_=e.autoClearSearchValue,F=void 0===_||_,U=e.filterTreeNode,G=e.treeNodeFilterProp,J=void 0===G?"value":G,B=e.showCheckedStrategy,q=e.treeNodeLabelProp,z=e.multiple,Q=e.treeCheckable,X=e.treeCheckStrictly,Y=e.labelInValue,Z=e.fieldNames,$=e.treeDataSimpleMode,ee=e.treeData,ne=e.children,te=e.loadData,re=e.treeLoadedKeys,ae=e.onTreeLoad,oe=e.treeDefaultExpandAll,le=e.treeExpandedKeys,ue=e.treeDefaultExpandedKeys,ie=e.onTreeExpand,ce=e.treeExpandAction,de=e.virtual,se=e.listHeight,fe=void 0===se?200:se,ve=e.listItemHeight,pe=void 0===ve?20:ve,he=e.onDropdownVisibleChange,me=e.dropdownMatchSelectWidth,ye=void 0===me||me,ge=e.treeLine,be=e.treeIcon,ke=e.showTreeIcon,Ce=e.switcherIcon,Ee=e.treeMotion,we=u(e,H),xe=v(g),Se=Q&&!X,De=Q||X,Ne=X||Y,Le=De||z,Me=a(M,{value:w}),Ke=c(Me,2),Ie=Ke[0],Ve=Ke[1],Te=h.useMemo((function(){return Q?B||P:V}),[B,Q]),Pe=h.useMemo((function(){return function(e){var n=e||{},t=n.label,r=n.value||"value";return{_title:t?[t]:["title","label"],value:r,key:r,children:n.children||"children"}}(Z)}),[JSON.stringify(Z)]),Ae=a("",{value:void 0!==W?W:j,postState:function(e){return e||""}}),He=c(Ae,2),Oe=He[0],We=He[1],je=D(ee,ne,$),Re=function(e,n){return h.useMemo((function(){return y(e,{fieldNames:n,initWrapper:function(e){return o(o({},e),{},{valueEntities:new Map})},processEntity:function(e,t){var r=e.node[n.value];t.valueEntities.set(r,e)}})}),[e,n])}(je,Pe),_e=Re.keyEntities,Fe=Re.valueEntities,Ue=h.useCallback((function(e){var n=[],t=[];return e.forEach((function(e){Fe.has(e)?t.push(e):n.push(e)})),{missingRawValues:n,existRawValues:t}}),[Fe]),Ge=function(e,n,t){var r=t.treeNodeFilterProp,a=t.filterTreeNode,l=t.fieldNames.children;return h.useMemo((function(){if(!n||!1===a)return e;var t;if("function"==typeof a)t=a;else{var u=n.toUpperCase();t=function(e,n){var t=n[r];return String(t).toUpperCase().includes(u)}}return function e(r){var a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return r.reduce((function(r,u){var c=u[l],d=a||t(n,x(u)),s=e(c||[],d);return(d||s.length)&&r.push(o(o({},u),{},i({isLeaf:void 0},l,s))),r}),[])}(e)}),[e,n,l,r,a])}(je,Oe,{fieldNames:Pe,treeNodeFilterProp:J,filterTreeNode:U}),Je=h.useCallback((function(e){if(e){if(q)return e[q];for(var n=Pe._title,t=0;t<n.length;t+=1){var r=e[n[t]];if(void 0!==r)return r}}}),[Pe,q]),Be=h.useCallback((function(e){var n=function(e){return Array.isArray(e)?e:void 0!==e?[e]:[]}(e);return n.map((function(e){return function(e){return!e||"object"!==s(e)}(e)?{value:e}:e}))}),[]),qe=h.useCallback((function(e){return Be(e).map((function(e){var n,t,r=e.label,a=e.value,o=e.halfChecked,l=Fe.get(a);if(l)r=null!==(t=r)&&void 0!==t?t:Je(l.node),n=l.node.disabled;else if(void 0===r){r=Be(Ie).find((function(e){return e.value===a})).label}return{label:r,value:a,halfChecked:o,disabled:n}}))}),[Fe,Je,Be,Ie]),ze=h.useMemo((function(){return Be(Ie)}),[Be,Ie]),Qe=h.useMemo((function(){var e=[],n=[];return ze.forEach((function(t){t.halfChecked?n.push(t):e.push(t)})),[e,n]}),[ze]),Xe=c(Qe,2),Ye=Xe[0],Ze=Xe[1],$e=h.useMemo((function(){return Ye.map((function(e){return e.value}))}),[Ye]),en=function(e,n,t,r){return h.useMemo((function(){var a=e.map((function(e){return e.value})),o=n.map((function(e){return e.value})),u=a.filter((function(e){return!r[e]}));if(t){var i=m(a,!0,r);a=i.checkedKeys,o=i.halfCheckedKeys}return[Array.from(new Set([].concat(l(u),l(a)))),o]}),[e,n,t,r])}(Ye,Ze,Se,_e),nn=c(en,2),tn=nn[0],rn=nn[1],an=h.useMemo((function(){var e=A(tn,Te,_e,Pe).map((function(e){var n,t,r;return null!==(n=null===(t=_e[e])||void 0===t||null===(r=t.node)||void 0===r?void 0:r[Pe.value])&&void 0!==n?n:e})).map((function(e){var n=Ye.find((function(n){return n.value===e}));return{value:e,label:null==n?void 0:n.label}})),n=qe(e),t=n[0];return!Le&&t&&k(t.value)&&k(t.label)?[]:n.map((function(e){var n;return o(o({},e),{},{label:null!==(n=e.label)&&void 0!==n?n:e.value})}))}),[Pe,Le,tn,Ye,qe,Te,_e]),on=(r=an,f=h.useRef({valueLabels:new Map}),h.useMemo((function(){var e=f.current.valueLabels,n=new Map,t=r.map((function(t){var r,a=t.value,l=null!==(r=t.label)&&void 0!==r?r:e.get(a);return n.set(a,l),o(o({},t),{},{label:l})}));return f.current.valueLabels=n,[t]}),[r])),ln=c(on,1)[0],un=S((function(e,t,r){var a=qe(e);if(Ve(a),F&&We(""),K){var o=e;if(Se){var u=A(e,Te,_e,Pe);o=u.map((function(e){var n=Fe.get(e);return n?n.node[Pe.value]:e}))}var i=t||{triggerValue:void 0,selected:void 0},c=i.triggerValue,d=i.selected,s=o;if(X){var f=Ze.filter((function(e){return!o.includes(e.value)}));s=[].concat(l(s),l(f))}var v=qe(s),p={preValue:Ye,triggerValue:c},m=!0;(X||"selection"===r&&!d)&&(m=!1),function(e,t,r,a,o,l){var u=null,i=null;function c(){i||(i=[],function e(n){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"0",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n.map((function(n,c){var d="".concat(a,"-").concat(c),s=n[l.value],f=r.includes(s),v=e(n[l.children]||[],d,f),p=h.createElement(C,n,v.map((function(e){return e.node})));if(t===s&&(u=p),f){var m={pos:d,node:p,children:v};return o||i.push(m),m}return null})).filter((function(e){return e}))}(a),i.sort((function(e,n){var t=e.node.props.value,a=n.node.props.value;return r.indexOf(t)-r.indexOf(a)})))}Object.defineProperty(e,"triggerNode",{get:function(){return n(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),c(),u}}),Object.defineProperty(e,"allCheckedNodes",{get:function(){return n(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),c(),o?i:i.map((function(e){return e.node}))}})}(p,c,e,je,m,Pe),De?p.checked=d:p.selected=d;var y=Ne?v:v.map((function(e){return e.value}));K(Le?y:y[0],Ne?null:v.map((function(e){return e.label})),p)}})),cn=h.useCallback((function(e,n){var t,r=n.selected,a=n.source,o=_e[e],u=null==o?void 0:o.node,i=null!==(t=null==u?void 0:u[Pe.value])&&void 0!==t?t:e;if(Le){var c=r?[].concat(l($e),[i]):tn.filter((function(e){return e!==i}));if(Se){var d,s=Ue(c),f=s.missingRawValues,v=s.existRawValues.map((function(e){return Fe.get(e).key}));if(r)d=m(v,!0,_e).checkedKeys;else d=m(v,{checked:!1,halfCheckedKeys:rn},_e).checkedKeys;c=[].concat(l(f),l(d.map((function(e){return _e[e].node[Pe.value]}))))}un(c,{selected:r,triggerValue:i},a||"option")}else un([i],{selected:!0,triggerValue:i},"option");r||!Le?null==T||T(i,x(u)):null==O||O(i,x(u))}),[Ue,Fe,_e,Pe,Le,$e,un,Se,T,O,tn,rn]),dn=h.useCallback((function(e){if(he){var t={};Object.defineProperty(t,"documentClickClose",{get:function(){return n(!1,"Second param of `onDropdownVisibleChange` has been removed."),!1}}),he(e,t)}}),[he]),sn=S((function(e,n){var t=e.map((function(e){return e.value}));"clear"!==n.type?n.values.length&&cn(n.values[0].value,{selected:!1,source:"selection"}):un(t,{},"selection")})),fn=h.useMemo((function(){return{virtual:de,dropdownMatchSelectWidth:ye,listHeight:fe,listItemHeight:pe,treeData:Ge,fieldNames:Pe,onSelect:cn,treeExpandAction:ce}}),[de,ye,fe,pe,Ge,Pe,cn,ce]),vn=h.useMemo((function(){return{checkable:De,loadData:te,treeLoadedKeys:re,onTreeLoad:ae,checkedKeys:tn,halfCheckedKeys:rn,treeDefaultExpandAll:oe,treeExpandedKeys:le,treeDefaultExpandedKeys:ue,onTreeExpand:ie,treeIcon:be,treeMotion:Ee,showTreeIcon:ke,switcherIcon:Ce,treeLine:ge,treeNodeFilterProp:J,keyEntities:_e}}),[De,te,re,ae,tn,rn,oe,le,ue,ie,be,Ee,ke,Ce,ge,J,_e]);return h.createElement(L.Provider,{value:fn},h.createElement(N.Provider,{value:vn},h.createElement(p,d({ref:t},we,{id:xe,prefixCls:E,mode:Le?"multiple":void 0,displayValues:ln,onDisplayValuesChange:sn,searchValue:Oe,onSearch:function(e){We(e),null==R||R(e)},OptionList:I,emptyOptions:!je.length,onDropdownVisibleChange:dn,dropdownMatchSelectWidth:ye}))))}));O.TreeNode=C,O.SHOW_ALL=V,O.SHOW_PARENT=T,O.SHOW_CHILD=P;export{O as G,V as S,C as T,T as a,P as b};
