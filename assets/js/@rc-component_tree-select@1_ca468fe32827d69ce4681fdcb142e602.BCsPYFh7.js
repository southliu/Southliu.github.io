import{t as e,b as t,u as l,e as n,K as r,f as a,d as o}from"./@rc-component_util@1.7.0_re_97ed4941f5d27d044aa2ecbc4a75f304.BwjZ45jd.js";import{u as s,B as c}from"./@rc-component_select@1.4.0__72937b420adc00cfcd381e86fe79d4ff.8MZYS8R4.js";import{r as u}from"./react@19.2.3.DikTGMTS.js";import{a as i,c as d,U as p,T as f}from"./@rc-component_tree@1.1.0_re_16b118318364c8e3af872a05fdf7f126.BEof-dAA.js";import"./react-dom@19.2.3_react@19.2.3.CfFRTaoX.js";import"./@rc-component_resize-observ_a5d141e3de655ef602de0c6d9e51ffb4.BcYDcD7g.js";import"./@rc-component_motion@1.1.6__75bed58c5aa0279623e804b6e3100d82.BH4WDxGu.js";import"./@rc-component_overflow@1.0._000e3b789f0a378ea10d91c90289e484.CzJM8PZE.js";const h=e=>!e||e.disabled||e.disableCheckbox||!1===e.checkable,m=e=>null==e,v=()=>null;function y(t){return e(t).map(e=>{if(!u.isValidElement(e)||!e.type)return null;const{key:t,props:{children:l,value:n,...r}}=e,a={key:t,value:n,...r},o=y(l);return o.length&&(a.children=o),a}).filter(e=>e)}function b(e){if(!e)return e;const l={...e};return"props"in l||Object.defineProperty(l,"props",{get:()=>(t(!1,"New `rc-tree-select` not support return node instance as argument anymore. Please consider to remove `props` access."),l)}),l}function g(e){const t=u.useRef();t.current=e;return u.useCallback((...e)=>t.current(...e),[])}function C(e,t,l){return u.useMemo(()=>{if(e){if(l){const t={id:"id",pId:"pId",rootPId:null,..."object"==typeof l?l:{}};return function(e,t){const{id:l,pId:n,rootPId:r}=t,a=new Map,o=[];return e.forEach(e=>{const t=e[l],n={...e,key:e.key||t};a.set(t,n)}),a.forEach(e=>{const t=e[n],l=a.get(t);l?(l.children=l.children||[],l.children.push(e)):t!==r&&null!==r||o.push(e)}),o}(e,t)}return e}return y(t)},[t,l,e])}const S=u.createContext(null),k=u.createContext(null);function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e},E.apply(this,arguments)}const w={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},N=(e,t)=>{const{prefixCls:a,multiple:o,searchValue:c,toggleOpen:i,open:d,notFoundContent:m}=s(),{virtual:v,listHeight:y,listItemHeight:b,listItemScrollOffset:g,treeData:C,fieldNames:N,onSelect:x,popupMatchSelectWidth:M,treeExpandAction:V,treeTitleRender:O,onPopupScroll:P,leftMaxCount:T,leafCountOnly:I,valueEntities:D,classNames:L,styles:_}=u.useContext(k),{checkable:K,checkedKeys:H,halfCheckedKeys:j,treeExpandedKeys:R,treeDefaultExpandAll:A,treeDefaultExpandedKeys:W,onTreeExpand:F,treeIcon:U,showTreeIcon:G,switcherIcon:q,treeLine:z,treeNodeFilterProp:B,loadData:J,treeLoadedKeys:Q,treeMotion:X,onTreeLoad:Y,keyEntities:Z}=u.useContext(S),$=u.useRef(),ee=l(()=>C,[d,C],(e,t)=>t[0]&&e[1]!==t[1]),te=u.useMemo(()=>K?{checked:H,halfChecked:j}:null,[K,H,j]);u.useEffect(()=>{var e;d&&!o&&H.length&&(null==(e=$.current)||e.scrollTo({key:H[0]}))},[d]);const le=e=>{e.preventDefault()},ne=(e,t)=>{const{node:l}=t;K&&h(l)||(x(l.key,{selected:!H.includes(l.key)}),o||i(!1))},[re,ae]=u.useState(W),[oe,se]=u.useState(null),ce=u.useMemo(()=>R?[...R]:c?oe:re,[re,oe,R,c]),ue=String(c).toLowerCase(),ie=e=>!!ue&&String(e[B]).toLowerCase().includes(ue);u.useEffect(()=>{c&&se(((e,t)=>{const l=[],n=e=>{e.forEach(e=>{const r=e[t.children];r&&(l.push(e[t.value]),n(r))})};return n(e),l})(C,N))},[c]);const[de,pe]=u.useState(()=>new Map);u.useEffect(()=>{T&&pe(new Map)},[T]);const fe=n(e=>{const t=e[N.value];return!H.includes(t)&&(null!==T&&(T<=0||!(!I||!T)&&function(e){const t=e[N.value];if(!de.has(t)){const e=D.get(t);if(0===(e.children||[]).length)de.set(t,!1);else{const l=e.children.filter(e=>!e.node.disabled&&!e.node.disableCheckbox&&!H.includes(e.node[N.value])).length;de.set(t,l>T)}}return de.get(t)}(e)))}),he=e=>{for(const t of e)if(!t.disabled&&!1!==t.selectable){if(!c)return t;if(ie(t))return t;if(t[N.children]){const e=he(t[N.children]);if(e)return e}}return null},[me,ve]=u.useState(null),ye=Z[me];u.useEffect(()=>{if(!d)return;let e=null;e=o||!H.length||c?(()=>{const e=he(ee);return e?e[N.value]:null})():H[0],ve(e)},[d,c]),u.useImperativeHandle(t,()=>{var e;return{scrollTo:null==(e=$.current)?void 0:e.scrollTo,onKeyDown:e=>{var t;const{which:l}=e;switch(l){case r.UP:case r.DOWN:case r.LEFT:case r.RIGHT:null==(t=$.current)||t.onKeyDown(e);break;case r.ENTER:if(ye){const e=fe(ye.node),{selectable:t,value:l,disabled:n}=(null==ye?void 0:ye.node)||{};!1===t||n||e||ne(0,{node:{key:me},selected:!H.includes(l)})}break;case r.ESC:i(!1)}},onKeyUp:()=>{}}});const be=l(()=>!c,[c,R||re],([e],[t,l])=>e!==t&&!(!t&&!l))?J:null;if(0===ee.length)return u.createElement("div",{role:"listbox",className:"".concat(a,"-empty"),onMouseDown:le},m);const ge={fieldNames:N};return Q&&(ge.loadedKeys=Q),ce&&(ge.expandedKeys=ce),u.createElement("div",{onMouseDown:le},ye&&d&&u.createElement("span",{style:w,"aria-live":"assertive"},ye.node.value),u.createElement(p.Provider,{value:{nodeDisabled:fe}},u.createElement(f,E({classNames:null==L?void 0:L.popup,styles:null==_?void 0:_.popup,ref:$,focusable:!1,prefixCls:"".concat(a,"-tree"),treeData:ee,height:y,itemHeight:b,itemScrollOffset:g,virtual:!1!==v&&!1!==M,multiple:o,icon:U,showIcon:G,switcherIcon:q,showLine:z,loadData:be,motion:X,activeKey:me,checkable:K,checkStrictly:!0,checkedKeys:te,selectedKeys:K?[]:H,defaultExpandAll:A,titleRender:O},ge,{onActiveChange:ve,onSelect:ne,onCheck:ne,onExpand:e=>{ae(e),se(e),F&&F(e)},onLoad:Y,filterTreeNode:ie,expandAction:V,onScroll:P}))))},x=u.forwardRef(N),M="SHOW_ALL",V="SHOW_PARENT",O="SHOW_CHILD";function P(e,t,l,n){const r=new Set(e);return t===O?e.filter(e=>{const t=l[e];return!(t&&t.children&&t.children.some(({node:e})=>r.has(e[n.value]))&&t.children.every(({node:e})=>h(e)||r.has(e[n.value])))}):t===V?e.filter(e=>{const t=l[e],n=t?t.parent:null;return!n||h(n.node)||!r.has(n.key)}):e}function T(){return T=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var l=arguments[t];for(var n in l)Object.prototype.hasOwnProperty.call(l,n)&&(e[n]=l[n])}return e},T.apply(this,arguments)}const I=u.forwardRef((e,l)=>{const{id:n,prefixCls:r="rc-tree-select",value:s,defaultValue:p,onChange:f,onSelect:h,onDeselect:y,showSearch:E,searchValue:w,inputValue:N,onSearch:V,autoClearSearchValue:I,filterTreeNode:D,treeNodeFilterProp:L,showCheckedStrategy:_,treeNodeLabelProp:K,multiple:H,treeCheckable:j,treeCheckStrictly:R,labelInValue:A,maxCount:W,fieldNames:F,treeDataSimpleMode:U,treeData:G,children:q,loadData:z,treeLoadedKeys:B,onTreeLoad:J,treeDefaultExpandAll:Q,treeExpandedKeys:X,treeDefaultExpandedKeys:Y,onTreeExpand:Z,treeExpandAction:$,virtual:ee,listHeight:te=200,listItemHeight:le=20,listItemScrollOffset:ne=0,onPopupVisibleChange:re,popupMatchSelectWidth:ae=!0,treeLine:oe,treeIcon:se,showTreeIcon:ce,switcherIcon:ue,treeMotion:ie,treeTitleRender:de,onPopupScroll:pe,classNames:fe,styles:he,...me}=e,ve=a(n),ye=j&&!R,be=j||R,ge=R||A,Ce=be||H,Se={searchValue:w,inputValue:N,onSearch:V,autoClearSearchValue:I,filterTreeNode:D,treeNodeFilterProp:L},[ke,Ee]=function(e,t){const{searchValue:l,inputValue:n,onSearch:r,autoClearSearchValue:a,filterTreeNode:o,treeNodeFilterProp:s}=t;return u.useMemo(()=>{const t="object"==typeof e,c={searchValue:null!=l?l:n,onSearch:r,autoClearSearchValue:a,filterTreeNode:o,treeNodeFilterProp:s,...t?e:{}};return[!!t||e,c]},[e,l,n,r,a,o,s])}(E,Se),{searchValue:we,onSearch:Ne,autoClearSearchValue:xe=!0,filterTreeNode:Me,treeNodeFilterProp:Ve="value"}=Ee,[Oe,Pe]=o(p,s),Te=u.useMemo(()=>j?_||O:M,[_,j]),Ie=u.useMemo(()=>(e=>{const{label:t,value:l,children:n}=e||{};return{_title:t?[t]:["title","label"],value:l||"value",key:l||"value",children:n||"children"}})(F),[JSON.stringify(F)]),[De,Le]=o("",we),_e=De||"",Ke=C(G,q,U),{keyEntities:He,valueEntities:je}=((e,t)=>u.useMemo(()=>d(e,{fieldNames:t,initWrapper:e=>({...e,valueEntities:new Map}),processEntity:(e,l)=>{const n=e.node[t.value];l.valueEntities.set(n,e)}}),[e,t]))(Ke,Ie),Re=u.useCallback(e=>{const t=[],l=[];return e.forEach(e=>{je.has(e)?l.push(e):t.push(e)}),{missingRawValues:t,existRawValues:l}},[je]),Ae=((e,t,l)=>{const{fieldNames:n,treeNodeFilterProp:r,filterTreeNode:a}=l,{children:o}=n;return u.useMemo(()=>{if(!t||!1===a)return e;const l="function"==typeof a?a:(e,l)=>String(l[r]).toUpperCase().includes(t.toUpperCase()),n=(e,r=!1)=>e.reduce((e,a)=>{const s=a[o],c=r||l(t,b(a)),u=n(s||[],c);return(c||u.length)&&e.push({...a,isLeaf:void 0,[o]:u}),e},[]);return n(e)},[e,t,o,r,a])})(Ke,_e,{fieldNames:Ie,treeNodeFilterProp:Ve,filterTreeNode:Me}),We=u.useCallback(e=>{if(e){if(K)return e[K];const{_title:t}=Ie;for(let l=0;l<t.length;l+=1){const n=e[t[l]];if(void 0!==n)return n}}},[Ie,K]),Fe=u.useCallback(e=>{const t=(e=>Array.isArray(e)?e:void 0!==e?[e]:[])(e);return t.map(e=>function(e){return!e||"object"!=typeof e}(e)?{value:e}:e)},[]),Ue=u.useCallback(e=>Fe(e).map(e=>{let{label:t}=e;const{value:l,halfChecked:n}=e;let r;const a=je.get(l);if(a)t=de?de(a.node):null!=t?t:We(a.node),r=a.node.disabled;else if(void 0===t){t=Fe(Oe).find(e=>e.value===l).label}return{label:t,value:l,halfChecked:n,disabled:r}}),[je,We,Fe,Oe]),Ge=u.useMemo(()=>Fe(null===Oe?[]:Oe),[Fe,Oe]),[qe,ze]=u.useMemo(()=>{const e=[],t=[];return Ge.forEach(l=>{l.halfChecked?t.push(l):e.push(l)}),[e,t]},[Ge]),Be=u.useMemo(()=>qe.map(e=>e.value),[qe]),[Je,Qe]=((e,t,l,n)=>u.useMemo(()=>{const r=e=>e.map(({value:e})=>e),a=r(e),o=r(t),s=a.filter(e=>!n[e]);let c=a,u=o;if(l){const e=i(a,!0,n);c=e.checkedKeys,u=e.halfCheckedKeys}return[Array.from(new Set([...s,...c])),u]},[e,t,l,n]))(qe,ze,ye,He),Xe=u.useMemo(()=>{const e=P(Je,Te,He,Ie).map(e=>{var t,l,n;return null!=(n=null==(l=null==(t=He[e])?void 0:t.node)?void 0:l[Ie.value])?n:e}).map(e=>{const t=qe.find(t=>t.value===e),l=A?null==t?void 0:t.label:null==de?void 0:de(t);return{value:e,label:l}}),t=Ue(e),l=t[0];return!Ce&&l&&m(l.value)&&m(l.label)?[]:t.map(e=>{var t;return{...e,label:null!=(t=e.label)?t:e.value}})},[Ie,Ce,Je,qe,Ue,Te,He]),[Ye]=(e=>{const t=u.useRef({valueLabels:new Map});return u.useMemo(()=>{const{valueLabels:l}=t.current,n=new Map,r=e.map(e=>{const{value:t,label:r}=e,a=null!=r?r:l.get(t);return n.set(t,a),{...e,label:a}});return t.current.valueLabels=n,[r]},[e])})(Xe),Ze=u.useMemo(()=>!Ce||"SHOW_CHILD"!==Te&&!R&&j?null:W,[W,Ce,R,Te,j]),$e=g((e,l,n)=>{const r=P(e,Te,He,Ie);if(Ze&&r.length>Ze)return;const a=Ue(e);if(Pe(a),xe&&Le(""),f){let a=e;ye&&(a=r.map(e=>{const t=je.get(e);return t?t.node[Ie.value]:e}));const{triggerValue:o,selected:s}=l||{triggerValue:void 0,selected:void 0};let c=a;if(R){const e=ze.filter(e=>!a.includes(e.value));c=[...c,...e]}const i=Ue(c),d={preValue:qe,triggerValue:o};let p=!0;(R||"selection"===n&&!s)&&(p=!1),function(e,l,n,r,a,o){let s=null,c=null;function i(){c||(c=[],function e(t,r="0",a=!1){return t.map((t,i)=>{const d="".concat(r,"-").concat(i),p=t[o.value],f=n.includes(p),h=e(t[o.children]||[],d,f),m=u.createElement(v,t,h.map(e=>e.node));if(l===p&&(s=m),f){const e={pos:d,node:m,children:h};return a||c.push(e),e}return null}).filter(e=>e)}(r),c.sort(({node:{props:{value:e}}},{node:{props:{value:t}}})=>n.indexOf(e)-n.indexOf(t)))}Object.defineProperty(e,"triggerNode",{get:()=>(t(!1,"`triggerNode` is deprecated. Please consider decoupling data with node."),i(),s)}),Object.defineProperty(e,"allCheckedNodes",{get:()=>(t(!1,"`allCheckedNodes` is deprecated. Please consider decoupling data with node."),i(),a?c:c.map(({node:e})=>e))})}(d,o,e,Ke,p,Ie),be?d.checked=s:d.selected=s;const h=ge?i:i.map(e=>e.value);f(Ce?h:h[0],ge?null:i.map(e=>e.label),d)}}),et=u.useCallback((e,{selected:t,source:l})=>{var n;const r=He[e],a=null==r?void 0:r.node,o=null!=(n=null==a?void 0:a[Ie.value])?n:e;if(Ce){let e=t?[...Be,o]:Je.filter(e=>e!==o);if(ye){const{missingRawValues:l,existRawValues:n}=Re(e),r=n.map(e=>je.get(e).key);let a;({checkedKeys:a}=i(r,!!t||{halfCheckedKeys:Qe},He)),e=[...l,...a.map(e=>He[e].node[Ie.value])]}$e(e,{selected:t,triggerValue:o},l||"option")}else $e([o],{selected:!0,triggerValue:o},"option");t||!Ce?null==h||h(o,b(a)):null==y||y(o,b(a))},[Re,je,He,Ie,Ce,Be,$e,ye,h,y,Je,Qe,W]),tt=u.useCallback(e=>{re&&re(e)},[re]),lt=g((e,t)=>{const l=e.map(e=>e.value);"clear"!==t.type?t.values.length&&et(t.values[0].value,{selected:!1,source:"selection"}):$e(l,{},"selection")}),nt=u.useMemo(()=>({virtual:ee,popupMatchSelectWidth:ae,listHeight:te,listItemHeight:le,listItemScrollOffset:ne,treeData:Ae,fieldNames:Ie,onSelect:et,treeExpandAction:$,treeTitleRender:de,onPopupScroll:pe,leftMaxCount:void 0===W?null:W-Ye.length,leafCountOnly:"SHOW_CHILD"===Te&&!R&&!!j,valueEntities:je,classNames:fe,styles:he}),[ee,ae,te,le,ne,Ae,Ie,et,$,de,pe,W,Ye.length,Te,R,j,je,fe,he]),rt=u.useMemo(()=>({checkable:be,loadData:z,treeLoadedKeys:B,onTreeLoad:J,checkedKeys:Je,halfCheckedKeys:Qe,treeDefaultExpandAll:Q,treeExpandedKeys:X,treeDefaultExpandedKeys:Y,onTreeExpand:Z,treeIcon:se,treeMotion:ie,showTreeIcon:ce,switcherIcon:ue,treeLine:oe,treeNodeFilterProp:Ve,keyEntities:He}),[be,z,B,J,Je,Qe,Q,X,Y,Z,se,ie,ce,ue,oe,Ve,He]);return u.createElement(k.Provider,{value:nt},u.createElement(S.Provider,{value:rt},u.createElement(c,T({ref:l},me,{classNames:fe,styles:he,id:ve,prefixCls:r,mode:Ce?"multiple":void 0,displayValues:Ye,onDisplayValuesChange:lt,autoClearSearchValue:xe,showSearch:ke,searchValue:_e,onSearch:e=>{Le(e),null==Ne||Ne(e)},OptionList:x,emptyOptions:!Ke.length,onPopupVisibleChange:tt,popupMatchSelectWidth:ae}))))});I.TreeNode=v,I.SHOW_ALL=M,I.SHOW_PARENT=V,I.SHOW_CHILD=O;export{I as G,M as S,v as T,V as a,O as b};
