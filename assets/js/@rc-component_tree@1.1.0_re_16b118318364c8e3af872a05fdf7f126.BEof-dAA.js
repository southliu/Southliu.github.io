var e=Object.defineProperty,t=(t,n,o)=>((t,n,o)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[n]=o)(t,"symbol"!=typeof n?n+"":n,o);import{c as n}from"./clsx@2.1.1.DMqMD_4V.js";import{t as o,b as s,B as a,p as r,h as d,K as i}from"./@rc-component_util@1.7.0_re_97ed4941f5d27d044aa2ecbc4a75f304.BwjZ45jd.js";import{r as l,e as c}from"./react@19.2.3.DikTGMTS.js";import{L as h}from"./@rc-component_virtual-list@_eab7c240f5d5dcfc3960e23bede0b5bd.CuVrcOVa.js";import{C as p}from"./@rc-component_motion@1.1.6__75bed58c5aa0279623e804b6e3100d82.BH4WDxGu.js";function u(e,t){return e[t]}function y(e,t){return"".concat(e,"-").concat(t)}function f(e,t){return null!=e?e:t}function g(e){const{title:t,_title:n,key:o,children:s}=e||{},a=t||"title";return{title:a,_title:n||[a],key:o||"key",children:s||"children"}}function v(e){return function e(t){return o(t).map(t=>{if(!function(e){return e&&e.type&&e.type.isTreeNode}(t))return s(!t,"Tree/TreeNode can only accept TreeNode as children."),null;const{key:n}=t,{children:o,...a}=t.props,r={key:n,...a},d=e(o);return d.length&&(r.children=d),r}).filter(e=>e)}(e)}function k(e,t,n){const{_title:o,key:s,children:r}=g(n),d=new Set(!0===t?[]:t),i=[];return function e(n,l=null){return n.map((c,h)=>{const p=y(l?l.pos:"0",h),u=f(c[s],p);let g;for(let e=0;e<o.length;e+=1){const t=o[e];if(void 0!==c[t]){g=c[t];break}}const v=Object.assign(a(c,[...o,s,r]),{title:g,key:u,parent:l,pos:p,children:null,data:c,isStart:[...l?l.isStart:[],0===h],isEnd:[...l?l.isEnd:[],h===n.length-1]});return i.push(v),!0===t||d.has(u)?v.children=e(c[r]||[],v):v.children=[],v})}(e),i}function K(e,{initWrapper:t,processEntity:n,onProcessFinished:o,externalGetKey:s,childrenPropName:a,fieldNames:r}={},d){const i=s||d,l={},c={};let h={posEntities:l,keyEntities:c};return t&&(h=t(h)||h),function(e,t,n){let o={};o="object"==typeof n?n:{externalGetKey:n},o=o||{};const{childrenPropName:s,externalGetKey:a,fieldNames:r}=o,{key:d,children:i}=g(r),l=s||i;let c;a?"string"==typeof a?c=e=>e[a]:"function"==typeof a&&(c=e=>a(e)):c=(e,t)=>f(e[d],t),function n(o,s,a,r){const d=o?o[l]:e,i=o?y(a.pos,s):"0",h=o?[...r,o]:[];if(o){const e=c(o,i),n={node:o,index:s,pos:i,key:e,parentPos:a.node?a.pos:null,level:a.level+1,nodes:h};t(n)}d&&d.forEach((e,t)=>{n(e,t,{node:o,pos:i,level:a?a.level+1:-1},h)})}(null)}(e,e=>{const{node:t,index:o,pos:s,key:a,parentPos:r,level:d,nodes:i}=e,p={node:t,nodes:i,index:o,key:a,pos:s,level:d},u=f(a,s);l[s]=p,c[u]=p,p.parent=l[r],p.parent&&(p.parent.children=p.parent.children||[],p.parent.children.push(p)),n&&n(p,h)},{externalGetKey:i,childrenPropName:a,fieldNames:r}),o&&o(h),h}function N(e,{expandedKeys:t,selectedKeys:n,loadedKeys:o,loadingKeys:s,checkedKeys:a,halfCheckedKeys:r,dragOverNodeKey:d,dropPosition:i,keyEntities:l}){const c=u(l,e);return{eventKey:e,expanded:-1!==t.indexOf(e),selected:-1!==n.indexOf(e),loaded:-1!==o.indexOf(e),loading:-1!==s.indexOf(e),checked:-1!==a.indexOf(e),halfChecked:-1!==r.indexOf(e),pos:String(c?c.pos:""),dragOver:d===e&&0===i,dragOverGapTop:d===e&&-1===i,dragOverGapBottom:d===e&&1===i}}function m(e){const{data:t,expanded:n,selected:o,checked:a,loaded:r,loading:d,halfChecked:i,dragOver:l,dragOverGapTop:c,dragOverGapBottom:h,pos:p,active:u,eventKey:y}=e,f={...t,expanded:n,selected:o,checked:a,loaded:r,loading:d,halfChecked:i,dragOver:l,dragOverGapTop:c,dragOverGapBottom:h,pos:p,active:u,key:y};return"props"in f||Object.defineProperty(f,"props",{get:()=>(s(!1,"Second param return from event is node data instead of TreeNode instance. Please read value directly instead of reading from `props`."),e)}),f}function x(e,t){const n=new Set;return e.forEach(e=>{t.has(e)||n.add(e)}),n}function E(e){const{disabled:t,disableCheckbox:n,checkable:o}=e||{};return!(!t&&!n)||!1===o}function b(e,t,n,o){const a=[];let r;r=o||E;const d=new Set(e.filter(e=>{const t=!!u(n,e);return t||a.push(e),t})),i=new Map;let l,c=0;return Object.keys(n).forEach(e=>{const t=n[e],{level:o}=t;let s=i.get(o);s||(s=new Set,i.set(o,s)),s.add(t),c=Math.max(c,o)}),s(!a.length,"Tree missing follow keys: ".concat(a.slice(0,100).map(e=>"'".concat(e,"'")).join(", "))),l=!0===t?function(e,t,n,o){const s=new Set(e),a=new Set;for(let d=0;d<=n;d+=1)(t.get(d)||new Set).forEach(e=>{const{key:t,node:n,children:a=[]}=e;s.has(t)&&!o(n)&&a.filter(e=>!o(e.node)).forEach(e=>{s.add(e.key)})});const r=new Set;for(let d=n;d>=0;d-=1)(t.get(d)||new Set).forEach(e=>{const{parent:t,node:n}=e;if(o(n)||!e.parent||r.has(e.parent.key))return;if(o(e.parent.node))return void r.add(t.key);let d=!0,i=!1;(t.children||[]).filter(e=>!o(e.node)).forEach(({key:e})=>{const t=s.has(e);d&&!t&&(d=!1),i||!t&&!a.has(e)||(i=!0)}),d&&s.add(t.key),i&&a.add(t.key),r.add(t.key)});return{checkedKeys:Array.from(s),halfCheckedKeys:Array.from(x(a,s))}}(d,i,c,r):function(e,t,n,o,s){const a=new Set(e);let r=new Set(t);for(let i=0;i<=o;i+=1)(n.get(i)||new Set).forEach(e=>{const{key:t,node:n,children:o=[]}=e;a.has(t)||r.has(t)||s(n)||o.filter(e=>!s(e.node)).forEach(e=>{a.delete(e.key)})});r=new Set;const d=new Set;for(let i=o;i>=0;i-=1)(n.get(i)||new Set).forEach(e=>{const{parent:t,node:n}=e;if(s(n)||!e.parent||d.has(e.parent.key))return;if(s(e.parent.node))return void d.add(t.key);let o=!0,i=!1;(t.children||[]).filter(e=>!s(e.node)).forEach(({key:e})=>{const t=a.has(e);o&&!t&&(o=!1),i||!t&&!r.has(e)||(i=!0)}),o||a.delete(t.key),i&&r.add(t.key),d.add(t.key)});return{checkedKeys:Array.from(a),halfCheckedKeys:Array.from(x(r,a))}}(d,t.halfCheckedKeys,i,c,r),l}const C=l.createContext(null),D=l.createContext({}),S=({prefixCls:e,level:t,isStart:o,isEnd:s})=>{const a="".concat(e,"-indent-unit"),r=[];for(let d=0;d<t;d+=1)r.push(l.createElement("span",{key:d,className:n(a,{["".concat(a,"-start")]:o[d],["".concat(a,"-end")]:s[d]})}));return l.createElement("span",{"aria-hidden":"true",className:"".concat(e,"-indent")},r)},P=l.memo(S);function O(){return O=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},O.apply(this,arguments)}const w="open",T="close",L="---",M=e=>{var t,o;const{eventKey:s,className:a,style:d,dragOver:i,dragOverGapTop:l,dragOverGapBottom:h,isLeaf:p,isStart:y,isEnd:f,expanded:g,selected:v,checked:k,halfChecked:K,loading:N,domRef:x,active:E,data:b,onMouseMove:S,selectable:M,...A}=e,R=c.useContext(C),{classNames:I,styles:j}=R||{},_=c.useContext(D),U=c.useRef(null),[B,W]=c.useState(!1),G=!!(R.disabled||e.disabled||(null==(t=_.nodeDisabled)?void 0:t.call(_,b))),F=c.useMemo(()=>!(!R.checkable||!1===e.checkable)&&R.checkable,[R.checkable,e.checkable]),q=t=>{G||F&&!e.disableCheckbox&&R.onNodeCheck(t,m(e),!k)},H=c.useMemo(()=>"boolean"==typeof M?M:R.selectable,[M,R.selectable]),V=t=>{R.onNodeClick(t,m(e)),H?(t=>{G||R.onNodeSelect(t,m(e))})(t):q(t)},X=t=>{R.onNodeDoubleClick(t,m(e))},Y=t=>{R.onNodeMouseEnter(t,m(e))},z=t=>{R.onNodeMouseLeave(t,m(e))},J=t=>{R.onNodeContextMenu(t,m(e))},Q=c.useMemo(()=>!(!R.draggable||R.draggable.nodeDraggable&&!R.draggable.nodeDraggable(b)),[R.draggable,b]),Z=t=>{N||R.onNodeExpand(t,m(e))},$=c.useMemo(()=>{const{children:e}=u(R.keyEntities,s)||{};return Boolean((e||[]).length)},[R.keyEntities,s]),ee=c.useMemo(()=>!1!==p&&(p||!R.loadData&&!$||R.loadData&&e.loaded&&!$),[p,R.loadData,$,e.loaded]);c.useEffect(()=>{N||"function"!=typeof R.loadData||!g||ee||e.loaded||R.onNodeLoad(m(e))},[N,R.loadData,R.onNodeLoad,g,ee,e]);const te=c.useMemo(()=>{var e;return(null==(e=R.draggable)?void 0:e.icon)?c.createElement("span",{className:"".concat(R.prefixCls,"-draggable-icon")},R.draggable.icon):null},[R.draggable]),ne=t=>{const n=e.switcherIcon||R.switcherIcon;return"function"==typeof n?n({...e,isLeaf:t}):n},oe=c.useMemo(()=>{if(!F)return null;const t="boolean"!=typeof F?F:null;return c.createElement("span",{className:n("".concat(R.prefixCls,"-checkbox"),{["".concat(R.prefixCls,"-checkbox-checked")]:k,["".concat(R.prefixCls,"-checkbox-indeterminate")]:!k&&K,["".concat(R.prefixCls,"-checkbox-disabled")]:G||e.disableCheckbox}),onClick:q,role:"checkbox","aria-checked":K?"mixed":k,"aria-disabled":G||e.disableCheckbox,"aria-label":"Select ".concat("string"==typeof e.title?e.title:"tree node")},t)},[F,k,K,G,e.disableCheckbox,e.title]),se=c.useMemo(()=>ee?null:g?w:T,[ee,g]),ae=c.useMemo(()=>c.createElement("span",{className:n(null==I?void 0:I.itemIcon,"".concat(R.prefixCls,"-iconEle"),"".concat(R.prefixCls,"-icon__").concat(se||"docu"),{["".concat(R.prefixCls,"-icon_loading")]:N}),style:null==j?void 0:j.itemIcon}),[R.prefixCls,se,N]),re=c.useMemo(()=>{const t=Boolean(R.draggable);return!e.disabled&&t&&R.dragOverNodeKey===s?R.dropIndicatorRender({dropPosition:R.dropPosition,dropLevelOffset:R.dropLevelOffset,indent:R.indent,prefixCls:R.prefixCls,direction:R.direction}):null},[R.dropPosition,R.dropLevelOffset,R.indent,R.prefixCls,R.direction,R.draggable,R.dragOverNodeKey,R.dropIndicatorRender]),de=c.useMemo(()=>{const{title:t=L}=e,o="".concat(R.prefixCls,"-node-content-wrapper");let s,a;if(R.showIcon){const t=e.icon||R.icon;s=t?c.createElement("span",{className:n(null==I?void 0:I.itemIcon,"".concat(R.prefixCls,"-iconEle"),"".concat(R.prefixCls,"-icon__customize")),style:null==j?void 0:j.itemIcon},"function"==typeof t?t(e):t):ae}else R.loadData&&N&&(s=ae);return a="function"==typeof t?t(b):R.titleRender?R.titleRender(b):t,c.createElement("span",{ref:U,title:"string"==typeof t?t:"",className:n(o,"".concat(o,"-").concat(se||"normal"),{["".concat(R.prefixCls,"-node-selected")]:!G&&(v||B)}),onMouseEnter:Y,onMouseLeave:z,onContextMenu:J,onClick:V,onDoubleClick:X},s,c.createElement("span",{className:n("".concat(R.prefixCls,"-title"),null==I?void 0:I.itemTitle),style:null==j?void 0:j.itemTitle},a),re)},[R.prefixCls,R.showIcon,e,R.icon,ae,R.titleRender,b,se,Y,z,J,V,X]),ie=r(A,{aria:!0,data:!0}),{level:le}=u(R.keyEntities,s)||{},ce=f[f.length-1],he=!G&&Q,pe=R.draggingNodeKey===s,ue=void 0!==M?{"aria-selected":!!M}:void 0;return c.createElement("div",O({ref:x,role:"treeitem","aria-expanded":p?void 0:g,className:n(a,"".concat(R.prefixCls,"-treenode"),null==I?void 0:I.item,{["".concat(R.prefixCls,"-treenode-disabled")]:G,["".concat(R.prefixCls,"-treenode-switcher-").concat(g?"open":"close")]:!p,["".concat(R.prefixCls,"-treenode-checkbox-checked")]:k,["".concat(R.prefixCls,"-treenode-checkbox-indeterminate")]:K,["".concat(R.prefixCls,"-treenode-selected")]:v,["".concat(R.prefixCls,"-treenode-loading")]:N,["".concat(R.prefixCls,"-treenode-active")]:E,["".concat(R.prefixCls,"-treenode-leaf-last")]:ce,["".concat(R.prefixCls,"-treenode-draggable")]:Q,dragging:pe,"drop-target":R.dropTargetKey===s,"drop-container":R.dropContainerKey===s,"drag-over":!G&&i,"drag-over-gap-top":!G&&l,"drag-over-gap-bottom":!G&&h,"filter-node":null==(o=R.filterTreeNode)?void 0:o.call(R,m(e)),["".concat(R.prefixCls,"-treenode-leaf")]:ee}),style:{...d,...null==j?void 0:j.item},draggable:he,onDragStart:he?t=>{t.stopPropagation(),W(!0),R.onNodeDragStart(t,e);try{t.dataTransfer.setData("text/plain","")}catch(n){}}:void 0,onDragEnter:Q?t=>{t.preventDefault(),t.stopPropagation(),R.onNodeDragEnter(t,e)}:void 0,onDragOver:Q?t=>{t.preventDefault(),t.stopPropagation(),R.onNodeDragOver(t,e)}:void 0,onDragLeave:Q?t=>{t.stopPropagation(),R.onNodeDragLeave(t,e)}:void 0,onDrop:Q?t=>{t.preventDefault(),t.stopPropagation(),W(!1),R.onNodeDrop(t,e)}:void 0,onDragEnd:Q?t=>{t.stopPropagation(),W(!1),R.onNodeDragEnd(t,e)}:void 0,onMouseMove:S},ue,ie),c.createElement(P,{prefixCls:R.prefixCls,level:le,isStart:y,isEnd:f}),te,(()=>{if(ee){const e=ne(!0);return!1!==e?c.createElement("span",{className:n("".concat(R.prefixCls,"-switcher"),"".concat(R.prefixCls,"-switcher-noop"))},e):null}const e=ne(!1);return!1!==e?c.createElement("span",{onClick:Z,className:n("".concat(R.prefixCls,"-switcher"),"".concat(R.prefixCls,"-switcher_").concat(g?w:T))},e):null})(),oe,de)};function A(e,t){if(!e)return[];const n=e.slice(),o=n.indexOf(t);return o>=0&&n.splice(o,1),n}function R(e,t){const n=(e||[]).slice();return-1===n.indexOf(t)&&n.push(t),n}function I(e){return e.split("-")}function j(e,t){const n=[];return function e(t=[]){t.forEach(({key:t,children:o})=>{n.push(t),e(o)})}(u(t,e).children),n}function _(e){if(e.parent){const t=I(e.pos);return Number(t[t.length-1])===e.parent.children.length-1}return!1}function U(e,t,n,o,s,a,r,d,i,l){var c;const{clientX:h,clientY:p}=e,{top:y,height:f}=e.target.getBoundingClientRect(),g=(("rtl"===l?-1:1)*(((null==s?void 0:s.x)||0)-h)-12)/o,v=i.filter(e=>{var t,n;return null==(n=null==(t=d[e])?void 0:t.children)?void 0:n.length});let k=u(d,n.eventKey);if(p<y+f/2){const e=r.findIndex(e=>e.key===k.key),t=r[e<=0?0:e-1].key;k=u(d,t)}const K=k.key,N=k,m=k.key;let x=0,E=0;if(!v.includes(K))for(let u=0;u<g&&_(k);u+=1)k=k.parent,E+=1;const b=t.data,C=k.node;let D=!0;return function(e){const t=I(e.pos);return 0===Number(t[t.length-1])}(k)&&0===k.level&&p<y+f/2&&a({dragNode:b,dropNode:C,dropPosition:-1})&&k.key===n.eventKey?x=-1:(N.children||[]).length&&v.includes(m)?a({dragNode:b,dropNode:C,dropPosition:0})?x=0:D=!1:0===E?g>-1.5?a({dragNode:b,dropNode:C,dropPosition:1})?x=1:D=!1:a({dragNode:b,dropNode:C,dropPosition:0})?x=0:a({dragNode:b,dropNode:C,dropPosition:1})?x=1:D=!1:a({dragNode:b,dropNode:C,dropPosition:1})?x=1:D=!1,{dropPosition:x,dropLevelOffset:E,dropTargetKey:k.key,dropTargetPos:k.pos,dragOverNodeKey:m,dropContainerKey:0===x?null:(null==(c=k.parent)?void 0:c.key)||null,dropAllowed:D}}function B(e,t){if(!e)return;const{multiple:n}=t;return n?e.slice():e.length?[e[0]]:e}function W(e){if(!e)return null;let t;if(Array.isArray(e))t={checkedKeys:e,halfCheckedKeys:void 0};else{if("object"!=typeof e)return s(!1,"`checkedKeys` is not an array or an object"),null;t={checkedKeys:e.checked||void 0,halfCheckedKeys:e.halfChecked||void 0}}return t}function G(e,t){const n=new Set;function o(e){if(n.has(e))return;const s=u(t,e);if(!s)return;n.add(e);const{parent:a,node:r}=s;r.disabled||a&&o(a.key)}return(e||[]).forEach(e=>{o(e)}),[...n]}M.isTreeNode=1;function F(){return F=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},F.apply(this,arguments)}const q=l.forwardRef((e,t)=>{const{className:o,style:s,motion:a,motionNodes:r,motionType:i,onMotionStart:c,onMotionEnd:h,active:u,treeNodeRequiredProps:y,...f}=e,[g,v]=l.useState(!0),{prefixCls:k}=l.useContext(C),K=r&&"hide"!==i;d(()=>{r&&K!==g&&v(K)},[r]);const m=l.useRef(!1),x=()=>{r&&!m.current&&(m.current=!0,h())};!function(e,t){const[n,o]=l.useState(!1);d(()=>{if(n)return e(),()=>{t()}},[n]),d(()=>(o(!0),()=>{o(!1)}),[])}(()=>{r&&c()},x);const E=e=>{K===e&&x()};return r?l.createElement(p,F({ref:t,visible:g},a,{motionAppear:"show"===i,onVisibleChanged:E}),({className:e,style:t},o)=>l.createElement("div",{ref:o,className:n("".concat(k,"-treenode-motion"),e),style:t},r.map(e=>{const{data:{...t},title:n,key:o,isStart:s,isEnd:a}=e;delete t.children;const r=N(o,y);return l.createElement(M,F({},t,r,{title:n,active:u,data:e.data,key:o,isStart:s,isEnd:a}))}))):l.createElement(M,F({domRef:t,className:o,style:s},f,{active:u}))});function H(e,t,n){const o=e.findIndex(e=>e.key===n),s=e[o+1],a=t.findIndex(e=>e.key===n);if(s){const e=t.findIndex(e=>e.key===s.key);return t.slice(a+1,e)}return t.slice(a+1)}function V(){return V=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},V.apply(this,arguments)}const X={width:0,height:0,display:"flex",overflow:"hidden",opacity:0,border:0,padding:0,margin:0},Y=()=>{},z="RC_TREE_MOTION_".concat(Math.random()),J={key:z},Q={key:z,level:0,index:0,pos:"0",node:J,nodes:[J]},Z={parent:null,children:[],pos:Q.pos,data:J,title:null,key:z,isStart:[],isEnd:[]};function $(e,t,n,o){return!1!==t&&n?e.slice(0,Math.ceil(n/o)+1):e}function ee(e){const{key:t,pos:n}=e;return f(t,n)}const te=l.forwardRef((e,t)=>{const{prefixCls:n,data:o,selectable:s,checkable:a,expandedKeys:r,selectedKeys:i,checkedKeys:c,loadedKeys:p,loadingKeys:u,halfCheckedKeys:y,keyEntities:g,disabled:v,dragging:k,dragOverNodeKey:K,dropPosition:m,motion:x,height:E,itemHeight:b,virtual:C,scrollWidth:D,focusable:S,activeItem:P,focused:O,tabIndex:w,onKeyDown:T,onFocus:L,onBlur:M,onActiveChange:A,onListChangeStart:R,onListChangeEnd:I,...j}=e,_=l.useRef(null),U=l.useRef(null);l.useImperativeHandle(t,()=>({scrollTo:e=>{_.current.scrollTo(e)},getIndentWidth:()=>U.current.offsetWidth}));const[B,W]=l.useState(r),[G,F]=l.useState(o),[J,Q]=l.useState(o),[te,ne]=l.useState([]),[oe,se]=l.useState(null),ae=l.useRef(o);function re(){const e=ae.current;F(e),Q(e),ne([]),se(null),I()}ae.current=o,d(()=>{W(r);const e=function(e=[],t=[]){const n=e.length,o=t.length;if(1!==Math.abs(n-o))return{add:!1,key:null};function s(e,t){const n=new Map;e.forEach(e=>{n.set(e,!0)});const o=t.filter(e=>!n.has(e));return 1===o.length?o[0]:null}return n<o?{add:!0,key:s(e,t)}:{add:!1,key:s(t,e)}}(B,r);if(null!==e.key)if(e.add){const t=G.findIndex(({key:t})=>t===e.key),n=$(H(G,o,e.key),C,E,b),s=G.slice();s.splice(t+1,0,Z),Q(s),ne(n),se("show")}else{const t=o.findIndex(({key:t})=>t===e.key),n=$(H(o,G,e.key),C,E,b),s=o.slice();s.splice(t+1,0,Z),Q(s),ne(n),se("hide")}else G!==o&&(F(o),Q(o))},[r,o]),l.useEffect(()=>{k||re()},[k]);const de=x?J:o,ie={expandedKeys:r,selectedKeys:i,loadedKeys:p,loadingKeys:u,checkedKeys:c,halfCheckedKeys:y,dragOverNodeKey:K,dropPosition:m,keyEntities:g};return l.createElement(l.Fragment,null,O&&P&&l.createElement("span",{style:X,"aria-live":"assertive"},function(e){let t=String(e.data.key),n=e;for(;n.parent;)n=n.parent,t="".concat(n.data.key," > ").concat(t);return t}(P)),l.createElement("div",null,l.createElement("input",{style:X,disabled:!1===S||v,tabIndex:!1!==S?w:null,onKeyDown:T,onFocus:L,onBlur:M,value:"",onChange:Y,"aria-label":"for screen reader"})),l.createElement("div",{className:"".concat(n,"-treenode"),"aria-hidden":!0,style:{position:"absolute",pointerEvents:"none",visibility:"hidden",height:0,overflow:"hidden",border:0,padding:0}},l.createElement("div",{className:"".concat(n,"-indent")},l.createElement("div",{ref:U,className:"".concat(n,"-indent-unit")}))),l.createElement(h,V({},j,{data:de,itemKey:ee,height:E,fullHeight:!1,virtual:C,itemHeight:b,scrollWidth:D,prefixCls:"".concat(n,"-list"),ref:_,role:"tree",onVisibleChange:e=>{e.every(e=>ee(e)!==z)&&re()}}),e=>{const{pos:t,data:{...n},title:o,key:s,isStart:a,isEnd:r}=e,d=f(s,t);delete n.key,delete n.children;const i=N(d,ie);return l.createElement(q,V({},n,i,{title:o,active:!!P&&s===P.key,pos:t,data:e.data,isStart:a,isEnd:r,motion:x,motionNodes:s===z?te:null,motionType:oe,onMotionStart:R,onMotionEnd:re,treeNodeRequiredProps:ie,onMouseMove:()=>{A(null)}}))}))});function ne(){return ne=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},ne.apply(this,arguments)}class oe extends l.Component{constructor(){super(...arguments),t(this,"destroyed",!1),t(this,"delayedDragEnterLogic"),t(this,"loadingRetryTimes",{}),t(this,"state",{keyEntities:{},indent:null,selectedKeys:[],checkedKeys:[],halfCheckedKeys:[],loadedKeys:[],loadingKeys:[],expandedKeys:[],draggingNodeKey:null,dragChildrenKeys:[],dropTargetKey:null,dropPosition:null,dropContainerKey:null,dropLevelOffset:null,dropTargetPos:null,dropAllowed:!0,dragOverNodeKey:null,treeData:[],flattenNodes:[],focused:!1,activeKey:null,listChanging:!1,prevProps:null,fieldNames:g()}),t(this,"dragStartMousePosition",null),t(this,"dragNodeProps",null),t(this,"currentMouseOverDroppableNodeKey",null),t(this,"listRef",l.createRef()),t(this,"onNodeDragStart",(e,t)=>{const{expandedKeys:n,keyEntities:o}=this.state,{onDragStart:s}=this.props,{eventKey:a}=t;this.dragNodeProps=t,this.dragStartMousePosition={x:e.clientX,y:e.clientY};const r=A(n,a);this.setState({draggingNodeKey:a,dragChildrenKeys:j(a,o),indent:this.listRef.current.getIndentWidth()}),this.setExpandedKeys(r),window.addEventListener("dragend",this.onWindowDragEnd),null==s||s({event:e,node:m(t)})}),t(this,"onNodeDragEnter",(e,t)=>{const{expandedKeys:n,keyEntities:o,dragChildrenKeys:s,flattenNodes:a,indent:r}=this.state,{onDragEnter:d,onExpand:i,allowDrop:l,direction:c}=this.props,{pos:h,eventKey:p}=t;if(this.currentMouseOverDroppableNodeKey!==p&&(this.currentMouseOverDroppableNodeKey=p),!this.dragNodeProps)return void this.resetDragState();const{dropPosition:y,dropLevelOffset:f,dropTargetKey:g,dropContainerKey:v,dropTargetPos:k,dropAllowed:K,dragOverNodeKey:N}=U(e,this.dragNodeProps,t,r,this.dragStartMousePosition,l,a,o,n,c);!s.includes(g)&&K?(this.delayedDragEnterLogic||(this.delayedDragEnterLogic={}),Object.keys(this.delayedDragEnterLogic).forEach(e=>{clearTimeout(this.delayedDragEnterLogic[e])}),this.dragNodeProps.eventKey!==t.eventKey&&(e.persist(),this.delayedDragEnterLogic[h]=window.setTimeout(()=>{if(null===this.state.draggingNodeKey)return;let s=[...n];const a=u(o,t.eventKey);a&&(a.children||[]).length&&(s=R(n,t.eventKey)),this.props.hasOwnProperty("expandedKeys")||this.setExpandedKeys(s),null==i||i(s,{node:m(t),expanded:!0,nativeEvent:e.nativeEvent})},800)),this.dragNodeProps.eventKey!==g||0!==f?(this.setState({dragOverNodeKey:N,dropPosition:y,dropLevelOffset:f,dropTargetKey:g,dropContainerKey:v,dropTargetPos:k,dropAllowed:K}),null==d||d({event:e,node:m(t),expandedKeys:n})):this.resetDragState()):this.resetDragState()}),t(this,"onNodeDragOver",(e,t)=>{const{dragChildrenKeys:n,flattenNodes:o,keyEntities:s,expandedKeys:a,indent:r}=this.state,{onDragOver:d,allowDrop:i,direction:l}=this.props;if(!this.dragNodeProps)return;const{dropPosition:c,dropLevelOffset:h,dropTargetKey:p,dropContainerKey:u,dropTargetPos:y,dropAllowed:f,dragOverNodeKey:g}=U(e,this.dragNodeProps,t,r,this.dragStartMousePosition,i,o,s,a,l);!n.includes(p)&&f&&(this.dragNodeProps.eventKey===p&&0===h?null===this.state.dropPosition&&null===this.state.dropLevelOffset&&null===this.state.dropTargetKey&&null===this.state.dropContainerKey&&null===this.state.dropTargetPos&&!1===this.state.dropAllowed&&null===this.state.dragOverNodeKey||this.resetDragState():c===this.state.dropPosition&&h===this.state.dropLevelOffset&&p===this.state.dropTargetKey&&u===this.state.dropContainerKey&&y===this.state.dropTargetPos&&f===this.state.dropAllowed&&g===this.state.dragOverNodeKey||this.setState({dropPosition:c,dropLevelOffset:h,dropTargetKey:p,dropContainerKey:u,dropTargetPos:y,dropAllowed:f,dragOverNodeKey:g}),null==d||d({event:e,node:m(t)}))}),t(this,"onNodeDragLeave",(e,t)=>{this.currentMouseOverDroppableNodeKey!==t.eventKey||e.currentTarget.contains(e.relatedTarget)||(this.resetDragState(),this.currentMouseOverDroppableNodeKey=null);const{onDragLeave:n}=this.props;null==n||n({event:e,node:m(t)})}),t(this,"onWindowDragEnd",e=>{this.onNodeDragEnd(e,null,!0),window.removeEventListener("dragend",this.onWindowDragEnd)}),t(this,"onNodeDragEnd",(e,t)=>{const{onDragEnd:n}=this.props;this.setState({dragOverNodeKey:null}),this.cleanDragState(),null==n||n({event:e,node:m(t)}),this.dragNodeProps=null,window.removeEventListener("dragend",this.onWindowDragEnd)}),t(this,"onNodeDrop",(e,t,n=!1)=>{var o;const{dragChildrenKeys:a,dropPosition:r,dropTargetKey:d,dropTargetPos:i,dropAllowed:l}=this.state;if(!l)return;const{onDrop:c}=this.props;if(this.setState({dragOverNodeKey:null}),this.cleanDragState(),null===d)return;const h={...N(d,this.getTreeNodeRequiredProps()),active:(null==(o=this.getActiveItem())?void 0:o.key)===d,data:u(this.state.keyEntities,d).node},p=a.includes(d);s(!p,"Can not drop to dragNode's children node. This is a bug of rc-tree. Please report an issue.");const y=I(i),f={event:e,node:m(h),dragNode:this.dragNodeProps?m(this.dragNodeProps):null,dragNodesKeys:[this.dragNodeProps.eventKey].concat(a),dropToGap:0!==r,dropPosition:r+Number(y[y.length-1])};n||null==c||c(f),this.dragNodeProps=null}),t(this,"cleanDragState",()=>{const{draggingNodeKey:e}=this.state;null!==e&&this.setState({draggingNodeKey:null,dropPosition:null,dropContainerKey:null,dropTargetKey:null,dropLevelOffset:null,dropAllowed:!0,dragOverNodeKey:null}),this.dragStartMousePosition=null,this.currentMouseOverDroppableNodeKey=null}),t(this,"triggerExpandActionExpand",(e,t)=>{const{expandedKeys:n,flattenNodes:o}=this.state,{expanded:s,key:a,isLeaf:r}=t;if(r||e.shiftKey||e.metaKey||e.ctrlKey)return;const d=o.filter(e=>e.key===a)[0],i=m({...N(a,this.getTreeNodeRequiredProps()),data:d.data});this.setExpandedKeys(s?A(n,a):R(n,a)),this.onNodeExpand(e,i)}),t(this,"onNodeClick",(e,t)=>{const{onClick:n,expandAction:o}=this.props;"click"===o&&this.triggerExpandActionExpand(e,t),null==n||n(e,t)}),t(this,"onNodeDoubleClick",(e,t)=>{const{onDoubleClick:n,expandAction:o}=this.props;"doubleClick"===o&&this.triggerExpandActionExpand(e,t),null==n||n(e,t)}),t(this,"onNodeSelect",(e,t)=>{let{selectedKeys:n}=this.state;const{keyEntities:o,fieldNames:s}=this.state,{onSelect:a,multiple:r}=this.props,{selected:d}=t,i=t[s.key],l=!d;n=l?r?R(n,i):[i]:A(n,i);const c=n.map(e=>{const t=u(o,e);return t?t.node:null}).filter(Boolean);this.setUncontrolledState({selectedKeys:n}),null==a||a(n,{event:"select",selected:l,node:t,selectedNodes:c,nativeEvent:e.nativeEvent})}),t(this,"onNodeCheck",(e,t,n)=>{const{keyEntities:o,checkedKeys:s,halfCheckedKeys:a}=this.state,{checkStrictly:r,onCheck:d}=this.props,{key:i}=t;let l;const c={event:"check",node:t,checked:n,nativeEvent:e.nativeEvent};if(r){const e=n?R(s,i):A(s,i);l={checked:e,halfChecked:A(a,i)},c.checkedNodes=e.map(e=>u(o,e)).filter(Boolean).map(e=>e.node),this.setUncontrolledState({checkedKeys:e})}else{let{checkedKeys:e,halfCheckedKeys:t}=b([...s,i],!0,o);if(!n){const n=new Set(e);n.delete(i),({checkedKeys:e,halfCheckedKeys:t}=b(Array.from(n),{halfCheckedKeys:t},o))}l=e,c.checkedNodes=[],c.checkedNodesPositions=[],c.halfCheckedKeys=t,e.forEach(e=>{const t=u(o,e);if(!t)return;const{node:n,pos:s}=t;c.checkedNodes.push(n),c.checkedNodesPositions.push({node:n,pos:s})}),this.setUncontrolledState({checkedKeys:e},!1,{halfCheckedKeys:t})}null==d||d(l,c)}),t(this,"onNodeLoad",e=>{var t;const{key:n}=e,{keyEntities:o}=this.state,a=u(o,n);if(null==(t=null==a?void 0:a.children)?void 0:t.length)return;const r=new Promise((t,o)=>{this.setState(({loadedKeys:a=[],loadingKeys:r=[]})=>{const{loadData:d,onLoad:i}=this.props;if(!d||a.includes(n)||r.includes(n))return null;return d(e).then(()=>{const{loadedKeys:o}=this.state,s=R(o,n);null==i||i(s,{event:"load",node:e}),this.setUncontrolledState({loadedKeys:s}),this.setState(e=>({loadingKeys:A(e.loadingKeys,n)})),t()}).catch(e=>{if(this.setState(e=>({loadingKeys:A(e.loadingKeys,n)})),this.loadingRetryTimes[n]=(this.loadingRetryTimes[n]||0)+1,this.loadingRetryTimes[n]>=10){const{loadedKeys:e}=this.state;s(!1,"Retry for `loadData` many times but still failed. No more retry."),this.setUncontrolledState({loadedKeys:R(e,n)}),t()}o(e)}),{loadingKeys:R(r,n)}})});return r.catch(()=>{}),r}),t(this,"onNodeMouseEnter",(e,t)=>{const{onMouseEnter:n}=this.props;null==n||n({event:e,node:t})}),t(this,"onNodeMouseLeave",(e,t)=>{const{onMouseLeave:n}=this.props;null==n||n({event:e,node:t})}),t(this,"onNodeContextMenu",(e,t)=>{const{onRightClick:n}=this.props;n&&(e.preventDefault(),n({event:e,node:t}))}),t(this,"onFocus",(...e)=>{const{onFocus:t}=this.props;this.setState({focused:!0}),null==t||t(...e)}),t(this,"onBlur",(...e)=>{const{onBlur:t}=this.props;this.setState({focused:!1}),this.onActiveChange(null),null==t||t(...e)}),t(this,"getTreeNodeRequiredProps",()=>{const{expandedKeys:e,selectedKeys:t,loadedKeys:n,loadingKeys:o,checkedKeys:s,halfCheckedKeys:a,dragOverNodeKey:r,dropPosition:d,keyEntities:i}=this.state;return{expandedKeys:e||[],selectedKeys:t||[],loadedKeys:n||[],loadingKeys:o||[],checkedKeys:s||[],halfCheckedKeys:a||[],dragOverNodeKey:r,dropPosition:d,keyEntities:i}}),t(this,"setExpandedKeys",e=>{const{treeData:t,fieldNames:n}=this.state,o=k(t,e,n);this.setUncontrolledState({expandedKeys:e,flattenNodes:o},!0)}),t(this,"onNodeExpand",(e,t)=>{let{expandedKeys:n}=this.state;const{listChanging:o,fieldNames:a}=this.state,{onExpand:r,loadData:d}=this.props,{expanded:i}=t,l=t[a.key];if(o)return;const c=n.includes(l),h=!i;if(s(i&&c||!i&&!c,"Expand state not sync with index check"),n=h?R(n,l):A(n,l),this.setExpandedKeys(n),null==r||r(n,{node:t,expanded:h,nativeEvent:e.nativeEvent}),h&&d){const e=this.onNodeLoad(t);e&&e.then(()=>{const e=k(this.state.treeData,n,a);this.setUncontrolledState({flattenNodes:e})}).catch(()=>{const{expandedKeys:e}=this.state,t=A(e,l);this.setExpandedKeys(t)})}}),t(this,"onListChangeStart",()=>{this.setUncontrolledState({listChanging:!0})}),t(this,"onListChangeEnd",()=>{setTimeout(()=>{this.setUncontrolledState({listChanging:!1})})}),t(this,"onActiveChange",e=>{const{activeKey:t}=this.state,{onActiveChange:n,itemScrollOffset:o=0}=this.props;t!==e&&(this.setState({activeKey:e}),null!==e&&this.scrollTo({key:e,offset:o}),null==n||n(e))}),t(this,"getActiveItem",()=>{const{activeKey:e,flattenNodes:t}=this.state;return null===e?null:t.find(({key:t})=>t===e)||null}),t(this,"offsetActiveKey",e=>{const{flattenNodes:t,activeKey:n}=this.state;let o=t.findIndex(({key:e})=>e===n);-1===o&&e<0&&(o=t.length),o=(o+e+t.length)%t.length;const s=t[o];if(s){const{key:e}=s;this.onActiveChange(e)}else this.onActiveChange(null)}),t(this,"onKeyDown",e=>{const{activeKey:t,expandedKeys:n,checkedKeys:o,fieldNames:s}=this.state,{onKeyDown:a,checkable:r,selectable:d}=this.props;switch(e.which){case i.UP:this.offsetActiveKey(-1),e.preventDefault();break;case i.DOWN:this.offsetActiveKey(1),e.preventDefault()}const l=this.getActiveItem();if(l&&l.data){const a=this.getTreeNodeRequiredProps(),c=!1===l.data.isLeaf||!!(l.data[s.children]||[]).length,h=m({...N(t,a),data:l.data,active:!0});switch(e.which){case i.LEFT:c&&n.includes(t)?this.onNodeExpand({},h):l.parent&&this.onActiveChange(l.parent.key),e.preventDefault();break;case i.RIGHT:c&&!n.includes(t)?this.onNodeExpand({},h):l.children&&l.children.length&&this.onActiveChange(l.children[0].key),e.preventDefault();break;case i.ENTER:case i.SPACE:!r||h.disabled||!1===h.checkable||h.disableCheckbox?r||!d||h.disabled||!1===h.selectable||this.onNodeSelect({},h):this.onNodeCheck({},h,!o.includes(t))}}null==a||a(e)}),t(this,"setUncontrolledState",(e,t=!1,n=null)=>{if(!this.destroyed){let o=!1,s=!0;const a={};Object.keys(e).forEach(t=>{this.props.hasOwnProperty(t)?s=!1:(o=!0,a[t]=e[t])}),!o||t&&!s||this.setState({...a,...n})}}),t(this,"scrollTo",e=>{this.listRef.current.scrollTo(e)})}componentDidMount(){this.destroyed=!1,this.onUpdated()}componentDidUpdate(){this.onUpdated()}onUpdated(){const{activeKey:e,itemScrollOffset:t=0}=this.props;void 0!==e&&e!==this.state.activeKey&&(this.setState({activeKey:e}),null!==e&&this.scrollTo({key:e,offset:t}))}componentWillUnmount(){window.removeEventListener("dragend",this.onWindowDragEnd),this.destroyed=!0}static getDerivedStateFromProps(e,t){const{prevProps:n}=t,o={prevProps:e};function a(t){return!n&&e.hasOwnProperty(t)||n&&n[t]!==e[t]}let r,{fieldNames:d}=t;if(a("fieldNames")&&(d=g(e.fieldNames),o.fieldNames=d),a("treeData")?({treeData:r}=e):a("children")&&(s(!1,"`children` of Tree is deprecated. Please use `treeData` instead."),r=v(e.children)),r){o.treeData=r;const e=K(r,{fieldNames:d});o.keyEntities={[z]:Q,...e.keyEntities}}const i=o.keyEntities||t.keyEntities;if(a("expandedKeys")||n&&a("autoExpandParent"))o.expandedKeys=e.autoExpandParent||!n&&e.defaultExpandParent?G(e.expandedKeys,i):e.expandedKeys;else if(!n&&e.defaultExpandAll){const e={...i};delete e[z];const t=[];Object.keys(e).forEach(n=>{const o=e[n];o.children&&o.children.length&&t.push(o.key)}),o.expandedKeys=t}else!n&&e.defaultExpandedKeys&&(o.expandedKeys=e.autoExpandParent||e.defaultExpandParent?G(e.defaultExpandedKeys,i):e.defaultExpandedKeys);if(o.expandedKeys||delete o.expandedKeys,r||o.expandedKeys){const e=k(r||t.treeData,o.expandedKeys||t.expandedKeys,d);o.flattenNodes=e}if(e.selectable&&(a("selectedKeys")?o.selectedKeys=B(e.selectedKeys,e):!n&&e.defaultSelectedKeys&&(o.selectedKeys=B(e.defaultSelectedKeys,e))),e.checkable){let s;if(a("checkedKeys")?s=W(e.checkedKeys)||{}:!n&&e.defaultCheckedKeys?s=W(e.defaultCheckedKeys)||{}:r&&(s=W(e.checkedKeys)||{checkedKeys:t.checkedKeys,halfCheckedKeys:t.halfCheckedKeys}),s){let{checkedKeys:t=[],halfCheckedKeys:n=[]}=s;if(!e.checkStrictly){const e=b(t,!0,i);({checkedKeys:t,halfCheckedKeys:n}=e)}o.checkedKeys=t,o.halfCheckedKeys=n}}return a("loadedKeys")&&(o.loadedKeys=e.loadedKeys),o}resetDragState(){this.setState({dragOverNodeKey:null,dropPosition:null,dropLevelOffset:null,dropTargetKey:null,dropContainerKey:null,dropTargetPos:null,dropAllowed:!1})}render(){const{focused:e,flattenNodes:t,keyEntities:o,draggingNodeKey:s,activeKey:a,dropLevelOffset:d,dropContainerKey:i,dropTargetKey:c,dropPosition:h,dragOverNodeKey:p,indent:u}=this.state,{prefixCls:y,className:f,style:g,styles:v,classNames:k,showLine:K,focusable:N,tabIndex:m=0,selectable:x,showIcon:E,icon:b,switcherIcon:D,draggable:S,checkable:P,checkStrictly:O,disabled:w,motion:T,loadData:L,filterTreeNode:M,height:A,itemHeight:R,scrollWidth:I,virtual:j,titleRender:_,dropIndicatorRender:U,onContextMenu:B,onScroll:W,direction:G,rootClassName:F,rootStyle:q}=this.props,H=r(this.props,{aria:!0,data:!0});let V;S&&(V="object"==typeof S?S:"function"==typeof S?{nodeDraggable:S}:{});const X={styles:v,classNames:k,prefixCls:y,selectable:x,showIcon:E,icon:b,switcherIcon:D,draggable:V,draggingNodeKey:s,checkable:P,checkStrictly:O,disabled:w,keyEntities:o,dropLevelOffset:d,dropContainerKey:i,dropTargetKey:c,dropPosition:h,dragOverNodeKey:p,indent:u,direction:G,dropIndicatorRender:U,loadData:L,filterTreeNode:M,titleRender:_,onNodeClick:this.onNodeClick,onNodeDoubleClick:this.onNodeDoubleClick,onNodeExpand:this.onNodeExpand,onNodeSelect:this.onNodeSelect,onNodeCheck:this.onNodeCheck,onNodeLoad:this.onNodeLoad,onNodeMouseEnter:this.onNodeMouseEnter,onNodeMouseLeave:this.onNodeMouseLeave,onNodeContextMenu:this.onNodeContextMenu,onNodeDragStart:this.onNodeDragStart,onNodeDragEnter:this.onNodeDragEnter,onNodeDragOver:this.onNodeDragOver,onNodeDragLeave:this.onNodeDragLeave,onNodeDragEnd:this.onNodeDragEnd,onNodeDrop:this.onNodeDrop};return l.createElement(C.Provider,{value:X},l.createElement("div",{className:n(y,f,F,{["".concat(y,"-show-line")]:K,["".concat(y,"-focused")]:e,["".concat(y,"-active-focused")]:null!==a}),style:q},l.createElement(te,ne({ref:this.listRef,prefixCls:y,style:g,data:t,disabled:w,selectable:x,checkable:!!P,motion:T,dragging:null!==s,height:A,itemHeight:R,virtual:j,focusable:N,focused:e,tabIndex:m,activeItem:this.getActiveItem(),onFocus:this.onFocus,onBlur:this.onBlur,onKeyDown:this.onKeyDown,onActiveChange:this.onActiveChange,onListChangeStart:this.onListChangeStart,onListChangeEnd:this.onListChangeEnd,onContextMenu:B,onScroll:W,scrollWidth:I},this.getTreeNodeRequiredProps(),H))))}}t(oe,"defaultProps",{prefixCls:"rc-tree",showLine:!1,showIcon:!0,selectable:!0,multiple:!1,checkable:!1,disabled:!1,checkStrictly:!1,draggable:!1,defaultExpandParent:!0,autoExpandParent:!1,defaultExpandAll:!1,defaultExpandedKeys:[],defaultCheckedKeys:[],defaultSelectedKeys:[],dropIndicatorRender:e=>{const{dropPosition:t,dropLevelOffset:n,indent:o}=e,s={pointerEvents:"none",position:"absolute",right:0,backgroundColor:"red",height:2};switch(t){case-1:s.top=0,s.left=-n*o;break;case 1:s.bottom=0,s.left=-n*o;break;case 0:s.bottom=0,s.left=o}return c.createElement("div",{style:s})},allowDrop:()=>!0,expandAction:!1}),t(oe,"TreeNode",M);export{oe as T,D as U,b as a,A as b,K as c,R as d,G as e,g as f,v as g,M as h};
